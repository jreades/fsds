<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical 7: Working with Text (Part 2) â€“ Foundations of Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<meta property="og:title" content="Practical 7: Working with Text (Part 2) â€“ Foundations of Spatial Data Science">
<meta property="og:description" content="The basics of Text Mining and NLP">
<meta property="og:image" content="https://jreades.github.io/fsds/practicals/img/CASA_Logo_no_text.png">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-md " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/CASA_Logo_no_text.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Foundations of Spatial Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">    
        <li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Foundations</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Setting Up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Foundations (Pt.1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Foundations (Pt.2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Objects</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Data</li>
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Numeric Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/reading_week.html">
 <span class="dropdown-text">Reading Week</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Spatial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Textual Data</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Analysis</li>
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Selecting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Presenting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Wrap Up + Lookahead</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 4: Bonus</li>
        <li>
    <a class="dropdown-item" href="../sessions/week11.html">
 <span class="dropdown-text">11. Dimensions in Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week12.html">
 <span class="dropdown-text">12. Grouping Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.html">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">    
        <li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Elements</li>
        <li>
    <a class="dropdown-item" href="../assessments/exam.html">
 <span class="dropdown-text">Timed Open Book Exam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/group.html">
 <span class="dropdown-text">Group Work</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/peer.html">
 <span class="dropdown-text">Group Self-Evaluation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#exploratory-textual-analysis" id="toc-exploratory-textual-analysis" class="nav-link" data-scroll-target="#exploratory-textual-analysis">Exploratory Textual Analysis</a></li>
  <li><a href="#using-regular-expressions" id="toc-using-regular-expressions" class="nav-link" data-scroll-target="#using-regular-expressions">Using Regular Expressions</a></li>
  <li><a href="#illustrative-text-cleaning" id="toc-illustrative-text-cleaning" class="nav-link" data-scroll-target="#illustrative-text-cleaning">Illustrative Text Cleaning</a></li>
  <li><a href="#applying-normalisation" id="toc-applying-normalisation" class="nav-link" data-scroll-target="#applying-normalisation">Applying Normalisation</a></li>
  <li><a href="#revenons-Ã -nos-moutons" id="toc-revenons-Ã -nos-moutons" class="nav-link" data-scroll-target="#revenons-Ã -nos-moutons">Revenons Ã  Nos Moutons</a></li>
  <li><a href="#word-clouds" id="toc-word-clouds" class="nav-link" data-scroll-target="#word-clouds">Word Clouds</a></li>
  <li><a href="#latent-dirchlet-allocation" id="toc-latent-dirchlet-allocation" class="nav-link" data-scroll-target="#latent-dirchlet-allocation">Latent Dirchlet Allocation</a></li>
  <li><a href="#word2vec" id="toc-word2vec" class="nav-link" data-scroll-target="#word2vec">Word2Vec</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Practical-07-Textual_Data-Pt2.ipynb" download="Practical-07-Textual_Data-Pt2.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li><li><a href="Practical-07-Textual_Data-Pt2.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 7: Working with Text (Part 2)</h1>
<p class="subtitle lead">The basics of Text Mining and NLP</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 20%">
<col style="width: 27%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Complete</th>
<th style="text-align: left;">Part 1: Foundations</th>
<th style="text-align: left;">Part 2: Data</th>
<th style="text-align: left;">Part 3: Analysis</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">60%</td>
<td style="text-align: left;">â–“â–“â–“â–“â–“â–“â–“â–“</td>
<td style="text-align: left;">â–“â–“â–“â–“â–“â–‘</td>
<td style="text-align: left;">â–‘â–‘â–‘â–‘â–‘â–‘</td>
<td style="text-align: right;">7/10</td>
</tr>
</tbody>
</table>
<p>A lot of the content here is provided to help you <em>understand</em> what text-cleaning does and how it generates tokens that can be processed by the various analytical approaches commonly-used in NLP. The best way to think about this is as a practical in three parts, not all of which you should expect to complete in this session:</p>
<ol type="1">
<li>Tasks 1â€“3: these are largely focussed on the basics: exploring text and using regular expressions to find and select text.</li>
<li>Tasks 4â€“5: this might seem like a <em>bit</em> of a detour, but itâ€™s intended to show you in a more tangible way how â€˜normalisationâ€™ works when weâ€™re working with text. <strong>You should feel free to stop here and return to the rest later.</strong></li>
<li>Tasks 6â€“7: are about finding important vocabulary (think â€˜keywordsâ€™ and â€˜significant termsâ€™) in documents so that you can start to think about what is <em>distinctive</em> about documents and groups of documents. <strong>This is quite useful and relatively easier to understand than what comes next!</strong></li>
<li>Tasks 8â€“9: are about fully-fledged NLP using Latent Direclecht Allocation (topic modelling) and Word2Vec (words embeddings for use in clustering or similarity work).</li>
</ol>
<p>The later parts are largely complete and ready to run; however, that <em>doesnâ€™t</em> mean you should just skip over them and think youâ€™ve grasped whatâ€™s happening and it will be easy to apply in your own analyses. I would <em>not</em> pay as much attention to LDA topic mining since I donâ€™t think itâ€™s results are that good, but Iâ€™ve included it here as itâ€™s still commonly-used in the Digital Humanities and by Marketing folks. Word2Vec is much more powerful and forms the basis of the kinds of advances seen in ChatGPT and other LLMs.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ðŸ”— Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with text is unquestionably <em>hard</em>. In fact, <em>conceptually</em> this is probaly the most challenging practical of the term! But data scientists are <em>always</em> dealing with text because so much of the data that we collect (even more so thanks to the web) is not only text-based (URLs are text!) but, increasingly, unstructured (social media posts, tags, etc.). So while getting to grips with text is a challenge, it also uniquely positions you with respect to the skills and knowledge that other graduates are offering to employers.</p>
</div>
</div>
<section id="preamble" class="level1">
<h1>Preamble</h1>
<p>This practical has been written using <code>nltk</code>, but would be <em>relatively</em> easy to rework using <code>spacy</code>. Most programmers tend to use one <em>or</em> the other, and the switch wouldnâ€™t be hard other than having to first load the requisite language models:</p>
<div id="431a409b" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spacy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># `...web_md` and `...web_lg` are also options</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>corp <span class="op">=</span> <span class="st">"en_core_web_sm"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>: </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    nlp <span class="op">=</span> spacy.load(corp)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">OSError</span>:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    spacy.cli.download(corp)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    nlp <span class="op">=</span> spacy.load(corp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can <a href="https://spacy.io/models/en">read about the models</a>, and note that they are also <a href="https://spacy.io/usage/models">available in other languages</a> besides English.</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>But this is only because this has been worked out for you. Starting from sctach in NLP is <em>hard</em> so people try to avoid it as much as possible.</p>
</div>
</div>
</div>
<section id="required-modules" class="level2">
<h2 class="anchored" data-anchor-id="required-modules">Required Modules</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the number of modules and functions that we import is steadily increasing week-on-week, and that for text processing we tend to draw on quite a wide range of utilies! That said, the three most commonly used are: <code>sklearn</code>, <code>nltk</code>, and <code>spacy</code>.</p>
</div>
</div>
<p>Standard libraries weâ€™ve seen before.</p>
<div id="f361c574" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vectorisers we will use from the â€˜big beastâ€™ of Python machine learning: Sci-Kit Learn.</p>
<div id="592b5af8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> LatentDirichletAllocation</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We don't use this but I point out where you *could*</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>NLP-specific libraries that we will use for tokenisation, lemmatisation, and frequency analysis.</p>
<div id="e75de241" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spacy</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> wordnet <span class="im">as</span> wn</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.wordnet <span class="im">import</span> WordNetLemmatizer</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    nltk.download(<span class="st">'stopwords'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>stopword_list <span class="op">=</span> <span class="bu">set</span>(stopwords.words(<span class="st">'english'</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize, sent_tokenize</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize.toktok <span class="im">import</span> ToktokTokenizer</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.porter <span class="im">import</span> PorterStemmer</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.snowball <span class="im">import</span> SnowballStemmer</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk <span class="im">import</span> ngrams, FreqDist</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> ToktokTokenizer()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remaining libraries that weâ€™ll use for processing and display text data. Most of this relates to dealing with the various ways that text data cleaning is <em>hard</em> because of the myriad formats it comes in.</p>
<div id="59013bff" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> string</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> unicodedata</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> wordcloud <span class="im">import</span> WordCloud, STOPWORDS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This next is just a small utility function that allows us to output Markdown (like this cell) instead of plain text:</p>
<div id="d62d262c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display_markdown</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> as_markdown(head<span class="op">=</span><span class="st">''</span>, body<span class="op">=</span><span class="st">'Some body text'</span>):</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> head <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        display_markdown(<span class="ss">f"##### </span><span class="sc">{</span>head<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">&gt;</span><span class="sc">{</span>body<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>, raw<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        display_markdown(<span class="ss">f"&gt;</span><span class="sc">{</span>body<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>, raw<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>as_markdown(<span class="st">'Result!'</span>, <span class="st">"Here's my output..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="result" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="result">Result!</h5>
<blockquote class="blockquote">
<p>Hereâ€™s my outputâ€¦</p>
</blockquote>
</section>
</div>
</section>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading Data</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ðŸ”— Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because I generally want each practical to stand on its own (unless Iâ€™m trying to make a <em>point</em>), Iâ€™ve not moved this to a separate Python file (e.g.&nbsp;<code>utils.py</code>, but in line with what we covered back in the lectures on <a href="https://jreades.github.io/fsds/sessions/week3.html#lectures">Functions and Packages</a>, this sort of thing is a good candidate for being split out to a separate file to simplify re-use.</p>
</div>
</div>
<p>Remember this function from last week? We use it to save downloading files that we already have stored locally. But notice Iâ€™ve made some small changesâ€¦ what do these do to help the user?</p>
<div id="a95d9d15" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests <span class="im">import</span> get</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cache_data(src:<span class="bu">str</span>, dest:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Downloads and caches a remote file locally.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    The function sits between the 'read' step of a pandas or geopandas</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">    data frame and downloading the file from a remote location. The idea</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    is that it will save it locally so that you don't need to remember to</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    do so yourself. Subsequent re-reads of the file will return instantly</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    rather than downloading the entire file for a second or n-th itme.</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">    src : str</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">        The remote *source* for the file, any valid URL should work.</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">    dest : str</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">        The *destination* location to save the downloaded file.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">    str</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">        A string representing the local location of the file.</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> urlparse(src) <span class="co"># We assume that this is some kind of valid URL </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    fn  <span class="op">=</span> os.path.split(url.path)[<span class="op">-</span><span class="dv">1</span>] <span class="co"># Extract the filename</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    dfn <span class="op">=</span> os.path.join(dest,fn) <span class="co">#&nbsp;Destination filename</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if dest+filename does *not* exist -- </span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># that would mean we have to download it! We</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># also check for *very* small files that are </span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#&nbsp;likely to represent an incomplete download.</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(dfn) <span class="kw">or</span> os.stat(dfn).st_size <span class="op">&lt;</span> <span class="dv">250</span>:</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> not found, downloading!"</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert the path back into a list (without)</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the filename -- we need to check that directories</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># exist first.</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> os.path.split(dest)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create any missing directories in dest(ination) path</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -- os.path.join is the reverse of split (as you saw above)</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># but it doesn't work with lists... so I had to google how</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to use the 'splat' operator! os.makedirs creates missing</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># directories in a path automatically.</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(path) <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">and</span> path[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            os.makedirs(os.path.join(<span class="op">*</span>path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Download and write the file</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(dfn, <span class="st">"wb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> get(src)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">file</span>.write(response.content)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\t</span><span class="st">Done downloading..."</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What's this doing???</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        f_size <span class="op">=</span> os.stat(dfn).st_size</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">Size is </span><span class="sc">{</span>f_size<span class="op">/</span><span class="dv">1024</span><span class="op">**</span><span class="dv">2</span><span class="sc">:,.0f}</span><span class="ss"> MB (</span><span class="sc">{</span>f_size<span class="sc">:,}</span><span class="ss"> bytes)"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> locally!"</span>)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># And why is it here as well???</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        f_size <span class="op">=</span> os.stat(dfn).st_size</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">Size is </span><span class="sc">{</span>f_size<span class="op">/</span><span class="dv">1024</span><span class="op">**</span><span class="dv">2</span><span class="sc">:,.0f}</span><span class="ss"> MB (</span><span class="sc">{</span>f_size<span class="sc">:,}</span><span class="ss"> bytes)"</span>)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dfn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For very large <em>non</em>-geographic data sets, remember that you can <code>use_cols</code> (or <code>columns</code> depending on the file type) to specify a subset of columns to load.</p>
</div>
</div>
<p>Load the main data set:</p>
<div id="d39596ce" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set download URL</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ymd  <span class="op">=</span> <span class="st">'2023-09-06'</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>host <span class="op">=</span> <span class="st">'https://orca.casa.ucl.ac.uk'</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>url  <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>host<span class="sc">}</span><span class="ss">/~jreades/data/</span><span class="sc">{</span>ymd<span class="sc">}</span><span class="ss">-listings.geoparquet'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_parquet( cache_data(url, os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>)), </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                      columns<span class="op">=</span>[<span class="st">'geometry'</span>, <span class="st">'listing_url'</span>, <span class="st">'name'</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'description'</span>, <span class="st">'amenities'</span>, <span class="st">'price'</span>])</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.to_crs(<span class="st">'epsg:27700'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and CRS is </span><span class="sc">{</span>gdf<span class="sc">.</span>crs<span class="sc">.</span>name<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found data/geo/2023-09-06-listings.geoparquet locally!
    Size is 42 MB (44,152,609 bytes)
gdf has 85,134 rows and CRS is OSGB36 / British National Grid.</code></pre>
</div>
</div>
<p>Load supporting Geopackages:</p>
<div id="7d98fe4b" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ddir  <span class="op">=</span> os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>) <span class="co"># destination directory</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>spath <span class="op">=</span> <span class="st">'https://github.com/jreades/fsds/blob/master/data/src/'</span> <span class="co"># source path</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>boros <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Boroughs.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>water <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Water.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Greenspace.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Done.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found data/geo/Boroughs.gpkg locally!
    Size is 1 MB (905,216 bytes)
Found data/geo/Water.gpkg locally!
    Size is 0 MB (208,896 bytes)
Found data/geo/Greenspace.gpkg locally!
    Size is 1 MB (1,146,880 bytes)
Done.</code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-textual-analysis" class="level1">
<h1>Exploratory Textual Analysis</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ðŸ”— Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you plan to work with data post-graduation then you will <em>need</em> to become comfortable with Regular Expressions (aka. regexes). These are the focus of the <a href="https://jreades.github.io/fsds/sessions/week7.html#lectures">Patterns in Text</a> lecture but they barely even scratch the surface of what regexes can do. They are <em>hard</em>, but they are powerful.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a full text-mining application I would spend a lot more time on this stage: sampling, looking at descriptions in full, performing my analysis (the rest of the steps) and then coming back with a deeper understanding of the data to make further changes to the analysis.</p>
</div>
</div>
<p>Itâ€™s helpful to have a sense of what data look like before trying to do something with them, but by default pandas truncates quite a lot of output to keep it from overwhelming the display. For text processing, however, you should probably change the amount of preview text provided by pandas using the available options. <em>Note</em>: there are lots of other options that you can tweak in pandas.</p>
<div id="412d9582" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Default maximum column width: </span><span class="sc">{</span>pd<span class="sc">.</span>options<span class="sc">.</span>display<span class="sc">.</span>max_colwidth<span class="sc">}</span><span class="ss">"</span>) <span class="co"># What's this currently set to?</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_colwidth<span class="op">=</span><span class="dv">250</span>   <span class="co"># None = no maximum column width (you probably don't want to leave it at this)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Now maximum column width set to: </span><span class="sc">{</span>pd<span class="sc">.</span>options<span class="sc">.</span>display<span class="sc">.</span>max_colwidth<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Default maximum column width: 50
Now maximum column width set to: 250</code></pre>
</div>
</div>
<section id="the-description-field" class="level2">
<h2 class="anchored" data-anchor-id="the-description-field">The Description Field</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate, because of the questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>To explore the description field properly youâ€™ll need to filter out any NA/NaN descriptions before sampling the result. <em>Hint</em>: youâ€™ll need to think about negation (<code>~</code>) of a method output that tells you if a field <em>is NA</em>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gdf[???].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="e4099b86" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>gdf[<span class="op">~</span>gdf.description.isna()].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">21898360</td>
<td>A wonderful double room in harrow on the hill.&lt;br /&gt;&lt;br /&gt;Very quite and secure area&lt;br /&gt;Guests will have acces to all comunes areas in the flat, bathroom, kitchen, &lt;br /&gt;very spacious natural garden with table and chairs to to take your breakfa...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">40269638</td>
<td>- 3 Bedrooms 2 beds and 1 sofa bed&lt;br /&gt;- 2 Bathroom&lt;br /&gt;- 0.5 miles Underground Station &lt;br /&gt;- Free WiFi &lt;br /&gt;&lt;br /&gt;This is an exciting opportunity to stay in a unique part of West London, Maida Hill. &lt;br /&gt;&lt;br /&gt;This stunning 3-bedroom apart...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">610813289456549376</td>
<td>St George Wharf is a landmark riverside development spanning across 7 acres of Londonâ€™s newest area of regeneration. It is distinguishable by its striking gull-wing roofs and stylish terraces. Broadway Malyan Architects championed innovation by d...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">917365608608238592</td>
<td>My place is in the Heart of London. It is only 15 mins to KINGS CROSS Underground station, 16 mins to EUROSTAR- St PANCRAS INT, and 2 mins to Angel Station by WALKING. If you choose my place you are in all the LONDON attractions, tourist amenitie...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6319621</td>
<td>This artsy and cozy small 1 bedroom split level flat is 4 min. from Seven Sisters tube/metro station, and close to Tottenham Hale station (ideal if you are arriving from Stansted Airport). It's in an upcoming multicultural area of London at beg...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you notice about the above? Are they simple text? Are there patterns of problems? Are there characters that represent things other than words and simple punctuation?</p>
</div>
</div>
<section id="questions" class="level3">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<ul>
<li>What patterns can you see that might need â€˜dealing withâ€™ for text-mining to work?</li>
<li>What non-text characters can you see? (Things <em>other</em> than A-Z, a-z, and simple punctuation!)</li>
</ul>
</section>
</section>
<section id="the-amenities-field" class="level2">
<h2 class="anchored" data-anchor-id="the-amenities-field">The Amenities Field</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate, because of the questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This field presents a subtle issue that might not be obvious here:</p>
<div id="540cfe8f" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gdf.amenities.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>id
23851484                                                                                                                                                                                             ["Heating", "Washer", "Wifi", "Kitchen", "Dryer", "Hangers", "Essentials"]
930201284366445056    ["Bathtub", "Hot water kettle", "Shampoo", "Luggage dropoff allowed", "Portable heater", "Microwave", "Bed linens", "Blender", "Cleaning available during stay", "Coffee", "Hot water", "Iron", "Host greets you", "Clothing storage: closet, wardrobe...
19955089              ["Shampoo", "Dryer", "Microwave", "Coffee maker", "Hot water", "Iron", "First aid kit", "Washer", "Fire extinguisher", "Cooking basics", "Heating", "Dishwasher", "Oven", "Refrigerator", "TV", "Hair dryer", "Essentials", "Private entrance", "Stove...
886165743387675008                                                                                                                                                                            ["Lock on bedroom door", "Wifi", "Free parking on premises", "Kitchen", "Washer"]
13921898              ["Bathtub", "Indoor fireplace", "Shampoo", "Microwave", "Bed linens", "Hot water", "Iron", "Host greets you", "Free dryer \u2013 In building", "First aid kit", "Paid parking off premises", "Washer", "Bread maker", "Fire extinguisher", "Cooking ba...
Name: amenities, dtype: object</code></pre>
</div>
</div>
<p>But look what happens now, can you see the issue a little more easily?</p>
<div id="9af95a46" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gdf.amenities.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>'["Heating", "TV with standard cable", "Wifi", "Smoke alarm", "Dryer", "Kitchen", "Washer", "Essentials"]'</code></pre>
</div>
</div>
<section id="questions-1" class="level3">
<h3 class="anchored" data-anchor-id="questions-1">Questions</h3>
<ul>
<li>Whatâ€™s the implicit format of the Amenities columns?</li>
<li>How could you represent the data contained in the column?</li>
</ul>
</section>
</section>
<section id="remove-nan-values" class="level2">
<h2 class="anchored" data-anchor-id="remove-nan-values">Remove NaN Values</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I would be wary of doing the below in a â€˜properâ€™ application without doing some careful research first, but to make our lives easier, weâ€™re going to drop rows where one of these values is NaN <em>now</em> so it will simplify the steps below. In reality, I would spend quite a bit more time investigating which values are NaN and why before simply dropping them.</p>
</div>
</div>
<p>Anyway, drop all rows where <em>either</em> the description or amenities (or both) are NA:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.dropna(???)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Now gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div id="12b5f6f9" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.dropna(subset<span class="op">=</span>[<span class="st">'description'</span>,<span class="st">'amenities'</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Now gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Now gdf has 84,273 rows.</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You should get that there are 84,273 rows.</p>
</section>
</section>
<section id="using-regular-expressions" class="level1">
<h1>Using Regular Expressions</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ðŸ”— Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Weâ€™re building on the work done in Practical 6, but making use now of the lecture on <a href="https://jreades.github.io/fsds/sessions/week6.html#lectures">Patterns in Text</a>) to quickly sort through the listings.</p>
</div>
</div>
<p>There is a <em>lot</em> that can be done with Regular Expressions to identify relevant records in textual data and weâ€™re going to use this as a starting point for the rest of the analysis. I would normally consider the regexes here a â€˜first passâ€™ at the data, but would look very carefully at the output of the TF/IDF vectorizer, Count vectorizer, and LDA to see if I could improve my regexes for further cycles of analysisâ€¦ the main gain there is that regexes are <em>much</em> faster than using the full NLP (Natural Language Processing) pipeline on the <em>full</em> data set each time. As an alternative, you could develop the pipeline using a random subsample of the data and then process the remaining records sequentially â€“ in this context there is no justification for doing that, but with a larger corpus it might make sense.</p>
<section id="luxury-listings" class="level2">
<h2 class="anchored" data-anchor-id="luxury-listings">Luxury Listings</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Hard, because of the regular expression and questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>I would like you to find listings that <em>might</em> (on the basis of word choice) indicate â€˜luxuryâ€™ accommodation.</p>
<section id="create-the-regular-expression" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression">Create the Regular Expression</h3>
<p>You should start with variations on â€˜luxuryâ€™ (i.e.&nbsp;luxurious, luxuriate, â€¦) and work out a <strong>single regular expression</strong> that works for variations on this <em>one</em> word. <strong>Later</strong>, I would encourage you to come back to this and consider what other words might help to signal â€˜luxuryâ€™â€¦ perhaps words like â€˜stunningâ€™ or â€˜prestigiousâ€™? Could you add those to the regex as well?</p>
<p><em>Hints</em>: this is a toughy, butâ€¦</p>
<ol type="1">
<li>All regular expressions work best using the <code>r'...'</code> (which means raw string) syntax.</li>
<li>You need to be able to <em>group</em> terms. Recall, however, that in Python a â€˜groupâ€™ of the form <code>r'(some text)'</code> refers to matching (<code>some text</code> will be â€˜memoizedâ€™/remembered), whereas what you need here is a â€œnon-capturing groupâ€ of the <strong>positive lookahead</strong> type. Thatâ€™s a Google clue right there, but youâ€™ve also seen this in the lecture.</li>
</ol>
<p>In fact, in my real-world applications you might even need more than one group/non-capturing group in a <em>nested</em> structure.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'???'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE) <span class="co"># &lt;-- The regex</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div id="56252e76" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'(?:luxur(?:y|ious|iat)|prestigious|stunning)'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">21052595</td>
<td>NEW 4 BEDROOM HOUSE WITH PRIVATE GARDEN IN WEST HAMPSTEAD, LONDON NW6&lt;br /&gt;&lt;br /&gt;Stunning high spec house overall 3 levels. &lt;br /&gt;&lt;br /&gt;Ground floor: Kitchen - Fully equipped with modern appliances. Living area - sofa, TV, dining table and chairs...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3798279</td>
<td>Beautiful home in Kingston upon Thames. Central location - short walk to the river &amp; kingston town centre &amp; kingston train station (35 mins to London). Bus ride to Hampton Court and Richmond.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Three bedroom home ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">821457432530779648</td>
<td>Stunning spacious one bedroom apartment in one of London's most prime locations. You are a mere minutes away from Holborn station and British museum is right behind the building. Covent Gargen, a shopping and entertainment hub boasting some of th...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">859336290217358976</td>
<td>Well thought out townhouse on a pedestrianised Avenue for families/groups of friends wanting lots of space in a fantastic location super close to Clapham Junction station and Northcote Road.&lt;br /&gt;&lt;br /&gt;Secure underground parking available to pre...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">959952321493154432</td>
<td>Perfectly located in Knightsbridge, convenient to most hot spots. This chic home will have you surrounded by the most iconic London sights when you're out and about in the neighborhood, and steeped in Scandinavian culture when you're relaxing in ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apply-it-to-select-data" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-select-data">Apply it to Select Data</h3>
<p>Assign it to a new data frame called <code>lux</code>:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lux <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'???'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>lux<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> records for 'luxury' flats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div id="513e64ee" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lux <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'(?:luxur(?:y|ious|iat)|prestigious|stunning)'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>lux<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> records for 'luxury' flats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 10,368 records for 'luxury' flats</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You should get 10,368 rows.</p>
</section>
<section id="plot-the-data" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data">Plot the Data</h3>
<p>Now we are going to create a more complex plot that will give space to both the spatial and price distributions using <code>subplot2grid</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(plt.subplot2grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that there are two ways to create the plot specified above. I chose route 1, but in some ways route 2 (where you specify a <code>gridspec</code> object and <em>then</em> add the axes might be a bit simpler to work out if youâ€™re starting from scratch.</p>
<p>The critical thing here is to understand how weâ€™er initialising a plot that has <strong>4 rows</strong> and <strong>1 column</strong> even though it is only showing <strong>2 plots</strong>. What weâ€™re going to do is set the <em>first</em> plot to span <strong>3 rows</strong> so that it takes up 75% of the plot area (3/4), while the <em>second</em> plot only takes up 25% (1/4). They will appear one above the other, so thereâ€™s only 1 column. Hereâ€™s how to read the key parts of <code>subplot2grid</code>:</p>
<ul>
<li><code>nrows</code> â€“ how many rows <em>of plots</em> in the figure.</li>
<li><code>ncols</code> â€“ how many columns <em>of plots</em> in the figure.</li>
<li><code>row</code> â€“ what row of the figure does <em>this</em> plot start on (0-indexed like a list in Python).</li>
<li><code>col</code> â€“ what column of the figure does <em>this</em> plot start on (0-indexed like a list in Python).</li>
<li><code>rowspan</code> â€“ how many rows of the figure does <em>this</em> plot span (<em>not</em> 0-indexed because itâ€™s not list-like).</li>
<li><code>colspan</code> â€“ how many columns of the figure does <em>this</em> plot span (<em>not</em> 0-indexed because itâ€™s not list-like).</li>
</ul>
<p>Every time you call <code>subplot2grid</code> you are initialising a new axis-object into which you can then draw with your geopackage or pandas plotting methods.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">6</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>ax.remove()</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The first plot </span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (???), rowspan<span class="op">=</span>???)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>lux.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The second plot</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot2grid((???), (???), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>lux.price.plot.hist(bins<span class="op">=</span><span class="dv">250</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Listings Advertising Luxury"</span>) <span class="co"># &lt;-- How does this differ from title? Change it and see!</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() <span class="co"># &lt;-- Try creating the plot *without* this to see what it changes</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div id="9864ebb7" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">6</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ax.remove()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The first plot</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>lux.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The second plot</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>lux.price.plot.hist(bins<span class="op">=</span><span class="dv">250</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Listings Advertising Luxury"</span>) <span class="co"># &lt;-- How does this differ from title? Change it and see!</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() <span class="co"># &lt;-- Try creating the plot *without* this to see what it changes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-18-output-1.png" width="661" height="568" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Your result should look similar to:</p>
<div id="f17be7b5" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-19-output-1.png" width="661" height="568" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="questions-2" class="level3">
<h3 class="anchored" data-anchor-id="questions-2">Questions</h3>
<ul>
<li>What does <code>suptitle</code> do and how is it different from <code>title</code>? Could you use this as part of your plot-making process?</li>
<li>What does <code>tight_layout</code> do?</li>
</ul>
</section>
</section>
<section id="budget-listings" class="level2">
<h2 class="anchored" data-anchor-id="budget-listings">Budget Listings</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Easy, because youâ€™ve worked out the hard bits already.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="create-the-regular-expression-1" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression-1">Create the Regular Expression</h3>
<p>What words can you think of that might help you to spot affordable and budget accommodation? Start with just a couple of words and then I would encourage you to consider what <em>other</em> words might help to signal â€˜affordabilityâ€™â€¦ perhaps words like â€˜cosyâ€™ or â€˜charmingâ€™ and then think about how you could you add those to the regex?</p>
<p><em>Hints</em>: this just builds on what you did above with one exception:</p>
<ol type="1">
<li>Iâ€™d try adding word boundary markers to the regex (<code>\b</code>) where appropriateâ€¦</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div id="6972897a" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'\b(?:affordable|budget|cheap|cosy)\b'</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">10466073</td>
<td>This is a charming little flat in crouch end, North London. It is located 10min from crouch end "village" which is packed with coffee shops, nice restaurants, shops etc... It is on a very quiet street and easy access to central London.&lt;br /&gt;&lt;br /...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">679538210387434496</td>
<td>This trendy and spacious 3 bed house in Bow, is ideal for people who want to experience London but without all the hustle and bustle.&lt;br /&gt;&lt;br /&gt;It is situated in a peaceful area, where the vast open space of Victoria Park is within easy reach an...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7560171</td>
<td>The spacious house offers double bedroom with ensuit bathroom, a large kitchen and cosy living room.&lt;br /&gt;This luxurious and modern apartment is located 3 mins walking from London Bridge station; walking distance from many of Londons attractions&lt;...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">721518857445429120</td>
<td>Kick back and relax in this calm, stylish one-bedroom, ground-floor flat in Leyton Village. Thereâ€™s a contemporary kitchen and cosy living room with a sofa bed. The location puts you between Leyton and Leytonstone tube stations in a quiet street ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">731014319309725184</td>
<td>Beautiful 1 bedroom apartment in the heart of Peckham, only 10 minutes walk away from Peckham Rye station with direct trains to London Victoria (15mins), London Bridge (10mins) and Clapham Junction (16mins) - bringing the whole of London to your ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apply-it-to-select-data-1" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-select-data-1">Apply it to Select Data</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>aff <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>aff<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows flagged as 'affordable'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div id="d4a329d3" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>aff <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'\b(?:affordable|budget|cheap|cosy)\b'</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>          regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>aff<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows flagged as 'affordable'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 8,937 rows flagged as 'affordable'.</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You should get <code>{python} f"{aff.shape[0]:,}"</code> rows.</p>
</section>
<section id="plot-the-data-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data-1">Plot the Data</h3>
<div id="85d4e682" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ax.remove()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The first plot</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>aff.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The second plot</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>aff.price.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Listings Advertising Affordability"</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("Affordable_Listings.png", dpi=150)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-22-output-1.png" width="757" height="568" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="questions-3" class="level3">
<h3 class="anchored" data-anchor-id="questions-3">Questions</h3>
<ul>
<li>Do you think that this is a <em>good</em> way to select affordable options?</li>
<li>Do you understand what <code>dpi</code> means and how <code>savefig</code> works?</li>
<li>Copy the code from above but modify it to constrain the histogram on a more limited distribution by <em>filtering</em> out the outliers <em>before</em> drawing the plot. I would copy the cell above to one just below here so that you keep a working copy available and can undo any changes that break things.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="near-bluespace" class="level2">
<h2 class="anchored" data-anchor-id="near-bluespace">Near Bluespace</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Medium, because youâ€™re still learning about regexes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Now see if you can work out a regular expression to find accommodation that emphasises accessibility to the Thames and other â€˜blue spacesâ€™ as part of the description? One thing youâ€™ll need to tackle is that some listings seem to say something about Thameslink and you wouldnâ€™t want those be returned as part of a regex looking for <em>rivers</em>. So by way of a hint:</p>
<ul>
<li>You probably need to think about the Thames, rivers, and water.</li>
<li>These will probably be <em>followed</em> by a qualifier like a â€˜viewâ€™ (e.g.&nbsp;Thames-view) or a front (e.g.&nbsp;water-front).</li>
<li>But you need to rule out things like â€œclose the Thameslink stationâ€¦â€</li>
</ul>
<section id="create-the-regular-expression-2" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression-2">Create the regular Expression</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span>???, flags<span class="op">=</span>???)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div id="2e1454eb" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>gdf[</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'(?:Thames|river|water|canals?)(?:-|\s+)(?: view|\s?front)\b'</span>, </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">906924808902274560</td>
<td>Brand new ultra spacious apartment just one minute walk from the Excel center and with great connections to anywhere in London.&lt;br /&gt;The area is full with cafÃ©s, supermarkets and restaurants just at your door step with lots of fun things to do li...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">600645213392859136</td>
<td>Are you a woman?&lt;br /&gt;We offer a warm and friendly, Home from home, welcome to women travellers in our, peaceful and centrally located home.&lt;br /&gt;&lt;br /&gt; Excellent location in Zone1, with river ferry, trains, tube, and buses within a 5 minute wal...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">868117243960619264</td>
<td>Just across the street from water front, near shadwell basin. View of Canary Wharf and the Shard on the big balcony&lt;br /&gt;&lt;br /&gt;7mins to shadwell overground and DLR. just 1 stop from Bank, Tower Bridge/Tower Hill, White Chapel (which connects to E...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">722937027420061056</td>
<td>Thereâ€™s no better way to experience the beauty of London City than by sleeping right in the heart of it. This Ensuite is within a 2-bed property. Ideally located at the river front to enjoy the mesmerising view of Canary Wharf.&lt;br /&gt;&lt;br /&gt;Within ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26748596</td>
<td>Welcome to Sunbury Lane in Battersea :)&lt;br /&gt;&lt;br /&gt;My house is just off the river front allowing a large, safe space from which to explore the best of South London whilst also having a bus that runs you from our road into central in just 15 minut...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apply-it-to-the-select-data" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-the-select-data">Apply it to the Select Data</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>bluesp <span class="op">=</span> gdf[</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    (gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)) <span class="op">|</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    (gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>bluesp<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div id="3428b7a4" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bluesp <span class="op">=</span> gdf[</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    (gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'(?:Thames|river|water|canals?)(?:-|\s+)(?:view|front)\b'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)) <span class="op">|</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    (gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'(?:walk|close|near) to (?:Thames|river|water|canal)'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>bluesp<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found 408 rows.</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You should get <code>{python} f"{bluesp.shape[0]:,}"</code> rows.</p>
</section>
<section id="plot-the-data-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data-2">Plot the Data</h3>
<div id="b5f213b2" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ax.remove()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The first plot</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>water.plot(edgecolor<span class="op">=</span><span class="st">'none'</span>, facecolor<span class="op">=</span>(<span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.7</span>, <span class="fl">.25</span>), ax<span class="op">=</span>ax1)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>bluesp.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The second plot</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>bluesp.price.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Bluespace Listings"</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-25-output-1.png" width="758" height="568" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="questions-4" class="level3">
<h3 class="anchored" data-anchor-id="questions-4">Questions</h3>
<ul>
<li>How else might you select listings with a view of the Thames or other bluespaces?</li>
</ul>
</section>
</section>
</section>
<section id="illustrative-text-cleaning" class="level1">
<h1>Illustrative Text Cleaning</h1>
<p>Now weâ€™re going to step through the <em>parts</em> of the process that we apply to clean and transform text. Weâ€™ll do this individually before using a function to apply them <em>all at once</em>.</p>
<section id="downloading-a-web-page" class="level2">
<h2 class="anchored" data-anchor-id="downloading-a-web-page">Downloading a Web Page</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>There is plenty of good economic geography research being done using web pages. Try using Google Scholar to look for work using the British Libraryâ€™s copy of the <em>Internet Archive</em>.</p>
<div id="f38a3de6" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.request <span class="im">import</span> urlopen, Request</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We need this so that the Bartlett web site 'knows'</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># what kind of browser it is deasling with. Otherwise</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;you get a Permission Error (403 Forbidden) because</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the site doesn't know what to do.</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>hdrs <span class="op">=</span> {</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Accept'</span>: <span class="st">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">'https://www.ucl.ac.uk/bartlett/casa/about-0'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that here we have to assemble a request and</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># then 'open' it so that the request is properly issued</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to the web server. Normally, we'd just use `urlopen`, </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># but that doesn't give you the ability to set the headers.</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>request  <span class="op">=</span> Request(url, <span class="va">None</span>, hdrs) <span class="co">#The assembled request</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> urlopen(request)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>html     <span class="op">=</span> response.???.decode(<span class="st">'utf-8'</span>) <span class="co"># The data you need</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(html[:<span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div id="bea7e323" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that here we have to assemble a request and</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># then 'open' it so that the request is properly issued</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to the web server. Normally, we'd just use `urlopen`, </span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># but that doesn't give you the ability to set the headers.</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>request  <span class="op">=</span> Request(url, <span class="va">None</span>, hdrs) <span class="co">#The assembled request</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> urlopen(request)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>html     <span class="op">=</span> response.read().decode(<span class="st">'utf-8'</span>) <span class="co"># The data you need</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(html[:<span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;!DOCTYPE html&gt;
&lt;!--[if IE 7]&gt;
&lt;html lang="en" class="lt-ie9 lt-ie8 no-js"&gt; &lt;![endif]--&gt;
&lt;!--[if IE 8]&gt;
&lt;html lang="en" class="lt-ie9 no-js"&gt; &lt;![endif]--&gt;
&lt;!--[if gt IE 8]&gt;&lt;!--&gt;
&lt;html lang="en" class="no-js"&gt; &lt;!--&lt;![endif]--&gt;
&lt;head&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"/&gt;
  &lt;meta name="author" content="UCL"/&gt;
  &lt;meta property="og:profile_id" content="uclofficial"/&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
&lt;link rel="shortcut icon" href="https://www.ucl.ac.uk/bartlett/casa/sites/all/themes/indigo/favicon.ico" type="image/vnd.microsoft.icon" /&gt;
&lt;meta name="description" content="The Centre for Advanced Spatial Analysis (CASA) is an interdisciplinary research institute focusing on the science of cities within The Bartlett Faculty of the Built Environment at UCL." /&gt;
&lt;link rel="canonical" href="https://www.ucl.ac.uk/bartlett/casa/about-0" /&gt;
&lt;meta name="ucl:faculty" content="Bartlett" /&gt;
&lt;meta name="ucl:org_unit" content="Cent</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="removing-html" class="level2">
<h2 class="anchored" data-anchor-id="removing-html">Removing HTML</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Because what weâ€™re doing will seem really strange and uses some previously unseen libraries that youâ€™ll have to google.</p>
</div>
</div>
</div>
<p><em>Hint</em>: you need to need to <strong>get the text</strong> out of the each returned <code>&lt;p&gt;</code> and <code>&lt;div&gt;</code> element! Iâ€™d suggest also commenting this up since there is a <em>lot</em> going on on some of these lines of code!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> []</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(html)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>body <span class="op">=</span> soup.find(<span class="st">'body'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> body.findChildren(recursive<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c.name <span class="kw">in</span> [<span class="st">'div'</span>,<span class="st">'p'</span>] <span class="kw">and</span> c.???.strip() <span class="op">!=</span> <span class="st">''</span>: </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># \xa0 is a non-breaking space in Unicode (&amp;nbsp; in HTML)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> [re.sub(<span class="vs">r'(?:\u202f|\xa0|\u200b)'</span>,<span class="st">' '</span>,x.strip()) <span class="cf">for</span> x <span class="kw">in</span> c.get_text(separator<span class="op">=</span><span class="st">" "</span>).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="cf">if</span> x.strip() <span class="op">!=</span> <span class="st">''</span>]</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">+=</span> txt</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div id="433e7e9d" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>cleaned <span class="op">=</span> []</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>soup <span class="op">=</span> BeautifulSoup(html)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>body <span class="op">=</span> soup.find(<span class="st">'body'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> body.findChildren(recursive<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c.name <span class="kw">in</span> [<span class="st">'div'</span>,<span class="st">'p'</span>] <span class="kw">and</span> c.get_text().strip() <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># \xa0 is a non-breaking space in Unicode (&amp;nbsp; in HTML)</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> [re.sub(<span class="vs">r'(?:\u202f|\xa0|\u200b)'</span>,<span class="st">' '</span>,x.strip()) <span class="cf">for</span> x <span class="kw">in</span> c.get_text(separator<span class="op">=</span><span class="st">" "</span>).split(<span class="st">'</span><span class="ch">\n</span><span class="st">'</span>) <span class="cf">if</span> x.strip() <span class="op">!=</span> <span class="st">''</span>]</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        cleaned <span class="op">+=</span> txt</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>cleaned</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>['UCL Home The Bartlett Centre for Advanced Spatial Analysis About',
 'About',
 'The Centre for Advanced Spatial Analysis (CASA) is an interdisciplinary research institute focusing on the science of cities within The Bartlett Faculty of the Built Environment at UCL.',
 'The Centre for Advanced Spatial Analysis (CASA) was established in 1995 to lead the development of a science of cities drawing upon methods and ideas in modelling and data science, sensing the urban environment, visualisation and computation.  Today, CASAâ€™s research is still pushing boundaries to create better cities for everyone, both leading the intellectual agenda and working closely with government and industry partners to make real-world impact.  Our teaching reflects this, making the most of our cutting-edge research, tools, new forms of data, and long-standing non-academic partnerships to train the next generation of urban scientists with the skills and ideas theyâ€™ll need to have an impact in industry, government, academia, and the third sector.  The CASA community is closely connected, but strongly interdisciplinary. We bring together people from around the world with a unique variety of backgrounds â€“ including physicists, planners, geographers, economists, data scientists, architects, mathematicians and computer scientists â€“ united by our mission to tackle the biggest challenges facing cities and societies around the world.  We work across multiple scales: from the hyper-local environment of the low-powered sensor all the way up to satellite remote sensing of whole countries and regions.  Studying at CASA brings lifelong value, with our students poised to take on leadership and integration roles at the forefront of urban and spatial data science.  By studying with us you will become part of our active and engaged alumni community, with access to job listings, networking and social activities, as well as continued contact with our outstanding teachers and researchers.   Location The UCL Centre for Advanced Spatial Analysis is located at 90 Tottenham Court Road, London, W1T 4TJ.',
 'View Map',
 'Contact Address: UCL Centre for Advanced Spatial Analysis First Floor, 90 Tottenham Court Road London W1T 4TJ Telephone:  +44 (0)20 3108 3877 Email:   casa@ucl.ac.uk',
 'Tweets by CASAUCL']</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="lower-case" class="level2">
<h2 class="anchored" data-anchor-id="lower-case">Lower Case</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> [c.???() <span class="cf">for</span> ??? <span class="kw">in</span> cleaned]</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>lower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div id="5313b564" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>lower <span class="op">=</span> [s.lower() <span class="cf">for</span> s <span class="kw">in</span> cleaned]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>lower</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>['ucl home the bartlett centre for advanced spatial analysis about',
 'about',
 'the centre for advanced spatial analysis (casa) is an interdisciplinary research institute focusing on the science of cities within the bartlett faculty of the built environment at ucl.',
 'the centre for advanced spatial analysis (casa) was established in 1995 to lead the development of a science of cities drawing upon methods and ideas in modelling and data science, sensing the urban environment, visualisation and computation.  today, casaâ€™s research is still pushing boundaries to create better cities for everyone, both leading the intellectual agenda and working closely with government and industry partners to make real-world impact.  our teaching reflects this, making the most of our cutting-edge research, tools, new forms of data, and long-standing non-academic partnerships to train the next generation of urban scientists with the skills and ideas theyâ€™ll need to have an impact in industry, government, academia, and the third sector.  the casa community is closely connected, but strongly interdisciplinary. we bring together people from around the world with a unique variety of backgrounds â€“ including physicists, planners, geographers, economists, data scientists, architects, mathematicians and computer scientists â€“ united by our mission to tackle the biggest challenges facing cities and societies around the world.  we work across multiple scales: from the hyper-local environment of the low-powered sensor all the way up to satellite remote sensing of whole countries and regions.  studying at casa brings lifelong value, with our students poised to take on leadership and integration roles at the forefront of urban and spatial data science.  by studying with us you will become part of our active and engaged alumni community, with access to job listings, networking and social activities, as well as continued contact with our outstanding teachers and researchers.   location the ucl centre for advanced spatial analysis is located at 90 tottenham court road, london, w1t 4tj.',
 'view map',
 'contact address: ucl centre for advanced spatial analysis first floor, 90 tottenham court road london w1t 4tj telephone:  +44 (0)20 3108 3877 email:   casa@ucl.ac.uk',
 'tweets by casaucl']</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="stripping-punctuation" class="level2">
<h2 class="anchored" data-anchor-id="stripping-punctuation">Stripping â€˜Punctuationâ€™</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Hard
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is because you need to understand: 1) why weâ€™re <em>compiling</em> the regular expression and how to use character classes; and 2) how the NLTK tokenizer differs in approach to the regex.</p>
</div>
</div>
</div>
<section id="regular-expression-approach" class="level3">
<h3 class="anchored" data-anchor-id="regular-expression-approach">Regular Expression Approach</h3>
<p>We want to clear out punctuation using a regex that takes advantage of the <code>[...]</code> (character class) syntax. The really tricky part is remembering how to specify the â€˜punctuationâ€™ when some of that punctuation has â€˜specialâ€™ meanings in a regular expression context. For instance, <code>.</code> means â€˜any characterâ€™, while <code>[</code> and <code>]</code> mean â€˜character classâ€™. So this is another <em>escaping</em> problem and it works the <em>same</em> way it did when we were dealing with the Terminalâ€¦</p>
<p><em>Hints</em>: some other factorsâ€¦</p>
<ol type="1">
<li>You will want to match more than one piece of punctuation at a time, so Iâ€™d suggest add a <code>+</code> to your pattern.</li>
<li>You will need to look into <em>metacharacters</em> for creating a kind of â€˜any of the characters <em>in this class</em>â€™ bag of possible matches.</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r'[???]+'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div id="29e4a438" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r'[,\.!\-&gt;&lt;=\(\)\[\]\/&amp;\'\"â€™;\+\â€“\â€”]+'</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>re.compile('[,\\.!\\-&gt;&lt;=\\(\\)\\[\\]\\/&amp;\\\'\\"â€™;\\+\\â€“\\â€”]+')</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="tokenizer" class="level3">
<h3 class="anchored" data-anchor-id="tokenizer">Tokenizer</h3>
<p>The other way to do this, which is probably <em>easier</em> but produces more complex output, is to draw on the tokenizers <a href="https://www.nltk.org/api/nltk.tokenize.html">already provided by NLTK</a>. For our purposes <code>word_tokenize</code> is probably fine, but depending on your needs there are other options and you can also write your own.</p>
<div id="d4fda0a7" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'punkt'</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'wordnet'</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> word_tokenize</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(word_tokenize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;function word_tokenize at 0x3112ee160&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[nltk_data] Downloading package punkt to /Users/jreades/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package wordnet to /Users/jreades/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!</code></pre>
</div>
</div>
</section>
<section id="compare" class="level3">
<h3 class="anchored" data-anchor-id="compare">Compare</h3>
<p>Look at how these outputs differ in subtle ways:</p>
<div id="9667d17a" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>subbed <span class="op">=</span> []</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="op">=</span> []</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lower:</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    subbed.append(re.sub(pattern, <span class="st">' '</span>, l))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    tokens.append(word_tokenize(l))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> subbed:</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">"Substituted"</span>, s)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> tokens:</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">"Tokenised"</span>, t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="substituted" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted">Substituted</h5>
<blockquote class="blockquote">
<p>ucl home the bartlett centre for advanced spatial analysis about</p>
</blockquote>
</section>
<section id="substituted-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-1">Substituted</h5>
<blockquote class="blockquote">
<p>about</p>
</blockquote>
</section>
<section id="substituted-2" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-2">Substituted</h5>
<blockquote class="blockquote">
<p>the centre for advanced spatial analysis casa is an interdisciplinary research institute focusing on the science of cities within the bartlett faculty of the built environment at ucl</p>
</blockquote>
</section>
<section id="substituted-3" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-3">Substituted</h5>
<blockquote class="blockquote">
<p>the centre for advanced spatial analysis casa was established in 1995 to lead the development of a science of cities drawing upon methods and ideas in modelling and data science sensing the urban environment visualisation and computation today casa s research is still pushing boundaries to create better cities for everyone both leading the intellectual agenda and working closely with government and industry partners to make real world impact our teaching reflects this making the most of our cutting edge research tools new forms of data and long standing non academic partnerships to train the next generation of urban scientists with the skills and ideas they ll need to have an impact in industry government academia and the third sector the casa community is closely connected but strongly interdisciplinary we bring together people from around the world with a unique variety of backgrounds including physicists planners geographers economists data scientists architects mathematicians and computer scientists united by our mission to tackle the biggest challenges facing cities and societies around the world we work across multiple scales: from the hyper local environment of the low powered sensor all the way up to satellite remote sensing of whole countries and regions studying at casa brings lifelong value with our students poised to take on leadership and integration roles at the forefront of urban and spatial data science by studying with us you will become part of our active and engaged alumni community with access to job listings networking and social activities as well as continued contact with our outstanding teachers and researchers location the ucl centre for advanced spatial analysis is located at 90 tottenham court road london w1t 4tj</p>
</blockquote>
</section>
<section id="substituted-4" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-4">Substituted</h5>
<blockquote class="blockquote">
<p>view map</p>
</blockquote>
</section>
<section id="substituted-5" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-5">Substituted</h5>
<blockquote class="blockquote">
<p>contact address: ucl centre for advanced spatial analysis first floor 90 tottenham court road london w1t 4tj telephone: 44 0 20 3108 3877 email: casa@ucl ac uk</p>
</blockquote>
</section>
<section id="substituted-6" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="substituted-6">Substituted</h5>
<blockquote class="blockquote">
<p>tweets by casaucl</p>
</blockquote>
</section>
<section id="tokenised" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜uclâ€™, â€˜homeâ€™, â€˜theâ€™, â€˜bartlettâ€™, â€˜centreâ€™, â€˜forâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜aboutâ€™]</p>
</blockquote>
</section>
<section id="tokenised-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-1">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜aboutâ€™]</p>
</blockquote>
</section>
<section id="tokenised-2" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-2">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜theâ€™, â€˜centreâ€™, â€˜forâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜(â€™, â€˜casaâ€™, â€˜)â€™, â€˜isâ€™, â€˜anâ€™, â€˜interdisciplinaryâ€™, â€˜researchâ€™, â€˜instituteâ€™, â€˜focusingâ€™, â€˜onâ€™, â€˜theâ€™, â€˜scienceâ€™, â€˜ofâ€™, â€˜citiesâ€™, â€˜withinâ€™, â€˜theâ€™, â€˜bartlettâ€™, â€˜facultyâ€™, â€˜ofâ€™, â€˜theâ€™, â€˜builtâ€™, â€˜environmentâ€™, â€˜atâ€™, â€˜uclâ€™, â€˜.â€™]</p>
</blockquote>
</section>
<section id="tokenised-3" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-3">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜theâ€™, â€˜centreâ€™, â€˜forâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜(â€™, â€˜casaâ€™, â€˜)â€™, â€˜wasâ€™, â€˜establishedâ€™, â€˜inâ€™, â€˜1995â€™, â€˜toâ€™, â€˜leadâ€™, â€˜theâ€™, â€˜developmentâ€™, â€˜ofâ€™, â€˜aâ€™, â€˜scienceâ€™, â€˜ofâ€™, â€˜citiesâ€™, â€˜drawingâ€™, â€˜uponâ€™, â€˜methodsâ€™, â€˜andâ€™, â€˜ideasâ€™, â€˜inâ€™, â€˜modellingâ€™, â€˜andâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜,â€™, â€˜sensingâ€™, â€˜theâ€™, â€˜urbanâ€™, â€˜environmentâ€™, â€˜,â€™, â€˜visualisationâ€™, â€˜andâ€™, â€˜computationâ€™, â€˜.â€™, â€˜todayâ€™, â€˜,â€™, â€˜casaâ€™, â€™â€™â€˜, â€™sâ€™, â€˜researchâ€™, â€˜isâ€™, â€˜stillâ€™, â€˜pushingâ€™, â€˜boundariesâ€™, â€˜toâ€™, â€˜createâ€™, â€˜betterâ€™, â€˜citiesâ€™, â€˜forâ€™, â€˜everyoneâ€™, â€˜,â€™, â€˜bothâ€™, â€˜leadingâ€™, â€˜theâ€™, â€˜intellectualâ€™, â€˜agendaâ€™, â€˜andâ€™, â€˜workingâ€™, â€˜closelyâ€™, â€˜withâ€™, â€˜governmentâ€™, â€˜andâ€™, â€˜industryâ€™, â€˜partnersâ€™, â€˜toâ€™, â€˜makeâ€™, â€˜real-worldâ€™, â€˜impactâ€™, â€˜.â€™, â€˜ourâ€™, â€˜teachingâ€™, â€˜reflectsâ€™, â€˜thisâ€™, â€˜,â€™, â€˜makingâ€™, â€˜theâ€™, â€˜mostâ€™, â€˜ofâ€™, â€˜ourâ€™, â€˜cutting-edgeâ€™, â€˜researchâ€™, â€˜,â€™, â€˜toolsâ€™, â€˜,â€™, â€˜newâ€™, â€˜formsâ€™, â€˜ofâ€™, â€˜dataâ€™, â€˜,â€™, â€˜andâ€™, â€˜long-standingâ€™, â€˜non-academicâ€™, â€˜partnershipsâ€™, â€˜toâ€™, â€˜trainâ€™, â€˜theâ€™, â€˜nextâ€™, â€˜generationâ€™, â€˜ofâ€™, â€˜urbanâ€™, â€˜scientistsâ€™, â€˜withâ€™, â€˜theâ€™, â€˜skillsâ€™, â€˜andâ€™, â€˜ideasâ€™, â€˜theyâ€™, â€™â€™â€˜, â€™llâ€™, â€˜needâ€™, â€˜toâ€™, â€˜haveâ€™, â€˜anâ€™, â€˜impactâ€™, â€˜inâ€™, â€˜industryâ€™, â€˜,â€™, â€˜governmentâ€™, â€˜,â€™, â€˜academiaâ€™, â€˜,â€™, â€˜andâ€™, â€˜theâ€™, â€˜thirdâ€™, â€˜sectorâ€™, â€˜.â€™, â€˜theâ€™, â€˜casaâ€™, â€˜communityâ€™, â€˜isâ€™, â€˜closelyâ€™, â€˜connectedâ€™, â€˜,â€™, â€˜butâ€™, â€˜stronglyâ€™, â€˜interdisciplinaryâ€™, â€˜.â€™, â€˜weâ€™, â€˜bringâ€™, â€˜togetherâ€™, â€˜peopleâ€™, â€˜fromâ€™, â€˜aroundâ€™, â€˜theâ€™, â€˜worldâ€™, â€˜withâ€™, â€˜aâ€™, â€˜uniqueâ€™, â€˜varietyâ€™, â€˜ofâ€™, â€˜backgroundsâ€™, â€˜â€“â€™, â€˜includingâ€™, â€˜physicistsâ€™, â€˜,â€™, â€˜plannersâ€™, â€˜,â€™, â€˜geographersâ€™, â€˜,â€™, â€˜economistsâ€™, â€˜,â€™, â€˜dataâ€™, â€˜scientistsâ€™, â€˜,â€™, â€˜architectsâ€™, â€˜,â€™, â€˜mathematiciansâ€™, â€˜andâ€™, â€˜computerâ€™, â€˜scientistsâ€™, â€˜â€“â€™, â€˜unitedâ€™, â€˜byâ€™, â€˜ourâ€™, â€˜missionâ€™, â€˜toâ€™, â€˜tackleâ€™, â€˜theâ€™, â€˜biggestâ€™, â€˜challengesâ€™, â€˜facingâ€™, â€˜citiesâ€™, â€˜andâ€™, â€˜societiesâ€™, â€˜aroundâ€™, â€˜theâ€™, â€˜worldâ€™, â€˜.â€™, â€˜weâ€™, â€˜workâ€™, â€˜acrossâ€™, â€˜multipleâ€™, â€˜scalesâ€™, â€˜:â€™, â€˜fromâ€™, â€˜theâ€™, â€˜hyper-localâ€™, â€˜environmentâ€™, â€˜ofâ€™, â€˜theâ€™, â€˜low-poweredâ€™, â€˜sensorâ€™, â€˜allâ€™, â€˜theâ€™, â€˜wayâ€™, â€˜upâ€™, â€˜toâ€™, â€˜satelliteâ€™, â€˜remoteâ€™, â€˜sensingâ€™, â€˜ofâ€™, â€˜wholeâ€™, â€˜countriesâ€™, â€˜andâ€™, â€˜regionsâ€™, â€˜.â€™, â€˜studyingâ€™, â€˜atâ€™, â€˜casaâ€™, â€˜bringsâ€™, â€˜lifelongâ€™, â€˜valueâ€™, â€˜,â€™, â€˜withâ€™, â€˜ourâ€™, â€˜studentsâ€™, â€˜poisedâ€™, â€˜toâ€™, â€˜takeâ€™, â€˜onâ€™, â€˜leadershipâ€™, â€˜andâ€™, â€˜integrationâ€™, â€˜rolesâ€™, â€˜atâ€™, â€˜theâ€™, â€˜forefrontâ€™, â€˜ofâ€™, â€˜urbanâ€™, â€˜andâ€™, â€˜spatialâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜.â€™, â€˜byâ€™, â€˜studyingâ€™, â€˜withâ€™, â€˜usâ€™, â€˜youâ€™, â€˜willâ€™, â€˜becomeâ€™, â€˜partâ€™, â€˜ofâ€™, â€˜ourâ€™, â€˜activeâ€™, â€˜andâ€™, â€˜engagedâ€™, â€˜alumniâ€™, â€˜communityâ€™, â€˜,â€™, â€˜withâ€™, â€˜accessâ€™, â€˜toâ€™, â€˜jobâ€™, â€˜listingsâ€™, â€˜,â€™, â€˜networkingâ€™, â€˜andâ€™, â€˜socialâ€™, â€˜activitiesâ€™, â€˜,â€™, â€˜asâ€™, â€˜wellâ€™, â€˜asâ€™, â€˜continuedâ€™, â€˜contactâ€™, â€˜withâ€™, â€˜ourâ€™, â€˜outstandingâ€™, â€˜teachersâ€™, â€˜andâ€™, â€˜researchersâ€™, â€˜.â€™, â€˜locationâ€™, â€˜theâ€™, â€˜uclâ€™, â€˜centreâ€™, â€˜forâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜isâ€™, â€˜locatedâ€™, â€˜atâ€™, â€˜90â€™, â€˜tottenhamâ€™, â€˜courtâ€™, â€˜roadâ€™, â€˜,â€™, â€˜londonâ€™, â€˜,â€™, â€˜w1tâ€™, â€˜4tjâ€™, â€˜.â€™]</p>
</blockquote>
</section>
<section id="tokenised-4" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-4">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜viewâ€™, â€˜mapâ€™]</p>
</blockquote>
</section>
<section id="tokenised-5" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-5">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜contactâ€™, â€˜addressâ€™, â€˜:â€™, â€˜uclâ€™, â€˜centreâ€™, â€˜forâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜firstâ€™, â€˜floorâ€™, â€˜,â€™, â€˜90â€™, â€˜tottenhamâ€™, â€˜courtâ€™, â€˜roadâ€™, â€˜londonâ€™, â€˜w1tâ€™, â€˜4tjâ€™, â€˜telephoneâ€™, â€˜:â€™, â€˜+44â€™, â€˜(â€™, â€˜0â€™, â€˜)â€™, â€˜20â€™, â€˜3108â€™, â€˜3877â€™, â€˜emailâ€™, â€˜:â€™, â€˜casaâ€™, â€˜@â€™, â€˜ucl.ac.ukâ€™]</p>
</blockquote>
</section>
<section id="tokenised-6" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="tokenised-6">Tokenised</h5>
<blockquote class="blockquote">
<p>[â€˜tweetsâ€™, â€˜byâ€™, â€˜casauclâ€™]</p>
</blockquote>
</section>
</div>
</section>
</section>
<section id="stopword-removal" class="level2">
<h2 class="anchored" data-anchor-id="stopword-removal">Stopword Removal</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You need to remember how list comprehensions work to use the <code>stopword_list</code>.</p>
</div>
</div>
</div>
<div id="5000c572" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>stopword_list <span class="op">=</span> <span class="bu">set</span>(stopwords.words(<span class="st">'english'</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stopword_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'our', 'before', 'does', 't', 'was', 'not', 'or', 'himself', 'more', 'i', 'y', 'has', 'wouldn', 'themselves', 'each', "you'll", 'such', "needn't", 'and', 'then', 'as', 'o', 'over', 'is', 'did', 'up', 'be', 'me', 'were', "you'd", "haven't", "wouldn't", 'them', 'about', 'down', "mustn't", 'do', 'hasn', 'mustn', 'can', 'those', 'again', 'it', 'if', 'they', "hadn't", "wasn't", 'few', 'so', 'an', 'should', 'myself', 'here', 'very', 'the', 'until', 'why', 'you', 'ma', 'been', 'mightn', 'than', 'yourself', 'all', 'at', 'no', 'of', 'into', 'out', "don't", "weren't", "won't", "should've", 'aren', 'after', 'their', "that'll", 'needn', "mightn't", 've', "doesn't", "it's", 'am', "she's", 'its', 'she', 'above', 'for', 'wasn', 'that', 'yours', 'whom', 'm', 'a', 'who', 'on', 'from', 'his', 'below', 'just', 'will', 'isn', 'he', 'nor', 'couldn', 'which', 'how', 'shan', 'while', 's', 'll', 'ourselves', 'had', 'off', "isn't", 'against', 'don', 'being', 'itself', 'shouldn', 'these', 'having', 'both', 'ours', 'doesn', 'theirs', 'we', "shan't", 'won', 'yourselves', 'there', 'through', 'by', 'have', "didn't", 'what', 'with', 'in', 'ain', 'same', 'because', 'once', 'where', 'weren', 'most', 'any', 'between', 'only', 'to', "couldn't", 'him', 'didn', 'd', "you've", 're', 'other', 'this', "you're", 'now', "aren't", 'hers', 'my', "hasn't", 'but', 'further', 'some', 'haven', 'hadn', 'doing', 'your', 'too', 'herself', 'own', 'under', 'are', 'during', 'when', "shouldn't", 'her'}</code></pre>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>stopped <span class="op">=</span> []</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> tokens[<span class="dv">2</span>:<span class="dv">4</span>]: <span class="co"># &lt;-- why do I just take these items from the list?</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    stopped.append([x <span class="cf">for</span> x <span class="kw">in</span> p <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> ??? <span class="kw">and</span> <span class="bu">len</span>(x) <span class="op">&gt;</span> <span class="dv">1</span>])</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> stopped:</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">"Line"</span>, s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div id="4b10b3fa" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>stopped <span class="op">=</span> []</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> tokens[<span class="dv">2</span>:<span class="dv">4</span>]: <span class="co"># &lt;-- why do I just take these items from the list?</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    stopped.append([x <span class="cf">for</span> x <span class="kw">in</span> p <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> stopword_list <span class="kw">and</span> <span class="bu">len</span>(x) <span class="op">&gt;</span> <span class="dv">1</span>])</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> stopped:</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">"Line"</span>, s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="line" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="line">Line</h5>
<blockquote class="blockquote">
<p>[â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜casaâ€™, â€˜interdisciplinaryâ€™, â€˜researchâ€™, â€˜instituteâ€™, â€˜focusingâ€™, â€˜scienceâ€™, â€˜citiesâ€™, â€˜withinâ€™, â€˜bartlettâ€™, â€˜facultyâ€™, â€˜builtâ€™, â€˜environmentâ€™, â€˜uclâ€™]</p>
</blockquote>
</section>
<section id="line-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="line-1">Line</h5>
<blockquote class="blockquote">
<p>[â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜casaâ€™, â€˜establishedâ€™, â€˜1995â€™, â€˜leadâ€™, â€˜developmentâ€™, â€˜scienceâ€™, â€˜citiesâ€™, â€˜drawingâ€™, â€˜uponâ€™, â€˜methodsâ€™, â€˜ideasâ€™, â€˜modellingâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜sensingâ€™, â€˜urbanâ€™, â€˜environmentâ€™, â€˜visualisationâ€™, â€˜computationâ€™, â€˜todayâ€™, â€˜casaâ€™, â€˜researchâ€™, â€˜stillâ€™, â€˜pushingâ€™, â€˜boundariesâ€™, â€˜createâ€™, â€˜betterâ€™, â€˜citiesâ€™, â€˜everyoneâ€™, â€˜leadingâ€™, â€˜intellectualâ€™, â€˜agendaâ€™, â€˜workingâ€™, â€˜closelyâ€™, â€˜governmentâ€™, â€˜industryâ€™, â€˜partnersâ€™, â€˜makeâ€™, â€˜real-worldâ€™, â€˜impactâ€™, â€˜teachingâ€™, â€˜reflectsâ€™, â€˜makingâ€™, â€˜cutting-edgeâ€™, â€˜researchâ€™, â€˜toolsâ€™, â€˜newâ€™, â€˜formsâ€™, â€˜dataâ€™, â€˜long-standingâ€™, â€˜non-academicâ€™, â€˜partnershipsâ€™, â€˜trainâ€™, â€˜nextâ€™, â€˜generationâ€™, â€˜urbanâ€™, â€˜scientistsâ€™, â€˜skillsâ€™, â€˜ideasâ€™, â€˜needâ€™, â€˜impactâ€™, â€˜industryâ€™, â€˜governmentâ€™, â€˜academiaâ€™, â€˜thirdâ€™, â€˜sectorâ€™, â€˜casaâ€™, â€˜communityâ€™, â€˜closelyâ€™, â€˜connectedâ€™, â€˜stronglyâ€™, â€˜interdisciplinaryâ€™, â€˜bringâ€™, â€˜togetherâ€™, â€˜peopleâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜uniqueâ€™, â€˜varietyâ€™, â€˜backgroundsâ€™, â€˜includingâ€™, â€˜physicistsâ€™, â€˜plannersâ€™, â€˜geographersâ€™, â€˜economistsâ€™, â€˜dataâ€™, â€˜scientistsâ€™, â€˜architectsâ€™, â€˜mathematiciansâ€™, â€˜computerâ€™, â€˜scientistsâ€™, â€˜unitedâ€™, â€˜missionâ€™, â€˜tackleâ€™, â€˜biggestâ€™, â€˜challengesâ€™, â€˜facingâ€™, â€˜citiesâ€™, â€˜societiesâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜workâ€™, â€˜acrossâ€™, â€˜multipleâ€™, â€˜scalesâ€™, â€˜hyper-localâ€™, â€˜environmentâ€™, â€˜low-poweredâ€™, â€˜sensorâ€™, â€˜wayâ€™, â€˜satelliteâ€™, â€˜remoteâ€™, â€˜sensingâ€™, â€˜wholeâ€™, â€˜countriesâ€™, â€˜regionsâ€™, â€˜studyingâ€™, â€˜casaâ€™, â€˜bringsâ€™, â€˜lifelongâ€™, â€˜valueâ€™, â€˜studentsâ€™, â€˜poisedâ€™, â€˜takeâ€™, â€˜leadershipâ€™, â€˜integrationâ€™, â€˜rolesâ€™, â€˜forefrontâ€™, â€˜urbanâ€™, â€˜spatialâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜studyingâ€™, â€˜usâ€™, â€˜becomeâ€™, â€˜partâ€™, â€˜activeâ€™, â€˜engagedâ€™, â€˜alumniâ€™, â€˜communityâ€™, â€˜accessâ€™, â€˜jobâ€™, â€˜listingsâ€™, â€˜networkingâ€™, â€˜socialâ€™, â€˜activitiesâ€™, â€˜wellâ€™, â€˜continuedâ€™, â€˜contactâ€™, â€˜outstandingâ€™, â€˜teachersâ€™, â€˜researchersâ€™, â€˜locationâ€™, â€˜uclâ€™, â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜locatedâ€™, â€˜90â€™, â€˜tottenhamâ€™, â€˜courtâ€™, â€˜roadâ€™, â€˜londonâ€™, â€˜w1tâ€™, â€˜4tjâ€™]</p>
</blockquote>
</section>
</div>
</div>
</div>
</div>
</section>
<section id="lemmatisation-vs-stemming" class="level2">
<h2 class="anchored" data-anchor-id="lemmatisation-vs-stemming">Lemmatisation vs Stemming</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div id="6923bc7f" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.porter <span class="im">import</span> PorterStemmer</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.snowball <span class="im">import</span> SnowballStemmer</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem.wordnet <span class="im">import</span> WordNetLemmatizer </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7eba7e4e" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lemmatizer.lemmatize(<span class="st">'monkeys'</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lemmatizer.lemmatize(<span class="st">'cities'</span>))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lemmatizer.lemmatize(<span class="st">'complexity'</span>))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lemmatizer.lemmatize(<span class="st">'Reades'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>monkey
city
complexity
Reades</code></pre>
</div>
</div>
<div id="8b9404a9" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>stemmer <span class="op">=</span> PorterStemmer()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'monkeys'</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'cities'</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'complexity'</span>))</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'Reades'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>monkey
citi
complex
read</code></pre>
</div>
</div>
<div id="b6ffdf5a" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>stemmer <span class="op">=</span> SnowballStemmer(language<span class="op">=</span><span class="st">'english'</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'monkeys'</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'cities'</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'complexity'</span>))</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(stemmer.stem(<span class="st">'Reades'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>monkey
citi
complex
read</code></pre>
</div>
</div>
<div id="4ca9fde7" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>lemmas  <span class="op">=</span> []</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>stemmed <span class="op">=</span> []</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This would be better if we passed in a PoS (Part of Speech) tag as well,</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># but processing text for parts of speech is *expensive* and for the purposes</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># of this tutorial, not necessary.</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> stopped:</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    lemmas.append([lemmatizer.lemmatize(x) <span class="cf">for</span> x <span class="kw">in</span> s])</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> stopped:</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    stemmed.append([stemmer.stem(x) <span class="cf">for</span> x <span class="kw">in</span> s])</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> l <span class="kw">in</span> lemmas:</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">'Lemmatised'</span>,l)</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> stemmed:</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">'Stemmed'</span>,s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="lemmatised" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="lemmatised">Lemmatised</h5>
<blockquote class="blockquote">
<p>[â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜casaâ€™, â€˜interdisciplinaryâ€™, â€˜researchâ€™, â€˜instituteâ€™, â€˜focusingâ€™, â€˜scienceâ€™, â€˜cityâ€™, â€˜withinâ€™, â€˜bartlettâ€™, â€˜facultyâ€™, â€˜builtâ€™, â€˜environmentâ€™, â€˜uclâ€™]</p>
</blockquote>
</section>
<section id="lemmatised-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="lemmatised-1">Lemmatised</h5>
<blockquote class="blockquote">
<p>[â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜casaâ€™, â€˜establishedâ€™, â€˜1995â€™, â€˜leadâ€™, â€˜developmentâ€™, â€˜scienceâ€™, â€˜cityâ€™, â€˜drawingâ€™, â€˜uponâ€™, â€˜methodâ€™, â€˜ideaâ€™, â€˜modellingâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜sensingâ€™, â€˜urbanâ€™, â€˜environmentâ€™, â€˜visualisationâ€™, â€˜computationâ€™, â€˜todayâ€™, â€˜casaâ€™, â€˜researchâ€™, â€˜stillâ€™, â€˜pushingâ€™, â€˜boundaryâ€™, â€˜createâ€™, â€˜betterâ€™, â€˜cityâ€™, â€˜everyoneâ€™, â€˜leadingâ€™, â€˜intellectualâ€™, â€˜agendaâ€™, â€˜workingâ€™, â€˜closelyâ€™, â€˜governmentâ€™, â€˜industryâ€™, â€˜partnerâ€™, â€˜makeâ€™, â€˜real-worldâ€™, â€˜impactâ€™, â€˜teachingâ€™, â€˜reflectsâ€™, â€˜makingâ€™, â€˜cutting-edgeâ€™, â€˜researchâ€™, â€˜toolâ€™, â€˜newâ€™, â€˜formâ€™, â€˜dataâ€™, â€˜long-standingâ€™, â€˜non-academicâ€™, â€˜partnershipâ€™, â€˜trainâ€™, â€˜nextâ€™, â€˜generationâ€™, â€˜urbanâ€™, â€˜scientistâ€™, â€˜skillâ€™, â€˜ideaâ€™, â€˜needâ€™, â€˜impactâ€™, â€˜industryâ€™, â€˜governmentâ€™, â€˜academiaâ€™, â€˜thirdâ€™, â€˜sectorâ€™, â€˜casaâ€™, â€˜communityâ€™, â€˜closelyâ€™, â€˜connectedâ€™, â€˜stronglyâ€™, â€˜interdisciplinaryâ€™, â€˜bringâ€™, â€˜togetherâ€™, â€˜peopleâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜uniqueâ€™, â€˜varietyâ€™, â€˜backgroundâ€™, â€˜includingâ€™, â€˜physicistâ€™, â€˜plannerâ€™, â€˜geographerâ€™, â€˜economistâ€™, â€˜dataâ€™, â€˜scientistâ€™, â€˜architectâ€™, â€˜mathematicianâ€™, â€˜computerâ€™, â€˜scientistâ€™, â€˜unitedâ€™, â€˜missionâ€™, â€˜tackleâ€™, â€˜biggestâ€™, â€˜challengeâ€™, â€˜facingâ€™, â€˜cityâ€™, â€˜societyâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜workâ€™, â€˜acrossâ€™, â€˜multipleâ€™, â€˜scaleâ€™, â€˜hyper-localâ€™, â€˜environmentâ€™, â€˜low-poweredâ€™, â€˜sensorâ€™, â€˜wayâ€™, â€˜satelliteâ€™, â€˜remoteâ€™, â€˜sensingâ€™, â€˜wholeâ€™, â€˜countryâ€™, â€˜regionâ€™, â€˜studyingâ€™, â€˜casaâ€™, â€˜bringsâ€™, â€˜lifelongâ€™, â€˜valueâ€™, â€˜studentâ€™, â€˜poisedâ€™, â€˜takeâ€™, â€˜leadershipâ€™, â€˜integrationâ€™, â€˜roleâ€™, â€˜forefrontâ€™, â€˜urbanâ€™, â€˜spatialâ€™, â€˜dataâ€™, â€˜scienceâ€™, â€˜studyingâ€™, â€˜uâ€™, â€˜becomeâ€™, â€˜partâ€™, â€˜activeâ€™, â€˜engagedâ€™, â€˜alumnusâ€™, â€˜communityâ€™, â€˜accessâ€™, â€˜jobâ€™, â€˜listingâ€™, â€˜networkingâ€™, â€˜socialâ€™, â€˜activityâ€™, â€˜wellâ€™, â€˜continuedâ€™, â€˜contactâ€™, â€˜outstandingâ€™, â€˜teacherâ€™, â€˜researcherâ€™, â€˜locationâ€™, â€˜uclâ€™, â€˜centreâ€™, â€˜advancedâ€™, â€˜spatialâ€™, â€˜analysisâ€™, â€˜locatedâ€™, â€˜90â€™, â€˜tottenhamâ€™, â€˜courtâ€™, â€˜roadâ€™, â€˜londonâ€™, â€˜w1tâ€™, â€˜4tjâ€™]</p>
</blockquote>
</section>
<section id="stemmed" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stemmed">Stemmed</h5>
<blockquote class="blockquote">
<p>[â€˜centrâ€™, â€˜advancâ€™, â€˜spatialâ€™, â€˜analysiâ€™, â€˜casaâ€™, â€˜interdisciplinariâ€™, â€˜researchâ€™, â€˜institutâ€™, â€˜focusâ€™, â€˜sciencâ€™, â€˜citiâ€™, â€˜withinâ€™, â€˜bartlettâ€™, â€˜facultiâ€™, â€˜builtâ€™, â€˜environâ€™, â€˜uclâ€™]</p>
</blockquote>
</section>
<section id="stemmed-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stemmed-1">Stemmed</h5>
<blockquote class="blockquote">
<p>[â€˜centrâ€™, â€˜advancâ€™, â€˜spatialâ€™, â€˜analysiâ€™, â€˜casaâ€™, â€˜establishâ€™, â€˜1995â€™, â€˜leadâ€™, â€˜developâ€™, â€˜sciencâ€™, â€˜citiâ€™, â€˜drawâ€™, â€˜uponâ€™, â€˜methodâ€™, â€˜ideaâ€™, â€˜modelâ€™, â€˜dataâ€™, â€˜sciencâ€™, â€˜sensâ€™, â€˜urbanâ€™, â€˜environâ€™, â€˜visualisâ€™, â€˜computâ€™, â€˜todayâ€™, â€˜casaâ€™, â€˜researchâ€™, â€˜stillâ€™, â€˜pushâ€™, â€˜boundariâ€™, â€˜creatâ€™, â€˜betterâ€™, â€˜citiâ€™, â€˜everyonâ€™, â€˜leadâ€™, â€˜intellectuâ€™, â€˜agendaâ€™, â€˜workâ€™, â€˜closeâ€™, â€˜governâ€™, â€˜industriâ€™, â€˜partnerâ€™, â€˜makeâ€™, â€˜real-worldâ€™, â€˜impactâ€™, â€˜teachâ€™, â€˜reflectâ€™, â€˜makeâ€™, â€˜cutting-edgâ€™, â€˜researchâ€™, â€˜toolâ€™, â€˜newâ€™, â€˜formâ€™, â€˜dataâ€™, â€˜long-standâ€™, â€˜non-academâ€™, â€˜partnershipâ€™, â€˜trainâ€™, â€˜nextâ€™, â€˜generatâ€™, â€˜urbanâ€™, â€˜scientistâ€™, â€˜skillâ€™, â€˜ideaâ€™, â€˜needâ€™, â€˜impactâ€™, â€˜industriâ€™, â€˜governâ€™, â€˜academiaâ€™, â€˜thirdâ€™, â€˜sectorâ€™, â€˜casaâ€™, â€˜communitiâ€™, â€˜closeâ€™, â€˜connectâ€™, â€˜strongâ€™, â€˜interdisciplinariâ€™, â€˜bringâ€™, â€˜togethâ€™, â€˜peoplâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜uniquâ€™, â€˜varietiâ€™, â€˜backgroundâ€™, â€˜includâ€™, â€˜physicistâ€™, â€˜plannerâ€™, â€˜geographâ€™, â€˜economistâ€™, â€˜dataâ€™, â€˜scientistâ€™, â€˜architectâ€™, â€˜mathematicianâ€™, â€˜computâ€™, â€˜scientistâ€™, â€˜unitâ€™, â€˜missionâ€™, â€˜tacklâ€™, â€˜biggestâ€™, â€˜challengâ€™, â€˜faceâ€™, â€˜citiâ€™, â€˜societiâ€™, â€˜aroundâ€™, â€˜worldâ€™, â€˜workâ€™, â€˜acrossâ€™, â€˜multiplâ€™, â€˜scaleâ€™, â€˜hyper-locâ€™, â€˜environâ€™, â€˜low-powâ€™, â€˜sensorâ€™, â€˜wayâ€™, â€˜satellitâ€™, â€˜remotâ€™, â€˜sensâ€™, â€˜wholeâ€™, â€˜countriâ€™, â€˜regionâ€™, â€˜studiâ€™, â€˜casaâ€™, â€˜bringâ€™, â€˜lifelongâ€™, â€˜valuâ€™, â€˜studentâ€™, â€˜poisâ€™, â€˜takeâ€™, â€˜leadershipâ€™, â€˜integrâ€™, â€˜roleâ€™, â€˜forefrontâ€™, â€˜urbanâ€™, â€˜spatialâ€™, â€˜dataâ€™, â€˜sciencâ€™, â€˜studiâ€™, â€˜usâ€™, â€˜becomâ€™, â€˜partâ€™, â€˜activâ€™, â€˜engagâ€™, â€˜alumniâ€™, â€˜communitiâ€™, â€˜accessâ€™, â€˜jobâ€™, â€˜listâ€™, â€˜networkâ€™, â€˜socialâ€™, â€˜activâ€™, â€˜wellâ€™, â€˜continuâ€™, â€˜contactâ€™, â€˜outstandâ€™, â€˜teacherâ€™, â€˜researchâ€™, â€˜locatâ€™, â€˜uclâ€™, â€˜centrâ€™, â€˜advancâ€™, â€˜spatialâ€™, â€˜analysiâ€™, â€˜locatâ€™, â€˜90â€™, â€˜tottenhamâ€™, â€˜courtâ€™, â€˜roadâ€™, â€˜londonâ€™, â€˜w1tâ€™, â€˜4tjâ€™]</p>
</blockquote>
</section>
</div>
<div id="f60b0f11" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What are we doing here?</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ix, p <span class="kw">in</span> <span class="bu">enumerate</span>(stopped):</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    stopped_set <span class="op">=</span> <span class="bu">set</span>(stopped[ix])</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    lemma_set   <span class="op">=</span> <span class="bu">set</span>(lemmas[ix])</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">sorted</span>(stopped_set.symmetric_difference(lemma_set)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['cities', 'city']
['activities', 'activity', 'alumni', 'alumnus', 'architect', 'architects', 'background', 'backgrounds', 'boundaries', 'boundary', 'challenge', 'challenges', 'cities', 'city', 'countries', 'country', 'economist', 'economists', 'form', 'forms', 'geographer', 'geographers', 'idea', 'ideas', 'listing', 'listings', 'mathematician', 'mathematicians', 'method', 'methods', 'partner', 'partners', 'partnership', 'partnerships', 'physicist', 'physicists', 'planner', 'planners', 'region', 'regions', 'researcher', 'researchers', 'role', 'roles', 'scale', 'scales', 'scientist', 'scientists', 'skill', 'skills', 'societies', 'society', 'student', 'students', 'teacher', 'teachers', 'tool', 'tools', 'u', 'us']</code></pre>
</div>
</div>
</section>
</section>
<section id="applying-normalisation" class="level1">
<h1>Applying Normalisation</h1>
<p>The above approach is fairly hard going since you need to loop through every list element applying these changes one at a time. Instead, we could convert the column to a corpus (or use pandas <code>apply</code>) together with a function imported from a library to do the work.</p>
<section id="downloading-the-custom-module" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-custom-module">Downloading the Custom Module</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This custom module is not perfect, but it gets the job doneâ€¦ mostly and has some additional features that you could play around with for a final project (e.g.&nbsp;<code>detect_entities</code> and <code>detect_acronyms</code>).</p>
<div id="46ebbe97" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>host  <span class="op">=</span> <span class="st">'https://orca.casa.ucl.ac.uk'</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>turl  <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>host<span class="sc">}</span><span class="ss">/~jreades/__textual__.py'</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>tdirs <span class="op">=</span> os.path.join(<span class="st">'textual'</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>tpath <span class="op">=</span> os.path.join(tdirs,<span class="st">'__init__.py'</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(tpath):</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    os.makedirs(tdirs, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    urllib.request.urlretrieve(turl, tpath)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-the-custom-module" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-custom-module">Importing the Custom Module</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>But only because you didnâ€™t have to write the module! However, the questions could be hardâ€¦</p>
</div>
</div>
</div>
<p>In a Jupyter notebook, this code allows us to edit and reload the library dynamically:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now letâ€™s import it.</p>
<div id="35913b11" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> textual <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All NLTK libraries installed...</code></pre>
</div>
</div>
<div id="68d81c68" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>as_markdown(<span class="st">'Input'</span>, cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="input" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="input">Input</h5>
<blockquote class="blockquote">
<p>[â€˜UCL Home The Bartlett Centre for Advanced Spatial Analysis Aboutâ€™, â€˜Aboutâ€™, â€˜The Centre for Advanced Spatial Analysis (CASA) is an interdisciplinary research institute focusing on the science of cities within The Bartlett Faculty of the Built Environment at UCL.â€™, â€˜The Centre for Advanced Spatial Analysis (CASA) was established in 1995 to lead the development of a science of cities drawing upon methods and ideas in modelling and data science, sensing the urban environment, visualisation and computation. Today, CASAâ€™s research is still pushing boundaries to create better cities for everyone, both leading the intellectual agenda and working closely with government and industry partners to make real-world impact. Our teaching reflects this, making the most of our cutting-edge research, tools, new forms of data, and long-standing non-academic partnerships to train the next generation of urban scientists with the skills and ideas theyâ€™ll need to have an impact in industry, government, academia, and the third sector. The CASA community is closely connected, but strongly interdisciplinary. We bring together people from around the world with a unique variety of backgrounds â€“ including physicists, planners, geographers, economists, data scientists, architects, mathematicians and computer scientists â€“ united by our mission to tackle the biggest challenges facing cities and societies around the world. We work across multiple scales: from the hyper-local environment of the low-powered sensor all the way up to satellite remote sensing of whole countries and regions. Studying at CASA brings lifelong value, with our students poised to take on leadership and integration roles at the forefront of urban and spatial data science. By studying with us you will become part of our active and engaged alumni community, with access to job listings, networking and social activities, as well as continued contact with our outstanding teachers and researchers. Location The UCL Centre for Advanced Spatial Analysis is located at 90 Tottenham Court Road, London, W1T 4TJ.â€™, â€˜View Mapâ€™, â€˜Contact Address: UCL Centre for Advanced Spatial Analysis First Floor, 90 Tottenham Court Road London W1T 4TJ Telephone: +44 (0)20 3108 3877 Email: casa@ucl.ac.ukâ€™, â€˜Tweets by CASAUCLâ€™]</p>
</blockquote>
</section>
</div>
<div id="b2f9073b" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>as_markdown(<span class="st">'Normalised'</span>, [normalise_document(x, remove_digits<span class="op">=</span><span class="va">True</span>) <span class="cf">for</span> x <span class="kw">in</span> cleaned])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="normalised" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="normalised">Normalised</h5>
<blockquote class="blockquote">
<p>[â€˜home bartlett centre advanced spatial analysisâ€™, â€™â€˜, â€™centre advanced spatial analysis . casa . interdisciplinary research institute focus science city within bartlett faculty built environment .â€™, â€˜centre advanced spatial analysis . casa . establish lead development science city draw upon method idea modelling data science sense urban environment visualisation computation . today research still push boundary create good city everyone lead intellectual agenda work closely government industry partner make realworld impact . teaching reflect make cuttingedge research tool form data longstanding nonacademic partnership train next generation urban scientist skill idea need impact industry government academia third sector . casa community closely connect strongly interdisciplinary . bring together people around world unique variety background include physicist planner geographer economist data scientist architect mathematician computer scientist unite mission tackle challenge face city society around world . work across multiple scale hyperlocal environment lowpowered sensor satellite remote sensing whole country region . studying casa bring lifelong value student poise take leadership integration role forefront urban spatial data science . study become part active engage alumnus community access listing network social activity well continue contact outstanding teacher researcher . location centre advanced spatial analysis locate tottenham court road london .â€™, â€˜viewâ€™, â€˜contact address centre advanced spatial analysis first floor tottenham court road london telephone . email casa ucl.ac.ukâ€™, â€˜tweets casauclâ€™]</p>
</blockquote>
</section>
</div>
<div id="a9ee8f4c" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(normalise_document)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Help on function normalise_document in module textual:

normalise_document(doc: str, html_stripping=True, contraction_expansion=True, accented_char_removal=True, text_lower_case=True, text_lemmatization=True, special_char_removal=False, punctuation_removal=True, keep_sentences=True, stopword_removal=True, remove_digits=False, infer_numbers=True, shortest_word=3) -&gt; str
    Apply all of the functions above to a document using their
    default values so as to demonstrate the NLP process.

    doc: a document to clean.
</code></pre>
</div>
</div>
<section id="questions-5" class="level3">
<h3 class="anchored" data-anchor-id="questions-5">Questions</h3>
<p>Letâ€™s assume that you want to analyse web page contentâ€¦</p>
<ul>
<li>Based on the above output, what stopwords do you think are missing?</li>
<li>Based on the above output, what should be removed but isnâ€™t?</li>
<li>Based on the above output, how do you think a computer can work with this text?</li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Beyond this point, we are moving into Natural Language Processing. If you are already struggling with regular expressions, I would recommend <em>stopping here</em>. You can come back to revisit the NLP components and creation of word clouds later.</p>
</div>
</div>
</section>
</section>
</section>
<section id="revenons-Ã -nos-moutons" class="level1">
<h1>Revenons Ã  Nos Moutons</h1>
<p>Now that youâ€™ve seen how the steps are applied to a â€˜randomâ€™ HTML document, letâ€™s get back to the problem at hand (revenons Ã  nos moutons == letâ€™s get back to our sheep).</p>
<section id="process-the-selected-listings" class="level2">
<h2 class="anchored" data-anchor-id="process-the-selected-listings">Process the Selected Listings</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low, but youâ€™ll need to be patient!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Notice the use of <code>%%time</code> here â€“ this will tell you how long each block of code takes to complete. Itâ€™s a really useful technique for reminding <em>yourself</em> and others of how long something might take to run. I find that with NLP this is particularly important since you have to do a <em>lot</em> of processing on each document in order to normalise it.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice how we can change the default parameters for <code>normalise_document</code> even when using <code>apply</code>, but that the syntax is different. So whereas weâ€™d use <code>normalise_document(doc, remove_digits=True)</code> if calling the function directly, here itâ€™s <code>.apply(normalise_document, remove_digits=True)</code>!</p>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 1 minute on a M2 Mac</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>lux[<span class="st">'description_norm'</span>] <span class="op">=</span> lux.???.<span class="bu">apply</span>(???, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 1 minute on a M2 Mac</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>aff[<span class="st">'description_norm'</span>] <span class="op">=</span> aff.???.<span class="bu">apply</span>(???, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time  </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 2 seconds on a M2 Mac</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>bluesp[<span class="st">'description_norm'</span>] <span class="op">=</span> bluesp.???.<span class="bu">apply</span>(???, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div id="5195b04c" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 1 minute on a M2 Mac</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>lux[<span class="st">'description_norm'</span>] <span class="op">=</span> lux.description.<span class="bu">apply</span>(normalise_document, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/jreades/Documents/git/fsds/practicals/textual/__init__.py:606: MarkupResemblesLocatorWarning:

The input looks more like a filename than markup. You may want to open this file and pass the filehandle into Beautiful Soup.
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 44 s, sys: 733 ms, total: 44.7 s
Wall time: 44.8 s</code></pre>
</div>
</div>
<div id="4884f59e" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 1 minute on a M2 Mac</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>aff[<span class="st">'description_norm'</span>] <span class="op">=</span> aff.description.<span class="bu">apply</span>(normalise_document, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/jreades/Documents/git/fsds/practicals/textual/__init__.py:606: MarkupResemblesLocatorWarning:

The input looks more like a filename than markup. You may want to open this file and pass the filehandle into Beautiful Soup.
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 37.3 s, sys: 639 ms, total: 37.9 s
Wall time: 37.9 s</code></pre>
</div>
</div>
<div id="c1735f85" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I get about 1 seconds on a M2 Mac</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>bluesp[<span class="st">'description_norm'</span>] <span class="op">=</span> bluesp.description.<span class="bu">apply</span>(normalise_document, remove_digits<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1.62 s, sys: 28.5 ms, total: 1.65 s
Wall time: 1.65 s</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="select-and-tokenise" class="level2">
<h2 class="anchored" data-anchor-id="select-and-tokenise">Select and Tokenise</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low, except for the double list-comprehension.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="select-and-extract-corpus" class="level3">
<h3 class="anchored" data-anchor-id="select-and-extract-corpus">Select and Extract Corpus</h3>
<p>See useful tutorial <a href="https://towardsdatascience.com/tf-idf-explained-and-python-sklearn-implementation-b020c5e83275">here</a>. Although we shouldnâ€™t have any empty descriptions, by the time weâ€™ve finished normalising the textual data we may have <em>created</em> some empty values and we need to ensure that we donâ€™t accidentally pass a NaN to the vectorisers and frequency distribution functions.</p>
<div id="51cc8927" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>srcdf <span class="op">=</span> bluesp </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Coding Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice how you only need to change the value of the variable here to try any of the different selections we did above? This is a simple kind of parameterisation somewhere between a function and hard-coding everything.</p>
</div>
</div>
<div id="1f223224" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>corpus <span class="op">=</span> srcdf.description_norm.fillna(<span class="st">' '</span>).values</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corpus[<span class="dv">0</span>:<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['house garden close thames river . walk  private road river nearby .  district line underground . walk . direct access central london  near gardens . kids playground walk distance along thames path . space residential neighborhood  english corporate expat family . house culdesac private road river thames . river foot away . walking distance subway . central london underground   district line . gardens stop walk zone . addition  overground stratford also stop gardens underground station . gardens stop walk .  overland railway station bridge . walk . take waterloo railway station minute . bicycle follow towpath hammersmith bridge continue putney bridge . lastly  several stree'
 'space appartment upper floor modernised secure building near canary wharf  fantastic view river thames london . offer home home experience  light breafast fresh juice coffee . double room plenty storage  fresh towels linen . shared bathroom step shower  hairdryer essentials . wifi service . appartment  minutes walk nearest . south quay . london underground . canary wharf . network central london right next stop . close asda tesco supermarkets chains  plenty local shop restaurants . walking distance city farm  greenwich foot tunnel fabulous walkway along river front . also hour medical center close appartment  questions'
 'newly renovate  totally equipped furnished modern apartment heart london . easily accessible kind transport . walk waterloo station  london  . space newly renovate  totally equipped furnished modern apartment heart london . easily accessible kind transport . walk waterloo station  london  . apartment flat   broadband  wash machine  microwave  iron  nespresso coffee machine  . large live room easily divide space . modern comfortable bathroom whirlpool japanese . bedroom modern design closet . shared terrace view picturesque vivid lower marsh street   london . lower marsh london best hidden jewel  special alive place bridget jones  bourne identit']</code></pre>
</div>
</div>
</section>
<section id="tokenise" class="level3">
<h3 class="anchored" data-anchor-id="tokenise">Tokenise</h3>
<p>There are different forms of tokenisation and different algorithms will expect differing inputs. Here are two:</p>
<div id="5ef0d144" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>sentences <span class="op">=</span> [nltk.sent_tokenize(text) <span class="cf">for</span> text <span class="kw">in</span> corpus]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>words     <span class="op">=</span> [[nltk.tokenize.word_tokenize(sentence) </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> sentence <span class="kw">in</span> nltk.sent_tokenize(text)] </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> text <span class="kw">in</span> corpus]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how this has turned every sentence into an array and each document into an array of arrays:</p>
<div id="34a87d22" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sentences 0: </span><span class="sc">{</span>sentences[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Words 0: </span><span class="sc">{</span>words[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sentences 0: ['house garden close thames river .', 'walk  private road river nearby .', 'district line underground .', 'walk .', 'direct access central london  near gardens .', 'kids playground walk distance along thames path .', 'space residential neighborhood  english corporate expat family .', 'house culdesac private road river thames .', 'river foot away .', 'walking distance subway .', 'central london underground   district line .', 'gardens stop walk zone .', 'addition  overground stratford also stop gardens underground station .', 'gardens stop walk .', 'overland railway station bridge .', 'walk .', 'take waterloo railway station minute .', 'bicycle follow towpath hammersmith bridge continue putney bridge .', 'lastly  several stree']

Words 0: [['house', 'garden', 'close', 'thames', 'river', '.'], ['walk', 'private', 'road', 'river', 'nearby', '.'], ['district', 'line', 'underground', '.'], ['walk', '.'], ['direct', 'access', 'central', 'london', 'near', 'gardens', '.'], ['kids', 'playground', 'walk', 'distance', 'along', 'thames', 'path', '.'], ['space', 'residential', 'neighborhood', 'english', 'corporate', 'expat', 'family', '.'], ['house', 'culdesac', 'private', 'road', 'river', 'thames', '.'], ['river', 'foot', 'away', '.'], ['walking', 'distance', 'subway', '.'], ['central', 'london', 'underground', 'district', 'line', '.'], ['gardens', 'stop', 'walk', 'zone', '.'], ['addition', 'overground', 'stratford', 'also', 'stop', 'gardens', 'underground', 'station', '.'], ['gardens', 'stop', 'walk', '.'], ['overland', 'railway', 'station', 'bridge', '.'], ['walk', '.'], ['take', 'waterloo', 'railway', 'station', 'minute', '.'], ['bicycle', 'follow', 'towpath', 'hammersmith', 'bridge', 'continue', 'putney', 'bridge', '.'], ['lastly', 'several', 'stree']]</code></pre>
</div>
</div>
</section>
</section>
<section id="frequencies-and-ngrams" class="level2">
<h2 class="anchored" data-anchor-id="frequencies-and-ngrams">Frequencies and Ngrams</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-29-contents" aria-controls="callout-29" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-29" class="callout-29-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>One new thing youâ€™ll see here is the <code>ngram</code>: ngrams are â€˜simplyâ€™ pairs, or triplets, or quadruplets of words. You may come across the terms unigram (<code>ngram(1,1)</code>), bigram (<code>ngram(2,2)</code>), trigram (<code>ngram(3,3)</code>)â€¦ typically, you will rarely find anything beyond trigrams, and these present real issues for text2vec algorithms because the embedding for <code>geographical</code>, <code>information</code>, and <code>systems</code> is <em>not</em> the same as for <code>geographical information systetms</code>.</p>
<section id="build-frequency-distribution" class="level3">
<h3 class="anchored" data-anchor-id="build-frequency-distribution">Build Frequency Distribution</h3>
<p>Build counts for ngram range 1..3:</p>
<div id="76858c0c" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>fcounts <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we replace all full-stops... can you think why we might do this?</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> nltk.tokenize.word_tokenize(<span class="st">' '</span>.join([text.replace(<span class="st">'.'</span>,<span class="st">''</span>) <span class="cf">for</span> text <span class="kw">in</span> corpus]))</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> size <span class="kw">in</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>:</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    fdist <span class="op">=</span> FreqDist(ngrams(data, size))</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(fdist)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If you only need one note this: https://stackoverflow.com/a/52193485/4041902</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    fcounts[size] <span class="op">=</span> pd.DataFrame.from_dict({<span class="ss">f'Ngram Size </span><span class="sc">{</span>size<span class="sc">}</span><span class="ss">'</span>: fdist})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;FreqDist with 2692 samples and 26245 outcomes&gt;
&lt;FreqDist with 14173 samples and 26244 outcomes&gt;
&lt;FreqDist with 19540 samples and 26243 outcomes&gt;</code></pre>
</div>
</div>
</section>
<section id="output-top-n-ngrams" class="level3">
<h3 class="anchored" data-anchor-id="output-top-n-ngrams">Output Top-n Ngrams</h3>
<p>And output the most common ones for each ngram range:</p>
<div id="a6a1a414" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> dfs <span class="kw">in</span> fcounts.values():</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(dfs.sort_values(by<span class="op">=</span>dfs.columns.values[<span class="dv">0</span>], ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>))</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ngram Size 1
walk                594
room                472
london              469
river               418
bedroom             412
space               391
minute              382
apartment           373
station             307
flat                303

                 Ngram Size 2
minute  walk              252
river   thames            138
        view              138
living  room              134
canary  wharf             112
guest   access            110
central london            107
fully   equip              76
equip   kitchen            71
thames  river              65

                        Ngram Size 3
fully  equip  kitchen             68
walk   river  thames              37
close  river  thames              35
walk   thames river               27
minute walk   river               23
open   plan   kitchen             20
thames river  view                20
sofa   living room                19
within walk   distance            19
open   plan   live                18
</code></pre>
</div>
</div>
</section>
<section id="questions-6" class="level3">
<h3 class="anchored" data-anchor-id="questions-6">Questions</h3>
<ul>
<li>Can you think why we donâ€™t care about punctuation for frequency distributions and n-grams?</li>
<li>Do you understand what n-grams <em>are</em>?</li>
</ul>
</section>
</section>
<section id="count-vectoriser" class="level2">
<h2 class="anchored" data-anchor-id="count-vectoriser">Count Vectoriser</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low, but the output needs some thought!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This is a big foray into sklearn (sci-kit learn) which is the main machine learning and clustering module for Python. For processing text we use <em>vectorisers</em> to convert terms to a vector representation. Weâ€™re doing this on the smallest of the derived data sets because these processes can take a while to run and generate <em>huge</em> matrices (remember: one row and one column for each term!).</p>
<section id="fit-the-vectoriser" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-vectoriser">Fit the Vectoriser</h3>
<div id="2820632e" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>cvectorizer <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>cvectorizer.fit(corpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>CountVectorizer(ngram_range=(1, 3))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;CountVectorizer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.feature_extraction.text.CountVectorizer.html">?<span>Documentation for CountVectorizer</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>CountVectorizer(ngram_range=(1, 3))</pre></div> </div></div></div></div>
</div>
</div>
</section>
<section id="brief-demonstration" class="level3">
<h3 class="anchored" data-anchor-id="brief-demonstration">Brief Demonstration</h3>
<p>Find the number associated with a word in the vocabulary and how many times it occurs in the original corpus:</p>
<div id="63471fee" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>term <span class="op">=</span> <span class="st">'stratford'</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_colwidth<span class="op">=</span><span class="dv">750</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the vocabulary mapping for the term</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Vocabulary mapping for </span><span class="sc">{</span>term<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>cvectorizer<span class="sc">.</span>vocabulary_[term]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># How many times is it in the data</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>srcdf<span class="sc">.</span>description_norm<span class="sc">.</span><span class="bu">str</span><span class="sc">.</span>contains(term)<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> rows containing </span><span class="sc">{</span>term<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the descriptions containing the term</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> srcdf[srcdf.description_norm.<span class="bu">str</span>.contains(term)].description_norm:</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="st">'Stratford'</span>,x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Vocabulary mapping for stratford is 29373
Found 10 rows containing stratford</code></pre>
</div>
<section id="stratford" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford">Stratford</h5>
<blockquote class="blockquote">
<p>house garden close thames river . walk private road river nearby . district line underground . walk . direct access central london near gardens . kids playground walk distance along thames path . space residential neighborhood english corporate expat family . house culdesac private road river thames . river foot away . walking distance subway . central london underground district line . gardens stop walk zone . addition overground stratford also stop gardens underground station . gardens stop walk . overland railway station bridge . walk . take waterloo railway station minute . bicycle follow towpath hammersmith bridge continue putney bridge . lastly several stree</p>
</blockquote>
</section>
<section id="stratford-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-1">Stratford</h5>
<blockquote class="blockquote">
<p>please read things note comfortable clean bright brand flat east london minute central london tube quite central great transport link major london attraction minute walk river park undergroundtubedlr station supermarket docklands stratford olympic stadium westfield shopping centre . enjoy brick lane indian restaurant spitalfields market colombian flower market historical whitechapel . space please read things note nice clean fresh bright airy . space perfect professional single person couple . make feel like home choice anything like wake relaxing cooking . guest access please read things note entire flat . please treat home away . please treat .</p>
</blockquote>
</section>
<section id="stratford-2" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-2">Stratford</h5>
<blockquote class="blockquote">
<p>comfortable fairly flat east london travel zone minute central london quite central great transport link major london attraction minute walk river park undergroundtube station minute supermarket minute docklands stratford olympic stadium westfield shopping centre . enjoy brick lane indian restaurant spitalfields market colombian flower market historical whitechapel . space spacious comfortable tidy clean airy relaxing . live flat sleep open plan lounge balcony . guest access bathroom share . welcome microwave ready meal toaster make drink till fridge store food . please make sure clean clear immediately . dining table . stay present morning evening weekend . also</p>
</blockquote>
</section>
<section id="stratford-3" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-3">Stratford</h5>
<blockquote class="blockquote">
<p>entire appartment double bedroom large living area.the apartment feature kitchen come free wifi flat screen tv.to make exicting luxurious even free free sauna well . space stunning apartment london docklands bank thames river close thames barrier park canary wharf . apartment floor spacious living room balcony . nearest station pontoon dock walkable distance direct train stratford . mins . bank . excel centre . walk . arena canary wharf mins train mins central london . world heritage sitethames barrier thames barrier park walk appartment . london city airport train station away . fully kitchen bathroom broadband internet underground secure parking onsite . attract</p>
</blockquote>
</section>
<section id="stratford-4" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-4">Stratford</h5>
<blockquote class="blockquote">
<p>luxurious bedroom apartment zone love hidden secret part town minute away everywhere river view slow pace main artery town right doorstep well hidden beauty park waterway . easy . walk tube route center town well stratford olympic park canary wharf much much right doorstep space welcome home place love bedroom hold personal belonging bedroom give guest idea size . bedroom large double accommodate comfortably . sofa chair accommodate guest extra extra charge . welcome guest personally wish know . therefore important check time convenient . midnight arrival . time ehich discuss good</p>
</blockquote>
</section>
<section id="stratford-5" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-5">Stratford</h5>
<blockquote class="blockquote">
<p>place close mile tube station brick lane shoreditch queen mary university london stratford westfield minute tube central london . love place newly renovate flat amazing canal view guest bedroom clean friendly environment . place good couple solo adventurer business traveller .</p>
</blockquote>
</section>
<section id="stratford-6" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-6">Stratford</h5>
<blockquote class="blockquote">
<p>locate high street give amazing water view stadium sight amazing architectural structure walk pudding mill lane walk abba walk stratford westfield walk stratfordstratford international station mins walk mins train ride central london</p>
</blockquote>
</section>
<section id="stratford-7" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-7">Stratford</h5>
<blockquote class="blockquote">
<p>modern spacious bedroom suite apartment close river thames wimbledon . situate wandsworth district london england lawn tennis club centre court .km clapham junction . stratford bridge chelsea . city view free wifi throughout property . apartment feature bedroom kitchen fridge oven wash machine flat screen seating area bathroom shower . eventim .km away .</p>
</blockquote>
</section>
<section id="stratford-8" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-8">Stratford</h5>
<blockquote class="blockquote">
<p>perfect group trip . modern spacious suite apartment close river thames wimbledon . situated wandsworth district london england lawn tennis club centre court .km clapham junction . stratford bridge chelsea . city view free wifi throughout property . apartment feature bedroom kitchen wfridge oven wash machine flat screen seating area bathroom wshower . eventim .km away .</p>
</blockquote>
</section>
<section id="stratford-9" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="stratford-9">Stratford</h5>
<blockquote class="blockquote">
<p>flat locate zone east london near canary wharf . nice quiet residential area canal . flat amazing canal view balcony . enjoy morning coffee swan goose everyday . huge park opposite flat picnic . canary wharf shop mall . mins bank stratford westfield . mins central oxford circus tube . locate convenient transportation link .</p>
</blockquote>
</section>
</div>
</section>
<section id="transform-the-corpus" class="level3">
<h3 class="anchored" data-anchor-id="transform-the-corpus">Transform the Corpus</h3>
<p>You can only <em>tranform</em> the entire corpus <em>after</em> the vectoriser has been fitted. There is an option to <code>fit_transform</code> in one go, but I wanted to demonstrate a few things here and some vectorisers are donâ€™t support the one-shot fit-and-transform approach. <strong>Note the type of the transformed corpus</strong>:</p>
<div id="aae4be89" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>cvtcorpus <span class="op">=</span> cvectorizer.transform(corpus)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>cvtcorpus <span class="co"># cvtcorpus for count-vectorised transformed corpus</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>&lt;408x35278 sparse matrix of type '&lt;class 'numpy.int64'&gt;'
    with 71420 stored elements in Compressed Sparse Row format&gt;</code></pre>
</div>
</div>
</section>
<section id="single-document" class="level3">
<h3 class="anchored" data-anchor-id="single-document">Single Document</h3>
<p>Here is the <strong>first</strong> document from the corpus:</p>
<div id="d33a5511" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>doc_df <span class="op">=</span> pd.DataFrame(cvtcorpus[<span class="dv">0</span>].T.todense(), </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                      index<span class="op">=</span>cvectorizer.get_feature_names_out(), columns<span class="op">=</span>[<span class="st">"Counts"</span>]</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                     ).sort_values(<span class="st">'Counts'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>doc_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">walk</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">gardens</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">river</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">bridge</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">stop</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">thames</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">station</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">underground</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">railway</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">central london</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="transformed-corpus" class="level3">
<h3 class="anchored" data-anchor-id="transformed-corpus">Transformed Corpus</h3>
<div id="ff763a98" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>cvdf <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>cvtcorpus.toarray(),</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>                        columns<span class="op">=</span>cvectorizer.get_feature_names_out())</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Raw count vectorised data frame has </span><span class="sc">{</span>cvdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and </span><span class="sc">{</span>cvdf<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">:,}</span><span class="ss"> columns."</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>cvdf.iloc[<span class="dv">0</span>:<span class="dv">5</span>,<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw count vectorised data frame has 408 rows and 35,278 columns.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">aaathe</th>
<th data-quarto-table-cell-role="th">aaathe apartment</th>
<th data-quarto-table-cell-role="th">aaathe apartment quiet</th>
<th data-quarto-table-cell-role="th">aand</th>
<th data-quarto-table-cell-role="th">aand comfy</th>
<th data-quarto-table-cell-role="th">aand comfy sofa</th>
<th data-quarto-table-cell-role="th">abba</th>
<th data-quarto-table-cell-role="th">abba arena</th>
<th data-quarto-table-cell-role="th">abba arena entertainmentconcerts</th>
<th data-quarto-table-cell-role="th">abba walk</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="filter-low-frequency-words" class="level3">
<h3 class="anchored" data-anchor-id="filter-low-frequency-words">Filter Low-Frequency Words</h3>
<p>These are likely to be artefacts of text-cleaning or human input error. As well, if weâ€™re trying to look across an entire corpus then we might not want to retain words that only appear in a couple of documents.</p>
<p>Letâ€™s start by getting the <em>column</em> sums:</p>
<div id="7226c0af" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>sums <span class="op">=</span> cvdf.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span><span class="bu">len</span>(sums)<span class="sc">:,}</span><span class="ss"> terms in the data set."</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>sums.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 35,278 terms in the data set.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>aaathe                    1
aaathe apartment          1
aaathe apartment quiet    1
aand                      1
aand comfy                1
dtype: int64</code></pre>
</div>
</div>
<p>Remove columns (i.e.&nbsp;terms) appearing in less than 1% of documents. You can do this by thinking about what the shape of the data frame means (rows and/or columns) and how youâ€™d get 1% of that!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Question</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Answer</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="sourceCode" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>filter_terms <span class="op">=</span> sums <span class="op">&gt;=</span> cvdf.shape[<span class="dv">0</span>] <span class="op">*</span> ???</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div id="be21f2e6" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>filter_terms <span class="op">=</span> sums <span class="op">&gt;=</span> cvdf.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="fl">0.01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now see how we can use this to strip out the columns corresponding to low-frequency terms:</p>
<div id="7deabc24" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>fcvdf <span class="op">=</span> cvdf.drop(columns<span class="op">=</span>cvdf.columns[<span class="op">~</span>filter_terms].values)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Filtered count vectorised data frame has </span><span class="sc">{</span>fcvdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and </span><span class="sc">{</span>fcvdf<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">:,}</span><span class="ss"> columns."</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>fcvdf.iloc[<span class="dv">0</span>:<span class="dv">5</span>,<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered count vectorised data frame has 408 rows and 2,043 columns.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">able</th>
<th data-quarto-table-cell-role="th">access</th>
<th data-quarto-table-cell-role="th">access access</th>
<th data-quarto-table-cell-role="th">access bathroom</th>
<th data-quarto-table-cell-role="th">access central</th>
<th data-quarto-table-cell-role="th">access central london</th>
<th data-quarto-table-cell-role="th">access entire</th>
<th data-quarto-table-cell-role="th">access everything</th>
<th data-quarto-table-cell-role="th">access full</th>
<th data-quarto-table-cell-role="th">access guest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="60595851" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>fcvdf.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>able                         8
access                     242
access access                7
access bathroom              5
access central               8
                          ... 
zone comfortable cosy        7
zone near                    5
zone near underground        5
zone recently               10
zone recently refurbish     10
Length: 2043, dtype: int64</code></pre>
</div>
</div>
<p>Weâ€™re going to pick this up again in Task 7.</p>
</section>
<section id="questions-7" class="level3">
<h3 class="anchored" data-anchor-id="questions-7">Questions</h3>
<ul>
<li>Can you explain what <code>doc_df</code> contains?</li>
<li>What does <code>cvdf</code> contain? Explain the rows and columns.</li>
<li>What is the function of <code>filter_terms</code>?</li>
</ul>
</section>
</section>
<section id="tfidf-vectoriser" class="level2">
<h2 class="anchored" data-anchor-id="tfidf-vectoriser">TF/IDF Vectoriser</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>But only if you want to understand how <code>max_df</code> and <code>min_df</code> work!</p>
</div>
</div>
</div>
<section id="fit-and-transform" class="level3">
<h3 class="anchored" data-anchor-id="fit-and-transform">Fit and Transform</h3>
<div id="27fe92ed" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tfvectorizer <span class="op">=</span> TfidfVectorizer(use_idf<span class="op">=</span><span class="va">True</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">3</span>), </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                               max_df<span class="op">=</span><span class="fl">0.75</span>, min_df<span class="op">=</span><span class="fl">0.01</span>) <span class="co"># &lt;-- these matter!</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>tftcorpus    <span class="op">=</span> tfvectorizer.fit_transform(corpus) <span class="co"># TF-transformed corpus</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="single-document-1" class="level3">
<h3 class="anchored" data-anchor-id="single-document-1">Single Document</h3>
<div id="5bb74a63" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>doc_df <span class="op">=</span> pd.DataFrame(tftcorpus[<span class="dv">0</span>].T.todense(), index<span class="op">=</span>tfvectorizer.get_feature_names_out(), columns<span class="op">=</span>[<span class="st">"Weights"</span>])</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>doc_df.sort_values(<span class="st">'Weights'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Weights</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">gardens</td>
<td>0.414885</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">stop</td>
<td>0.241659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">district line</td>
<td>0.239192</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">railway</td>
<td>0.232131</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">underground</td>
<td>0.201738</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">district</td>
<td>0.197221</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">bridge</td>
<td>0.191983</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">walk</td>
<td>0.189485</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">road</td>
<td>0.151163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">distance</td>
<td>0.142999</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="transformed-corpus-1" class="level3">
<h3 class="anchored" data-anchor-id="transformed-corpus-1">Transformed Corpus</h3>
<div id="ee440031" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>tfidf <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>tftcorpus.toarray(),</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>                        columns<span class="op">=</span>tfvectorizer.get_feature_names_out())</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TF/IDF data frame has </span><span class="sc">{</span>tfidf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and </span><span class="sc">{</span>tfidf<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">:,}</span><span class="ss"> columns."</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>tfidf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TF/IDF data frame has 408 rows and 1,911 columns.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">able</th>
<th data-quarto-table-cell-role="th">access</th>
<th data-quarto-table-cell-role="th">access access</th>
<th data-quarto-table-cell-role="th">access bathroom</th>
<th data-quarto-table-cell-role="th">access central</th>
<th data-quarto-table-cell-role="th">access central london</th>
<th data-quarto-table-cell-role="th">access entire</th>
<th data-quarto-table-cell-role="th">access everything</th>
<th data-quarto-table-cell-role="th">access full</th>
<th data-quarto-table-cell-role="th">access guest</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">young</th>
<th data-quarto-table-cell-role="th">zone</th>
<th data-quarto-table-cell-role="th">zone central</th>
<th data-quarto-table-cell-role="th">zone central city</th>
<th data-quarto-table-cell-role="th">zone comfortable</th>
<th data-quarto-table-cell-role="th">zone comfortable cosy</th>
<th data-quarto-table-cell-role="th">zone near</th>
<th data-quarto-table-cell-role="th">zone near underground</th>
<th data-quarto-table-cell-role="th">zone recently</th>
<th data-quarto-table-cell-role="th">zone recently refurbish</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
<td>0.043972</td>
<td>0.0</td>
<td>0.0</td>
<td>0.11031</td>
<td>0.11031</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.069702</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.0</td>
<td>0.044127</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00000</td>
<td>0.00000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows Ã— 1911 columns</p>
</div>
</div>
</div>
</section>
<section id="questions-8" class="level3">
<h3 class="anchored" data-anchor-id="questions-8">Questions</h3>
<ul>
<li>What does the TF/IDF score <em>represent</em>?</li>
<li>What is the role of <code>max_df</code> and <code>min_df</code>?</li>
</ul>
</section>
</section>
</section>
<section id="word-clouds" class="level1">
<h1>Word Clouds</h1>
<section id="for-counts" class="level2">
<h2 class="anchored" data-anchor-id="for-counts">For Counts</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Easy!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div id="0ef9d2b1" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>fcvdf.<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>walk                      595
room                      472
london                    471
river                     418
bedroom                   412
                         ... 
chic                        5
term                        5
choice                      5
teddington                  5
london aquarium minute      5
Length: 2043, dtype: int64</code></pre>
</div>
</div>
<div id="91d36171" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>ff <span class="op">=</span> <span class="st">'RobotoMono-VariableFont_wght.ttf'</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>dp <span class="op">=</span> <span class="st">'/home/jovyan/.local/share/fonts/'</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>tp <span class="op">=</span> os.path.join(os.path.expanduser(<span class="st">'~'</span>),<span class="st">'Library'</span>,<span class="st">'Fonts'</span>)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(tp):</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> os.path.join(tp,ff)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    fp <span class="op">=</span> os.path.join(dp,ff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ddb64c85" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_dpi(<span class="dv">150</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>Cloud <span class="op">=</span> WordCloud(</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    background_color<span class="op">=</span><span class="st">"white"</span>, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    max_words<span class="op">=</span><span class="dv">75</span>,</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    font_path<span class="op">=</span>fp</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>).generate_from_frequencies(fcvdf.<span class="bu">sum</span>())</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>ax.imshow(Cloud) </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)<span class="op">;</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("Wordcloud 1.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-69-output-1.png" width="959" height="495" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="for-tfidf-weighting" class="level2">
<h2 class="anchored" data-anchor-id="for-tfidf-weighting">For TF/IDF Weighting</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low, but youâ€™ll need to be patient!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div id="9a04dfad" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>tfidf.<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>walk                     23.037285
room                     19.135852
london                   18.744519
minute                   18.650909
apartment                18.082855
                           ...    
station apartment one     0.401426
station also close        0.401426
apartment one benefit     0.401426
apartment one             0.401426
also close station        0.401426
Length: 1911, dtype: float64</code></pre>
</div>
</div>
<div id="ece00142" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>))</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_dpi(<span class="dv">150</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>Cloud <span class="op">=</span> WordCloud(</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    background_color<span class="op">=</span><span class="st">"white"</span>, </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>    max_words<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    font_path<span class="op">=</span>fp</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>).generate_from_frequencies(tfidf.<span class="bu">sum</span>())</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>ax.imshow(Cloud) </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)<span class="op">;</span></span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("Wordcloud 2.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-71-output-1.png" width="959" height="495" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="questions-9" class="level3">
<h3 class="anchored" data-anchor-id="questions-9">Questions</h3>
<ul>
<li>What does the <code>sum</code> represent for the count vectoriser?</li>
<li>What does the <code>sum</code> represent for the TF/IDF vectoriser?</li>
</ul>
</section>
</section>
</section>
<section id="latent-dirchlet-allocation" class="level1">
<h1>Latent Dirchlet Allocation</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>I would give this a <em>low</em> priority. Itâ€™s a commonly-used method, but on small data sets it really isnâ€™t much use and Iâ€™ve found its answers to beâ€¦ unclearâ€¦ even on large data sets.</p>
</div>
</div>
<p>Adapted from <a href="https://stackabuse.com/python-for-nlp-topic-modeling/">this post</a> on doing LDA using sklearn. Most other examples use the <code>gensim</code> library.</p>
<div id="80dc2dac" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice change to ngram range </span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;(try 1,1 and 1,2 for other options)</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculate-topics" class="level2">
<h2 class="anchored" data-anchor-id="calculate-topics">Calculate Topics</h2>
<div id="0f297891" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>vectorizer.fit(corpus) </span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>tcorpus <span class="op">=</span> vectorizer.transform(corpus) <span class="co"># tcorpus for transformed corpus</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>LDA <span class="op">=</span> LatentDirichletAllocation(n_components<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>) <span class="co"># Might want to experiment with n_components too</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>LDA.fit(tcorpus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "â–¸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "â–¾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LatentDirichletAllocation(n_components=3, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;LatentDirichletAllocation<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.decomposition.LatentDirichletAllocation.html">?<span>Documentation for LatentDirichletAllocation</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>LatentDirichletAllocation(n_components=3, random_state=42)</pre></div> </div></div></div></div>
</div>
</div>
<div id="67560c39" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>first_topic <span class="op">=</span> LDA.components_[<span class="dv">0</span>]</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>top_words <span class="op">=</span> first_topic.argsort()[<span class="op">-</span><span class="dv">25</span>:]</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> top_words:</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(vectorizer.get_feature_names_out()[i])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>river thames
modern
area
wharf
flat
access
bathroom
guest
house
minute
private
kitchen
large
thames
living
view
station
floor
bedroom
apartment
walk
london
river
room
space</code></pre>
</div>
</div>
<div id="14e46d34" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,topic <span class="kw">in</span> <span class="bu">enumerate</span>(LDA.components_):</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>    as_markdown(<span class="ss">f'Top 10 words for topic #</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>, <span class="st">', '</span>.join([vectorizer.get_feature_names_out()[i] <span class="cf">for</span> i <span class="kw">in</span> topic.argsort()[<span class="op">-</span><span class="dv">25</span>:]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="top-10-words-for-topic-0" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="top-10-words-for-topic-0">Top 10 words for topic #0</h5>
<blockquote class="blockquote">
<p>river thames, modern, area, wharf, flat, access, bathroom, guest, house, minute, private, kitchen, large, thames, living, view, station, floor, bedroom, apartment, walk, london, river, room, space</p>
</blockquote>
</section>
<section id="top-10-words-for-topic-1" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="top-10-words-for-topic-1">Top 10 words for topic #1</h5>
<blockquote class="blockquote">
<p>park, fully, modern, private, living, guest, view, double, close, access, area, flat, thames, bathroom, station, apartment, kitchen, space, minute walk, room, london, river, bedroom, minute, walk</p>
</blockquote>
</section>
<section id="top-10-words-for-topic-2" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="top-10-words-for-topic-2">Top 10 words for topic #2</h5>
<blockquote class="blockquote">
<p>living, river view, canary wharf, canary, central, wharf, stay, close, bathroom, guest, kitchen, double, minute, thames, access, station, flat, space, view, bedroom, apartment, river, walk, london, room</p>
</blockquote>
</section>
</div>
</section>
<section id="maximum-likelihood-topic" class="level2">
<h2 class="anchored" data-anchor-id="maximum-likelihood-topic">Maximum Likelihood Topic</h2>
<div id="8aeeee04" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>topic_values <span class="op">=</span> LDA.transform(tcorpus)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>topic_values.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>(408, 3)</code></pre>
</div>
</div>
<div id="115397ff" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_colwidth<span class="op">=</span><span class="dv">20</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>srcdf[<span class="st">'Topic'</span>] <span class="op">=</span> topic_values.argmax(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>srcdf.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">amenities</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">description_norm</th>
<th data-quarto-table-cell-role="th">Topic</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">36299</td>
<td>POINT (519476.34...</td>
<td>https://www.airb...</td>
<td>Townhouse in Ric...</td>
<td>3 Bed House with...</td>
<td>["Bathtub", "Sha...</td>
<td>245.0</td>
<td>house garden clo...</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">170702</td>
<td>POINT (537106.00...</td>
<td>https://www.airb...</td>
<td>Rental unit in L...</td>
<td>&lt;b&gt;The space&lt;/b&gt;...</td>
<td>["Heating", "Ele...</td>
<td>60.0</td>
<td>space appartment...</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">608438</td>
<td>POINT (530947.63...</td>
<td>https://www.airb...</td>
<td>Rental unit in G...</td>
<td>Newly renovated,...</td>
<td>["Bathtub", "Sha...</td>
<td>169.0</td>
<td>newly renovate ...</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">827436</td>
<td>POINT (539810.14...</td>
<td>https://www.airb...</td>
<td>Rental unit in L...</td>
<td>Brand new rivers...</td>
<td>["Waterfront", "...</td>
<td>191.0</td>
<td>brand riverside ...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1580666</td>
<td>POINT (538100.19...</td>
<td>https://www.airb...</td>
<td>Rental unit in L...</td>
<td>PLEASE READ OTHE...</td>
<td>["Heating", "Ele...</td>
<td>79.0</td>
<td>please read thin...</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e9399c99" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_colwidth<span class="op">=</span><span class="dv">75</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>srcdf[srcdf.Topic<span class="op">==</span><span class="dv">1</span>].description_norm.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>id
36299      house garden close thames river . walk  private road river nearby .  di...
827436     brand riverside apartment greenwich peninsula . perfect explore london ...
1611173    mint walk thames river  mint tower bridge  mint greenwich bus mint walk...
1910741    bright  spacious chill bedroom cosy apartment level friendly quiet bloc...
5284354    fabulous bathshower flat modern development east putney  london literal...
5498948    large double room river view available large spacious townhouse hampton...
6479011    private quiet bright  large double room ensuite bathroom . location stu...
6619558    bright  airy bedroom  ground floor apartment quiet street . modernly fu...
7495122    perfect claphambattersea modern decor . brand kitchenbathroom minute wa...
8352150    room front house overlook balcony  road river . bright sunny house view...
Name: description_norm, dtype: object</code></pre>
</div>
</div>
<div id="c5879e0a" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="op">=</span> CountVectorizer(ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), stop_words<span class="op">=</span><span class="st">'english'</span>, analyzer<span class="op">=</span><span class="st">'word'</span>, max_df<span class="op">=</span><span class="fl">0.7</span>, min_df<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>topic_corpus <span class="op">=</span> vectorizer.fit_transform(srcdf[srcdf.Topic<span class="op">==</span><span class="dv">1</span>].description.values) <span class="co"># tcorpus for transformed corpus</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="80d1dfd6" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>topicdf <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>topic_corpus.toarray(),</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                        columns<span class="op">=</span>vectorizer.get_feature_names_out())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="117aceae" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>))</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>plt.gcf().set_dpi(<span class="dv">150</span>)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>Cloud <span class="op">=</span> WordCloud(</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>            background_color<span class="op">=</span><span class="st">"white"</span>, </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>            max_words<span class="op">=</span><span class="dv">75</span>).generate_from_frequencies(topicdf.<span class="bu">sum</span>())</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>ax.imshow(Cloud) </span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">"off"</span>)<span class="op">;</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('Wordcloud 3.png')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-07-Textual_Data-Pt2_files/figure-html/cell-81-output-1.png" width="959" height="495" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="word2vec" class="level1">
<h1>Word2Vec</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This algorithm works almost like magic. You should play with the configuration parameters and see how it changes your results.</p>
</div>
</div>
<section id="configure" class="level2">
<h2 class="anchored" data-anchor-id="configure">Configure</h2>
<div id="c1cb9e6b" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gensim.models.word2vec <span class="im">import</span> Word2Vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a6df75c1" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"You've chosen </span><span class="sc">{</span>dims<span class="sc">}</span><span class="ss"> dimensions."</span>)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"You've chosen a window of size </span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>min_v_freq  <span class="op">=</span> <span class="fl">0.005</span> <span class="co"># Don't keep words appearing less than 0.5% frequency</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>min_v_count <span class="op">=</span> math.ceil(min_v_freq <span class="op">*</span> srcdf.shape[<span class="dv">0</span>])</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"With a minimum frequency of </span><span class="sc">{</span>min_v_freq<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>srcdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> documents, minimum vocab frequency is </span><span class="sc">{</span>min_v_count<span class="sc">:,}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You've chosen 100 dimensions.
You've chosen a window of size 3.
With a minimum frequency of 0.005 and 408 documents, minimum vocab frequency is 3.</code></pre>
</div>
</div>
</section>
<section id="train" class="level2">
<h2 class="anchored" data-anchor-id="train">Train</h2>
<div id="dc0d3bbf" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>corpus      <span class="op">=</span> srcdf.description_norm.fillna(<span class="st">' '</span>).values</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">#corpus_sent = [nltk.sent_tokenize(text) for text in corpus] # &lt;-- with more formal writing this would work well</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>corpus_sent <span class="op">=</span> [d.replace(<span class="st">'.'</span>,<span class="st">' '</span>).split(<span class="st">' '</span>) <span class="cf">for</span> d <span class="kw">in</span> corpus] <span class="co"># &lt;-- deals better with many short sentences though context may end up... weird</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>model       <span class="op">=</span> Word2Vec(sentences<span class="op">=</span>corpus_sent, vector_size<span class="op">=</span>dims, window<span class="op">=</span>window, epochs<span class="op">=</span><span class="dv">200</span>, </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>                 min_count<span class="op">=</span>min_v_count, seed<span class="op">=</span><span class="dv">42</span>, workers<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co">#model.save(f"word2vec-d{dims}-w{window}.model") # &lt;-- You can then Word2Vec.load(...) which is useful with large corpora</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 4.22 s, sys: 68.1 ms, total: 4.29 s
Wall time: 4.27 s</code></pre>
</div>
</div>
</section>
<section id="explore-similarities" class="level2">
<h2 class="anchored" data-anchor-id="explore-similarities">Explore Similarities</h2>
<p>This next bit of code only runs if you have calculated the frequencies above in the <a href="#frequencies-and-ngrams">Frequencies and Ngrams</a> section.</p>
<div id="c760d33c" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_colwidth'</span>,<span class="dv">150</span>)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> fcounts[<span class="dv">1</span>] <span class="co"># &lt;-- copy out only the unigrams as we haven't trained anything else</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>n     <span class="op">=</span> <span class="dv">14</span> <span class="co"># number of words</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>topn  <span class="op">=</span> <span class="dv">7</span>  <span class="co"># number of most similar words</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>selected_words <span class="op">=</span> df[df[<span class="st">'Ngram Size 1'</span>] <span class="op">&gt;</span> <span class="dv">5</span>].reset_index().level_0.sample(n, random_state<span class="op">=</span><span class="dv">42</span>).tolist()</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> []</span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>v1    <span class="op">=</span> []</span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>v2    <span class="op">=</span> []</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>v3    <span class="op">=</span> []</span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>sims  <span class="op">=</span> []</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> w <span class="kw">in</span> selected_words:</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>: </span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a>        vector <span class="op">=</span> model.wv[w]  <span class="co"># get numpy vector of a word</span></span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(f"Word vector for '{w}' starts: {vector[:5]}...")</span></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a>        sim <span class="op">=</span> model.wv.most_similar(w, topn<span class="op">=</span>topn)</span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(f"Similar words to '{w}' include: {sim}.")</span></span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>        words.append(w)</span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>        v1.append(vector[<span class="dv">0</span>])</span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>        v2.append(vector[<span class="dv">1</span>])</span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>        v3.append(vector[<span class="dv">2</span>])</span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a>        sims.append(<span class="st">", "</span>.join([x[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> sim]))</span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Didn't find </span><span class="sc">{</span>w<span class="sc">}</span><span class="ss"> in model. Can happen with low-frequency terms."</span>)</span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a>vecs <span class="op">=</span> pd.DataFrame({</span>
<span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Term'</span>:words,</span>
<span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V1'</span>:v1, </span>
<span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V2'</span>:v2, </span>
<span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V3'</span>:v3,</span>
<span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f'Top </span><span class="sc">{</span>topn<span class="sc">}</span><span class="ss"> Similar'</span>:sims</span>
<span id="cb150-38"><a href="#cb150-38" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb150-39"><a href="#cb150-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-40"><a href="#cb150-40" aria-hidden="true" tabindex="-1"></a>vecs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Term</th>
<th data-quarto-table-cell-role="th">V1</th>
<th data-quarto-table-cell-role="th">V2</th>
<th data-quarto-table-cell-role="th">V3</th>
<th data-quarto-table-cell-role="th">Top 7 Similar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>complimentary</td>
<td>-0.957243</td>
<td>-1.486986</td>
<td>-1.123290</td>
<td>professionally, sustainable, considerate, hair, mbps, essentials, unlimited</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>equip</td>
<td>-1.839925</td>
<td>0.654449</td>
<td>-0.097641</td>
<td>equipped, diner, fullyequipped, flatscreen, plan, bathroom, sofabed</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>shower</td>
<td>0.048209</td>
<td>0.343932</td>
<td>2.158660</td>
<td>separate, corridor, toilet, shared, bathroom, multiple, bathtub</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>smart</td>
<td>1.519984</td>
<td>-1.943256</td>
<td>-0.310231</td>
<td>flatscreen, wireless, oled, inch, netflix, streaming, comfy</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>design</td>
<td>0.511491</td>
<td>1.845216</td>
<td>-1.068899</td>
<td>interior, beautifully, comfort, standout, chic, decor, feeling</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>appliance</td>
<td>0.281022</td>
<td>0.608689</td>
<td>-1.014925</td>
<td>functional, essential, necessary, kitchenette, equipped, fridge, timber</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>living</td>
<td>-1.026039</td>
<td>0.176004</td>
<td>-1.438652</td>
<td>live, separate, room, modern, table, double, ensuit</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>the</td>
<td>-3.042268</td>
<td>-3.073883</td>
<td>1.338165</td>
<td>londonelephant, furnished, both, equip, zone, couple, castle</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>directly</td>
<td>0.288156</td>
<td>-1.780736</td>
<td>-0.016401</td>
<td>pick, excel, crossharbour, incredible, themes, center, undergroundtube</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>fridgefreezer</td>
<td>-0.665757</td>
<td>0.406782</td>
<td>0.152970</td>
<td>cutlery, americanstyle, refrigerator, kettle, freezer, toaster, stave</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>bathtub</td>
<td>-1.493979</td>
<td>1.130018</td>
<td>0.971623</td>
<td>bath, walkin, ensuite, mirror, toilet, fridge, bathshower</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>train</td>
<td>-1.821561</td>
<td>-1.496900</td>
<td>-0.311242</td>
<td>taxi, elizabeth, district, tube, crossharbour, kingston, greenland</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>palace</td>
<td>1.628689</td>
<td>1.310075</td>
<td>-1.671952</td>
<td>buckingham, hyde, sloane, min, parliament, houses, cathedral</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>shard</td>
<td>0.224605</td>
<td>-0.295689</td>
<td>-1.599193</td>
<td>globe, cathedral, shoredich, borough, tower, southbank, gatwick</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="sourceCode" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print(model.wv.index_to_key) # &lt;-- the full vocabulary that has been trained</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="apply" class="level2">
<h2 class="anchored" data-anchor-id="apply">Apply</h2>
<p>Weâ€™re going to make <em>use</em> of this further next weekâ€¦</p>
<section id="questions-10" class="level3">
<h3 class="anchored" data-anchor-id="questions-10">Questions</h3>
<ul>
<li>What happens when <em>dims</em> is very small (e.g.&nbsp;25) or very large (e.g.&nbsp;300)?</li>
<li>What happens when <em>window</em> is very small (e.g.&nbsp;2) or very large (e.g.&nbsp;8)?</li>
</ul>
<p>#0. Processing the Full File</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>This code can take <em>some time</em> (<strong>&gt; 5 minutes on a M2 Mac</strong>) to run, so <strong>donâ€™t run this</strong> until youâ€™ve understood what we did before!</p>
</div>
</div>
<p>You will get a warning about <code>"." looks like a filename, not markup</code> â€” this looks a little scary, but is basically suggesting that we have a description that consists only of a â€˜.â€™ or that looks like some kind of URL (which the parser thinks means youâ€™re trying to pass it something to download).</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This can take up to 8 minutes on a M2 Mac</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'description_norm'</span>] <span class="op">=</span> <span class="st">''</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'description_norm'</span>] <span class="op">=</span> gdf.description.<span class="bu">apply</span>(normalise_document, remove_digits<span class="op">=</span><span class="va">True</span>, special_char_removal<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>gdf.to_parquet(os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>,<span class="ss">f'</span><span class="sc">{</span>fn<span class="sc">.</span>replace(<span class="st">"."</span>,<span class="st">"-with-nlp."</span>)<span class="sc">}</span><span class="ss">'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Saving an intermediate file at this point is useful because youâ€™ve done quite a bit of <em>expensive</em> computation. You <em>could</em> restart-and-run-all and then go out for the day, but probably easier to just save this output and then, if you need to restart your analysis at some point in the future, just remember to deserialise amenities back into a list format.</p>
</div>
</div>
</section>
</section>
<section id="applications" class="level2">
<h2 class="anchored" data-anchor-id="applications">Applications</h2>
<p>The above is <em>still</em> only the results for the â€˜luxuryâ€™ apartments <em>alone</em>. At this point, you would probably want to think about how your results might change if you changed any of the following:</p>
<ol type="1">
<li>Using one of the other data sets that we created, or even the entire data set!</li>
<li>Applying the CountVectorizer or TfidfVectorizer <em>before</em> selecting out any of our â€˜subâ€™ data sets.</li>
<li>Using the visualisation of information from #2 to improve our regex selection process.</li>
<li>Reducing, increasing, or constraining (i.e.&nbsp;<code>ngrams=(2,2)</code>) the size of the ngrams while bearing in mind the impact on processing time and interpretability.</li>
<li>Filtering by type of listing or host instead of keywords found in the description (for instance, what if you applied TF/IDF to the entire data set and then selected out â€˜Whole Propertiesâ€™ before splitting into those advertised by hosts with only one listing vs.&nbsp;those with multiple listings?).</li>
<li>Linking this back to the geography.</li>
</ol>
<p>Over the next few weeks weâ€™ll also consider alternative means of visualising the data!</p>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>There is a lot more information out there, including a <a href="https://www.nltk.org/book/">whole book</a> and your standard <a href="http://www.datascienceassn.org/sites/default/files/Natural%20Language%20Processing%20with%20Python.pdf">Oâ€™Reilly text</a>.</p>
<p>And some more useful links:</p>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.contains.html">Pandas String Contains Method</a></li>
<li><a href="https://kanoki.org/2019/11/12/how-to-use-regex-in-pandas/">Using Regular Expressions with Pandas</a></li>
<li><a href="https://towardsdatascience.com/using-tf-idf-to-form-descriptive-chapter-summaries-via-keyword-extraction-4e6fd857d190">Summarising Chapters from Frankenstein using TF/IDF</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jreades\.github\.io\/fsds\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2022, Jon Reades</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/favicon-16x16.png" class="height:10px img-fluid"> Foundations of Spatial Data Science</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jreades/fsds">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jreades">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>