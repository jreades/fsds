<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical 6: Spatial Data â€“ Foundations of Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<meta property="og:title" content="Practical 6: Spatial Data â€“ Foundations of Spatial Data Science">
<meta property="og:description" content="Getting to grips with Geo-Data using Geopandas">
<meta property="og:image" content="https://jreades.github.io/fsds/practicals/img/CASA_Logo_no_text.png">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-md " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/CASA_Logo_no_text.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Foundations of Spatial Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">    
        <li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Foundations</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Setting Up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Foundations (Pt.1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Foundations (Pt.2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Objects</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Data</li>
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Numeric Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/reading_week.html">
 <span class="dropdown-text">Reading Week</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Spatial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Textual Data</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Analysis</li>
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Selecting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Presenting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Wrap Up + Lookahead</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 4: Bonus</li>
        <li>
    <a class="dropdown-item" href="../sessions/week11.html">
 <span class="dropdown-text">11. Dimensions in Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week12.html">
 <span class="dropdown-text">12. Grouping Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.html">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">    
        <li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Elements</li>
        <li>
    <a class="dropdown-item" href="../assessments/exam.html">
 <span class="dropdown-text">Timed Open Book Exam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/group.html">
 <span class="dropdown-text">Group Work</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/peer.html">
 <span class="dropdown-text">Group Self-Evaluation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#reading-geo-data" id="toc-reading-geo-data" class="nav-link" data-scroll-target="#reading-geo-data">Reading Geo-Data</a></li>
  <li><a href="#writing-geo-data" id="toc-writing-geo-data" class="nav-link" data-scroll-target="#writing-geo-data">â€˜Writingâ€™ Geo-Data</a></li>
  <li><a href="#checking-the-data" id="toc-checking-the-data" class="nav-link" data-scroll-target="#checking-the-data">Checking the Data</a></li>
  <li><a href="#simple-mapping" id="toc-simple-mapping" class="nav-link" data-scroll-target="#simple-mapping">Simple Mapping</a></li>
  <li><a href="#simple-web-maps" id="toc-simple-web-maps" class="nav-link" data-scroll-target="#simple-web-maps">Simple Web Maps</a></li>
  <li><a href="#bringing-it-all-together" id="toc-bringing-it-all-together" class="nav-link" data-scroll-target="#bringing-it-all-together">Bringing it All Together</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Practical-06-Spatial_Data.ipynb" download="Practical-06-Spatial_Data.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li><li><a href="Practical-06-Spatial_Data.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 6: Spatial Data</h1>
<p class="subtitle lead">Getting to grips with Geo-Data using Geopandas</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 20%">
<col style="width: 27%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Complete</th>
<th style="text-align: left;">Part 1: Foundations</th>
<th style="text-align: left;">Part 2: Data</th>
<th style="text-align: left;">Part 3: Analysis</th>
<th style="text-align: right;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">50%</td>
<td style="text-align: left;">â–“â–“â–“â–“â–“â–“â–“â–“</td>
<td style="text-align: left;">â–“â–“â–“â–‘â–‘â–‘</td>
<td style="text-align: left;">â–‘â–‘â–‘â–‘â–‘â–‘</td>
<td style="text-align: right;">6/10</td>
</tr>
</tbody>
</table>
<style type="text/css">
.longform {
    max-height: 300px;
    overflow-y: scroll;
}
</style>
<p>Last week we did some initial processing on the Inside Airbnb listings data, focussing on its <em>numeric</em> properties. This week we are going to focus on the <em>spatial</em> properties of the data set.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>It makes life a lot easier if you gather all of the library import commands and configuration information (here having to do with <code>matplotlib</code>) in the first exectuable code block in a notebook or script. That way itâ€™s easy for you for others to see what what it is necessary to have installed before getting started!.</p>
</div>
</div>
<section id="preamble" class="level1">
<h1>Preamble</h1>
<div id="05137fb1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.font_manager</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For debugging purposes (fonts can be hard)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(matplotlib.get_cachedir())</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We change fonts the hard way in this notebook...</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># but you can also do this to change the default </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># font everywhere in one go:</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># matplotlib.rcParams['font.family'] = "Liberation Sans Narrow"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>fontname <span class="op">=</span> <span class="st">"Liberation Sans Narrow"</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>matplotlib.font_manager.FontManager().findfont(fontname, fontext<span class="op">=</span><span class="st">'ttf'</span>, rebuild_if_missing<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>/Users/jreades/.matplotlib</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'/Users/jreades/Library/Fonts/LiberationSansNarrow-Regular.ttf'</code></pre>
</div>
</div>
</section>
<section id="reading-geo-data" class="level1">
<h1>Reading Geo-Data</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ðŸ”— Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Weâ€™re building on the work done in <a href="Practical-05-Numeric_Data.ipynb">Practical 5</a> and <a href="Practical-04-Objects.ipynb">Practical 4</a> (with a particular nod to the <a href="https://jreades.github.io/fsds/sessions/week5.html#lectures">lecture on Data</a>) to create some useful functions that we can call on at-need to improve the ease of doing data analysis.</p>
</div>
</div>
<p>I find GeoPackages and GeoParquet to be by far the easiest way to distribute geo-data now: they are a single file (in a database-like format that supports multiple types of data), include the projection information by default, and in some cases QGIS can even embed information about rendering style!</p>
<p>Weâ€™re going to do something <em>similar</em> to the <code>get_url</code> in order to download the file to our hard drive and save it there. The improvement is that weâ€™ll check to see if the file already exists and, if it does, return that so that you can donâ€™t have to keep downloading it week after week.</p>
<p>Youâ€™ll need to add the documentation yourself and Iâ€™ve left a few <code>??</code> to challenge you.</p>
<section id="caching-remote-data" class="level2">
<h2 class="anchored" data-anchor-id="caching-remote-data">Caching Remote Data</h2>
<p>We donâ€™t want to continually download data over the Internet: 1) because itâ€™s not nice to whoever is hosting the data; and 2) because it requires you be online in order to run your code. So if we can â€˜cacheâ€™ the data locally so that itâ€™s only downloaded once this makes life much, much easier.</p>
<p>Iâ€™ve used the Numpy-style comments here, but the Google-style also look good in this context and all styles of answer are acceptable so long as they <em>work</em>. See overview of commenting styles <a href="https://www.datacamp.com/community/tutorials/docstrings-python">on DataCamp</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use this as an opportunity to improve your ability to read code and to learn through documentation.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> requests <span class="im">import</span> get</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cache_data(src:<span class="bu">str</span>, dest:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ??</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span>    </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> urlparse(src) <span class="co"># We assume that this is some kind of valid URL </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    fn  <span class="op">=</span> os.path.split(url.path)[??] <span class="co"># Extract the filename</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    dfn <span class="op">=</span> os.path.join(dest,fn) <span class="co">#&nbsp;Destination filename</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(dfn) <span class="kw">or</span> os.path.getsize(dfn) <span class="op">&lt;</span> <span class="dv">250</span>:</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> not found, downloading!"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> os.path.split(dest)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(path) <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">and</span> path[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            os.makedirs(os.path.join(<span class="op">*</span>path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(dfn, <span class="st">"wb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> get(src)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">file</span>.write(??.content)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\t</span><span class="st">Done downloading..."</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> locally!"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dfn</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span>(cache_data) <span class="co"># &lt;- This should show the docstring you've written</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="downloading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-the-data">Downloading the Data</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low, if your function works!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="geopackages" class="level3">
<h3 class="anchored" data-anchor-id="geopackages">Geopackages</h3>
<p>Use the function above to download and cache the GeoPackage files found <a href="https://github.com/jreades/fsds/tree/master/data/src">on GitHub</a> for Boroughs, Water, and Greenspace, then pass the output of these to GeoPandas. If you have been having trouble downloading files from GitHub, then use the understanding of the function developed above to download the file manually and place it where this function expects to find it!</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ddir  <span class="op">=</span> os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>) <span class="co"># destination directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spath <span class="op">=</span> <span class="st">'https://github.com/jreades/i2p/blob/master/data/src/'</span> <span class="co"># source path</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>boros <span class="op">=</span> gpd.read_file( ??(spath<span class="op">+</span><span class="st">'Boroughs.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>water <span class="op">=</span> gpd.read_file( ??(spath<span class="op">+</span><span class="st">'Water.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> gpd.read_file( ??(spath<span class="op">+</span><span class="st">'Greenspace.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Done.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="parquet" class="level3">
<h3 class="anchored" data-anchor-id="parquet">Parquet</h3>
<p>Letâ€™s re-use our <code>cache_data</code> function to download and save the full Inside Airbnb data set. Again, if you have trouble with downloading via code, use your understanding of the function to work out where to save your own copy of this file so that the function works as expected.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set download URL</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ymd  <span class="op">=</span> <span class="st">'2023-09-06'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>host <span class="op">=</span> <span class="st">'https://orca.casa.ucl.ac.uk'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>url  <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>host<span class="sc">}</span><span class="ss">/~jreades/data/</span><span class="sc">{</span>ymd<span class="sc">}</span><span class="ss">-listings.parquet'</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># your code here</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet( ??(??, os.path.join(<span class="st">'data'</span>,<span class="st">'raw'</span>)) )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data frame is </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> x </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see that the file was â€˜not foundâ€™ so â€˜downloadingâ€™ happened and then the size of the data frame was printed out.</p>
</section>
</section>
</section>
</section>
<section id="writing-geo-data" class="level1">
<h1>â€˜Writingâ€™ Geo-Data</h1>
<p>Of course, you will also often encounter geo-data that is not yet â€˜geographically enabledâ€™; the two most frequent contexts for this are:</p>
<ol type="1">
<li>The data represents points and is provided with latitude and longitude (or similar) as separate columns in a non-geographic data set.</li>
<li>The data represents polygons but is provided <em>separately</em> from the polygons themselves and so cannot be shown on a map without being â€˜joinedâ€™ to the geography first.</li>
</ol>
<p>Weâ€™ll tackle each of these eventually, but for now weâ€™re going to focus on the first option.</p>
<section id="creating-a-geodataframe" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-geodataframe">Creating a GeoDataFrame</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Right, weâ€™re finally there! We need to convert our coordinates into some kind of geo-data. GeoPandas offers two ways to do this: the original way using <code>zip</code> and a new utility method called <code>points_from_xy</code>. Hereâ€™s the old way:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                geometry<span class="op">=</span>[Point(x,y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(df.Longitude,df.Latitude)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note, however, that this did not automatically set a projection, unlike the new approach with the â€˜helper functionâ€™:</p>
<div id="cb55645b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.GeoDataFrame(df,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      geometry<span class="op">=</span>gpd.points_from_xy(df.longitude, df.latitude, crs<span class="op">=</span><span class="st">'epsg:4326'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="eb0d118a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(gdf))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(gdf.geometry))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'geopandas.geodataframe.GeoDataFrame'&gt;
&lt;class 'geopandas.geoseries.GeoSeries'&gt;</code></pre>
</div>
</div>
</section>
<section id="saving-geo-data-locally" class="level2">
<h2 class="anchored" data-anchor-id="saving-geo-data-locally">Saving Geo-Data Locally</h2>
<section id="think-storage-formats" class="level3">
<h3 class="anchored" data-anchor-id="think-storage-formats">Think Storage Formats</h3>
<p>We want to save the InsideAirbnb GeoDataFrame to the â€˜geoâ€™ directory, but first letâ€™s see <a href="https://geopandas.org/en/stable/docs/user_guide/io.html">what file formats are supported</a>.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: left;">Advantages</th>
<th style="text-align: left;">Disadvantages</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Shapefile</td>
<td style="text-align: left;">Wide support</td>
<td style="text-align: left;">Easy to break via loss of individual file element and not very efficient format</td>
</tr>
<tr class="even">
<td style="text-align: left;">GeoJSON</td>
<td style="text-align: left;">Human-readable</td>
<td style="text-align: left;">Highly inefficient storage format</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GeoPackage</td>
<td style="text-align: left;">Lightweight spatial database with benefits of indexing</td>
<td style="text-align: left;">Lightweight spatial database with limits on data types supported</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parquet</td>
<td style="text-align: left;">Highly compressed columnar database</td>
<td style="text-align: left;">Limited GIS support (except QGIS)</td>
</tr>
</tbody>
</table>
<p><strong>GeoPackages</strong> are really well-supported by QGIS: you can even embed multiple layers with different style information so that your final analysis is easy to distribute; however, they also carry quite a bit of overhead that makes them inefficient for distributing smaller data sets, while <em>also</em> not supporting the full spectrum of Pythonic data structures such as categorical data or lists.</p>
<p><strong>GeoParquet</strong> is an extension of the Parquet format. For working with large data sets this has revolutionised my workflow: getting excited about a columnar database might seem a bitâ€¦ nerdyâ€¦ but itâ€™s been transformative for many data scientists. First, because the data set is columnar you only read in the data that you need, so reading Parquet file is blindingly fast. Second, you can stream data from a Parquet file over the Internet, so that means you even gain these advantages reading remote files. Third, you have full support for Python data types, including (up to a point) objects. And, fourth, you can treat multiple Parquet files with the same layout as a single data set or mutiple Parquet files with different layouts as tables in a single database!</p>
</section>
<section id="specifying-a-driver" class="level3">
<h3 class="anchored" data-anchor-id="specifying-a-driver">Specifying a Driver</h3>
<p>Since there are <em>many</em> formats in which to save geo-data, rather than have multiple <code>to_format_x</code> methods, GeoPandas has <em>one</em> for local files (<code>to_file</code>). If you are reading/writing a filename than ends in a valid extension (e.g.&nbsp;<code>.shp</code>, <code>.gpkg</code>, or <code>.geojson</code>) then GeoPandas will â€˜do the right thingâ€™. Where you <em>may</em> run into trouble is if you are reading/writing a <strong>URL</strong> (e.g.&nbsp;<a href="https://github.com/jreades/fsds/blob/master/data/src/Boroughs.gpkg?raw=true">https://github.com/jreades/fsds/blob/master/data/src/Boroughs.gpkg?raw=true</a>). With a URL ending in <code>?raw=true</code> thereâ€™s no extension that GeoPandas can see so you <em>will</em> need to specify a driver. If in doubt, specify the driver.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Clarification
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this practical we are reading geodata from GitHub and Iâ€™m saying that we need to specify the driver. So why didnâ€™t we need to do with the <code>cache_data</code> function earlier as well? Well, this was a side-benefit of using the standard URL library: it <em>automatically</em> stripped off the query string (<code>?raw=true</code>) when I asked it for the file name, so we saved the file locally as a GeoPackage with <code>.gpkg</code> extension, which means that GeoPandas could read it without any problems.</p>
</div>
</div>
<p>So the following two bits of code are equivalent:</p>
<div id="0d2a9ff7" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This *may* not always do what we want, but should be fine for local files</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>boros.to_file(<span class="st">'test.gpkg'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="a83213bd" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is safer if working across computers/the Internet</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>boros.to_file(<span class="st">'test.gpkg'</span>, driver<span class="op">=</span><span class="st">'GPKG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, starting with <code>fn = â€˜2023-09-06-listings.gpkgâ€™</code></p>
<p>Notice the difference:</p>
<div id="321b9460" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-overflow-scroll code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using '</span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">' as basis for saving data..."</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   gdf.to_file(os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>,fn), driver<span class="op">=</span><span class="st">'GPKG'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">TypeError</span> <span class="im">as</span> e:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Caught type error..."</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">str</span>(e)[:<span class="dv">1000</span>] <span class="op">+</span> <span class="st">" ..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using '2023-09-06-listings.gpkg' as basis for saving data...
Caught type error...
Cannot interpret 'CategoricalDtype(categories=['Barn', 'Boat', 'Camper/RV', 'Campsite', 'Casa particular',
                  'Castle', 'Dome', 'Earthen home', 'Entire bungalow',
                  'Entire cabin', 'Entire chalet', 'Entire condo',
                  'Entire cottage', 'Entire guest suite', 'Entire guesthouse',
                  'Entire home', 'Entire home/apt', 'Entire loft',
                  'Entire place', 'Entire rental unit',
                  'Entire serviced apartment', 'Entire townhouse',
                  'Entire vacation home', 'Entire villa', 'Farm stay', 'Floor',
                  'Houseboat', 'Hut', 'Island', 'Minsu', 'Private room',
                  'Private room in bed and breakfast', 'Private room in boat',
                  'Private room in bungalow', 'Private room in cabin',
                  'Private room in camper/rv',
                  'Private room in casa particular', 'Private room in chalet',
                  'Private room in condo', 'Private room  ...</code></pre>
</div>
</div>
<p>If you try to save as a GeoPackage file then the code above typically throws a <code>TypeError</code> because of the presence of Categorical data.</p>
<p>But the below, in which we specify as a â€˜geoparquetâ€™ because of the coordinate data, does not:</p>
<div id="1497e865" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fn <span class="op">=</span> fn.replace(<span class="st">'.gpkg'</span>,<span class="st">'.geoparquet'</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>gdf.to_parquet(os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>,fn))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Saved."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saved.</code></pre>
</div>
</div>
</section>
</section>
<section id="spatial-indexing" class="level2">
<h2 class="anchored" data-anchor-id="spatial-indexing">Spatial Indexing</h2>
<p>Itâ€™s also worth comparing the output of a point with the output of a polygon or multi-polygon because you may well come across data in formats (e.g.&nbsp;WKT) resembling both of these in real data sets and they <em>can</em> be read as well. Notice too that we can use <code>loc</code> and <code>iloc</code> accessor methods to pull individual points and polygons out of a GeoDataFrame!</p>
<div id="1e01c5fd" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.geometry.iloc[<span class="dv">1</span>]) <span class="co"># Print out the object's contents</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>gdf.geometry.iloc[<span class="dv">1</span>] <span class="co"># The object knows how to print itself as a point</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>POINT (-0.21707 51.49993)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-16-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="83ce6b89" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Object to string then print out first 399 characters</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">str</span>(boros.geometry.iloc[<span class="dv">1</span>])[:<span class="dv">399</span>] <span class="op">+</span> <span class="st">"..."</span>) </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># So this is a multi-polygon boundary</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>boros.geometry.iloc[<span class="dv">1</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MULTIPOLYGON (((535009.2 159504.7, 535005.5 159502, 535002.9 159500.1, 535000.1 159503.2, 535000 159503.2, 534747.8 159517.8, 534588 159522.1, 534512.3 159780.5, 534474.8 159760.8, 534398.8 159726.7, 534391.9 159723.3, 534378.9 159712.4, 534345.1 159702.8, 534314.3 159691.8, 534292.7 159683.9, 534253.1 159666.6, 534229.4 159657.9, 534207.5 159654.6, 534160.5 159651.5, 534159.7 159637.1, 534109.5 ...</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-17-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So each element of this Series has text indicating the type of shape the geometry applies to (e.g.&nbsp;<em>POLYGON</em>) followed by a bunch of numbers. These numbers are truncated here just to make things a little more legible.</p>
</section>
</section>
<section id="checking-the-data" class="level1">
<h1>Checking the Data</h1>
<section id="checking-numeric-data" class="level3">
<h3 class="anchored" data-anchor-id="checking-numeric-data">Checking Numeric Data</h3>
<p>Before we mindlessly convert the parquet data to mappable geo-data it might make sense to sanity-check it. GeoPandas has a <code>total_bounds</code> method that gives us the bounding box for a GeoSeries, but how would we do that in Pandas?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think about what the â€˜total boundsâ€™ (or â€˜envelopeâ€™) of a point data set is. You have already seen the pandas functions youâ€™ll need to <em>find</em> theseâ€¦</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The bottom-left corner is </span><span class="sc">{??}</span><span class="ss">, </span><span class="sc">{??}</span><span class="ss">"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The top-right corner is </span><span class="sc">{??}</span><span class="ss">, </span><span class="sc">{??}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your answer should produce the following:</p>
<p>The bottom-left corner is -0.5, 51.3</p>
<p>The top-right corner is 0.3, 51.7</p>
</section>
</section>
<section id="checking-via-a-plot" class="level3">
<h3 class="anchored" data-anchor-id="checking-via-a-plot">Checking via a Plot</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Weâ€™ll see how you control figure-making more effectively later, but for now letâ€™s just see what they look like using GeoPandaâ€™s plotting functionality. If you donâ€™t see what you expected then the problem could be quite basic/fundamental.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ??:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    ??.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="checking-the-projection" class="level3">
<h3 class="anchored" data-anchor-id="checking-the-projection">Checking the Projection</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Check the projection of each GeoDataFrame using a for loop and the <code>crs</code> attribute.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> [??]:</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(g.??)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see that all three are in the <a href="https://epsg.io/27700">EPSG:27700 CRS</a> which is a common one for analysis using GB data.</p>
</section>
</section>
<section id="reprojecting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="reprojecting-the-data">Reprojecting the Data</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Letâ€™s start by taking our InsideAirbnb data in its original projectionâ€¦</p>
<div id="7f96c708" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.geometry.crs)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.total_bounds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>epsg:4326
[-0.4978     51.295937    0.29573069 51.6816423 ]</code></pre>
</div>
</div>
<p>â€¦ and reprojecting this into the <code>OSGB1936/BNG</code> CRS:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.??(??) <span class="co"># There is no 'in_place=True' option here.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.geometry.crs)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf.total_bounds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice the change in total bounds from lat/long to Northing/Easting.</p>
</section>
</section>
</section>
<section id="simple-mapping" class="level1">
<h1>Simple Mapping</h1>
<p>The files weâ€™ve just downloaded all contain polygons, and the adjustments for points are different, but itâ€™s worth seeing how you can tweak these before we start combining them. Behind the scenes, GeoPandas is using <code>matplotlib</code> to render the map, so letâ€™s play with the colours to get the <em>start</em> of something map-like.</p>
<p>You will want to look both at <a href="https://geopandas.org/mapping.html">how to make maps in GeoPandas</a> and at the different ways to <a href="https://matplotlib.org/3.1.1/tutorials/colors/colors.html#specifying-colors">specify colours in Matplotlib</a>. For the greenspace map you are looking for information about tuplesâ€¦ which can have three or four elements.</p>
<section id="work-out-the-colour-scheme" class="level2">
<h2 class="anchored" data-anchor-id="work-out-the-colour-scheme">Work Out the Colour Scheme</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>R and Python take <em>very</em> different approaches to plotting. Do <em>not</em> think of Pythonâ€™s output as being â€˜mapsâ€™ in the GIS sense, they are composed of â€˜patchesâ€™ of color on abstract â€˜axesâ€™ that can use any arbitrary coordinate space. So colours are â€˜reallyâ€™ triplet (or quadruplet if you have alpha-blending transparency) values in the range 0.0-1.0. Annotations are then added in similarly abstract fashion.</p>
</div>
</div>
<p>Iâ€™d <strong>suggest</strong> the following colour scheme as a way to test out different ways of specifying colour (though anything you like is fine so long as you manipulate the colours):</p>
<ul>
<li>The boroughs can have red edges and white fill with a thick edge.</li>
<li>The water should have no edges and XKCD Lightblue fill.</li>
<li>The greenspace should have edges and faces specified using different â€˜alpha blendingâ€™ (i.e.&nbsp;transparency) levels.</li>
</ul>
<section id="boroughs" class="level3">
<h3 class="anchored" data-anchor-id="boroughs">Boroughs</h3>
<p>By way of a hint, matplotlib uses <code>edgecolor</code> and <code>facecolor</code> for controlling â€˜patchesâ€™ (which is what polygons are considered), but the thicker-than-default line-width is specified differently (youâ€™ll need to look this up). So the intention is:</p>
<ol type="1">
<li>Thick red borough borders, and</li>
<li>White fill colour.</li>
</ol>
<p>Just to drive home how different this is from R, you can find the answer to question 1 <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html">on the page for bar plots</a>.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>boros.plot(??)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look similar to this:</p>
<div id="2727ecfd" class="cell" data-execution_count="24">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-25-output-1.png" width="654" height="485" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="water" class="level3">
<h3 class="anchored" data-anchor-id="water">Water</h3>
<p>The process is the same as above, but Iâ€™d like you to work out how to specify: 1. <em>No</em> color for an edge, and 2. An XKCD color for the face.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>water.plot(??)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look similar to this:</p>
<div id="f6cfdbc4" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-27-output-1.png" width="522" height="485" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="greenspace" class="level3">
<h3 class="anchored" data-anchor-id="greenspace">Greenspace</h3>
<p>The process is <em>also</em> the same as above, but Iâ€™d like you to work out how to specify colours and transparency using RGBA (red-green-blue-alpha transparency) tuples. So weâ€™re looking for: 1. No edge color. 2. A partially transparent green specified as a â€˜tupleâ€™ (4 numbers in parentheses in the range 0.0-1.0).</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>green.plot(??)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your plot should look similar to this:</p>
<div id="6d0346a0" class="cell" data-execution_count="28">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-29-output-1.png" width="626" height="485" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="combining-layers" class="level2">
<h2 class="anchored" data-anchor-id="combining-layers">Combining Layers</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>R and Python take <em>very</em> different approaches to plotting. Do <em>not</em> think of Pythonâ€™s output as being â€˜mapsâ€™ in the GIS sense, they are composed of â€˜patchesâ€™ of color on abstract â€˜axesâ€™ that can use any arbitrary coordinate space. So colours are â€˜reallyâ€™ numerical triplets (or quadruplets if you have transparency as well) in the range 0.0-1.0. Annotations are then added in similarly abstract fashion.</p>
</div>
</div>
<p>Now that weâ€™ve got our layers looking roughly how we want them, itâ€™s time to combine them. This is also reliant on <code>matplotlib</code> and basically involves plotting items to <em>shared axes</em> which is done by passing in <code>ax=&lt;axis object&gt;</code> to each <code>plot(...)</code>. By convention, if you only have a single figure (e.g.&nbsp;a single map) then you create an axis object and name it <code>ax</code> so you will see a lot of <code>ax=ax</code> code in graphing libraries, but <code>=ax</code> is just saying â€˜assign to the axis object that I createdâ€™.</p>
<p>Since the axes are how you control what is shown, see if you can find out by Googling how to set the x- and y-limits on the map so that it shows only London and trims out the much larger area of water that is outside of the Greater London Authority. <strong>As a rough guideline, this has the Easting range 501,000 to 563,000, and the Northing range 155,000 to 202,000.</strong></p>
<p>You can set these limits before or after you start adding layers to the â€˜mapâ€™, but itâ€™s probably easier conceptually to add them after with the idea of â€˜zooming inâ€™ on the features of interest. Itâ€™s also easier to debug since you can start by seeing if you can plot the elements at all, and <em>then</em> add the limits to zoom.</p>
<p><strong>So the steps are:</strong></p>
<ol type="1">
<li>Write the code to plot every image on the same set of axes (Iâ€™ve given you something to get started).</li>
<li>Google how to set the limits of the map and then use the ranges Iâ€™ve offered above.</li>
<li>Work out how to change the width of the edges for the boroughs layer.</li>
<li>Save it somewhere local so that you could, say, load it into a Markdown file!</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a first pass at a map, over the next few weeks weâ€™ll see how to add things like axis labels and titles to make it more â€˜map-likeâ€™. We donâ€™t have quite the built-in functionality of <code>ggplot</code> alas, but Python is advancing very quickly in this area. There is even <a href="https://github.com/yhat/ggpy">an implementation of ggplot in Python</a>, but itâ€™s functionality is more limited. In fact, thereâ€™s <a href="https://github.com/has2k1/plotnine">more than one</a>â€¦</p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Hard
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates a new figure with specified number of</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># subplots (we'll see more of this later) and </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and the specified size (in inches by default).</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">6</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all three GeoPackages to the same axes</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>water.plot(??, ax<span class="op">=</span>ax)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>green.??</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>boros.??</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the x and y limits</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the image (dpi is 'dots per inch')</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>os.??(<span class="st">'img'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>plt.savefig(os.path.join(<span class="st">'img'</span>,<span class="st">'My_First_Map.png'</span>), dpi<span class="op">=</span><span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You may wish for a different look, but hereâ€™s one version of the output:</p>
<div id="6cc7a5a6" class="cell" data-execution_count="30">
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-31-output-1.png" width="665" height="485" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="choropleth-plots" class="level2">
<h2 class="anchored" data-anchor-id="choropleth-plots">Choropleth Plots</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Now that weâ€™ve converted the InsideAirbnb data to a GeoDataFrame, we can plot it, reproject it, etc.</p>
<p>See if you can work out how to plot the points coloured by their price using the appropriate BNG projection.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gdf.to_crs(??).plot(column<span class="op">=</span>??, cmap<span class="op">=</span>??, alpha<span class="op">=</span><span class="fl">0.25</span>, markersize<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the Viridis colourmap I get the following:</p>
<div id="e4ce89e5" class="cell" data-execution_count="32">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-33-output-1.png" width="563" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="work-out-the-data-range" class="level3">
<h3 class="anchored" data-anchor-id="work-out-the-data-range">Work out the Data Range</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>As we saw above with the point-plot, in its original form the pricing data will not reveal much of interest because of the range of the data. However, as you will have seen in QM already (and as we explore in greater detail in Weeks 7/8), using <em>transformations</em> we can manipulate the data to increase its tractability for analysis.</p>
<p>Letâ€™s start by getting a feel for the full data set in terms of the range of prices that it contains:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The range of price is $</span><span class="sc">{??:,.2f}</span><span class="ss"> to $</span><span class="sc">{??:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The mean and median of the price are $</span><span class="sc">{??:,.2f}</span><span class="ss"> and $</span><span class="sc">{??:,.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice the neat little comma-separated thousands in there? Thatâ€™s fairly easy to do in English, but to use a thousands separator common to another language you would need to do something <a href="https://stackoverflow.com/questions/13082620/how-can-i-print-a-float-with-thousands-separators">a little more tricky</a>.</p>
</section>
</section>
<section id="inheritance" class="level3">
<h3 class="anchored" data-anchor-id="inheritance">Inheritance!</h3>
<p>We already know that GeoPandas <em>inherits</em> functionality from Pandas, but letâ€™s formalise thisâ€¦</p>
<p>First, letâ€™s check what class of object <code>gdf</code> is using the <a href="https://www.w3schools.com/python/ref_func_isinstance.asp"><code>isinstance</code></a> function:</p>
<div id="bf680b61" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is gdf a GeoDataFrame object?</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(gdf, gpd.GeoDataFrame): </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\t</span><span class="st">I'm a geopandas data frame!"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Is gdf *also* a DataFrame object?</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">isinstance</span>(gdf, pd.DataFrame): </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\t</span><span class="st">I'm a pandas data frame!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    I'm a geopandas data frame!
    I'm a pandas data frame!</code></pre>
</div>
</div>
</section>
<section id="benefiting-from-inheritance" class="level3">
<h3 class="anchored" data-anchor-id="benefiting-from-inheritance">Benefiting from Inheritance</h3>
<p><em>That</em> result means that we can also investigate the data using, for instance, a pandas histogram:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Oooooh, let's use a *pandas* method here</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>gdf.price.plot.??(bins<span class="op">=</span>??, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">3</span>))<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how weâ€™ve used our GeoDataFrame <em>as if</em> itâ€™s a plain old DataFrame here? Thatâ€™s the miracle of Object-Oriented Design: we can do <em>anything</em> we would with a regular Pandas <code>df</code> as we do with a GeoPandas <code>gdf</code> because GeoPandas <em>inherits</em> all the methods of its parent super-class.</p>
<p>We can see that thereâ€™s very little data above (at a guess) about $2,000, but at this scale itâ€™s hard to tell. Weâ€™ve already seen that you can use axes limits to adjust the display of a map, but the same technique applies to plain old plots because theyâ€™re fundamentally the <em>same thing</em>.</p>
<p>Try adjusting the axis so that the x-range is 0..2500:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.price.plot.??(bins<span class="op">=</span>??, figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">3</span>))<span class="op">;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ax.??</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can do the same thing with a boxplot:</p>
</section>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.price.plot.??(vert<span class="op">=</span><span class="va">False</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">3</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ax.??</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="https://stackoverflow.com/a/54023612/4041902">More complex</a> formatting is also possible if you really know your pandas and your matplotlib:</p>
<div id="77f7bbdf" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>gdf.price.plot(kind<span class="op">=</span><span class="st">'box'</span>, vert<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="bu">dict</span>(boxes<span class="op">=</span><span class="st">'r'</span>, whiskers<span class="op">=</span><span class="st">'r'</span>, medians<span class="op">=</span><span class="st">'r'</span>, caps<span class="op">=</span><span class="st">'r'</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>             boxprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>             flierprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>             medianprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>             whiskerprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>             capprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>             showfliers<span class="op">=</span><span class="va">False</span>, grid<span class="op">=</span><span class="va">False</span>, rot<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-39-output-1.png" width="583" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="truncate-and-transform" class="level2">
<h2 class="anchored" data-anchor-id="truncate-and-transform">Truncate and Transform</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Hard
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="working-it-out" class="level3">
<h3 class="anchored" data-anchor-id="working-it-out">Working it Out</h3>
<p>Anyway, drawing on everything weâ€™ve seen over the past couple of weeks (and in <em>this</em> practical) Iâ€™d like you to:</p>
<ol type="1">
<li>Try to take the natural-log of the price (<em>hint</em>: use <code>numpy</code>) and assign to a new Series called <code>lnprice</code>.</li>
<li>Work out what the error means.</li>
<li>Work out how to fix the error and <em>then</em> repeate step 1.</li>
<li>Work out how many rows were affected.</li>
<li>Report on the new min/max values.</li>
<li>Work out if other outliers need to be removed (use code from above).</li>
<li>Remove outliers and then continue with your workâ€¦</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this as a 'scratch space' to work out what's needed below...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,.0f}</span><span class="ss"> rows."</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Do the processing -------------</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You may need more than one of these 'drops'</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&nbsp;to get the data the way you want...</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>gdf.drop(gdf[??].index, axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'lnprice'</span>] <span class="op">=</span> np.log(gdf.price)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------- Check effects -----------</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"gdf now has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,.0f}</span><span class="ss"> rows."</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The range of price is </span><span class="sc">{</span>gdf<span class="sc">.</span>price<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:,.2f}</span><span class="ss"> to </span><span class="sc">{</span>gdf<span class="sc">.</span>price<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:,.2f}</span><span class="ss">"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The range of ln(price) is </span><span class="sc">{</span>gdf<span class="sc">.</span>lnprice<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:,.4f}</span><span class="ss"> to </span><span class="sc">{</span>gdf<span class="sc">.</span>lnprice<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:,.4f}</span><span class="ss">"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>gdf.price.plot(kind<span class="op">=</span><span class="st">'box'</span>, vert<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="bu">dict</span>(boxes<span class="op">=</span><span class="st">'r'</span>, whiskers<span class="op">=</span><span class="st">'r'</span>, medians<span class="op">=</span><span class="st">'r'</span>, caps<span class="op">=</span><span class="st">'r'</span>),</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>             boxprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>             flierprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>             medianprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>             whiskerprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>             capprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>             showfliers<span class="op">=</span><span class="va">False</span>, grid<span class="op">=</span><span class="va">False</span>, rot<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Price (Outliers not shown)"</span>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>gdf.lnprice.plot(kind<span class="op">=</span><span class="st">'box'</span>, vert<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>             color<span class="op">=</span><span class="bu">dict</span>(boxes<span class="op">=</span><span class="st">'r'</span>, whiskers<span class="op">=</span><span class="st">'r'</span>, medians<span class="op">=</span><span class="st">'r'</span>, caps<span class="op">=</span><span class="st">'r'</span>),</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>             boxprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>             flierprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>             medianprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>             whiskerprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>             capprops<span class="op">=</span><span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>),</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>             showfliers<span class="op">=</span><span class="va">False</span>, grid<span class="op">=</span><span class="va">False</span>, rot<span class="op">=</span><span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Ln(Price) (Outliers not shown)"</span>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="plot-options" class="level2">
<h2 class="anchored" data-anchor-id="plot-options">Plot Options</h2>
<p>Now plot the ln(price) as a chloropleth using:</p>
<ol type="1">
<li>A figure size of 9 x 6</li>
<li>A marker size of 0.25</li>
<li>The Viridis colourmap</li>
<li>A legend</li>
<li>A legend label of â€˜Natural Log of Price per Night ($)â€™</li>
</ol>
<p>Iâ€™d suggest <a href="https://geopandas.org/mapping.html">referring to the documentation</a>.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.plot(figsize<span class="op">=</span>??, marker<span class="op">=</span><span class="st">'*'</span>, markersize<span class="op">=</span><span class="fl">0.25</span>, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>         column<span class="op">=</span>??, cmap<span class="op">=</span>??, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span>??, legend_kwds<span class="op">=</span>??)<span class="op">;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Plot of Natural Log of Nightly Price for Airbnb Listings (Outliers Removed)"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get something like:</p>
<div id="0fc8c440" class="cell" data-execution_count="41">
<div class="cell-output cell-output-display" data-execution_count="37">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-42-output-1.png" width="707" height="479" class="figure-img"></p>
<figcaption>Natural Log of Price per Night ($) with Outliers REmoved</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="zooming-inout" class="level2">
<h2 class="anchored" data-anchor-id="zooming-inout">Zooming In/Out</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Thatâ€™s a little hard to see, letâ€™s try zooming in on Central London! Very roughly, letâ€™s call that an Easting range of 525,000 to 535,000 and a Northing range of 178,000 to 185,000.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Plotting
</div>
</div>
<div class="callout-body-container callout-body">
<p>We show one way to do this below (<code>f,ax = plt.subplots(...)</code>) because it gives you greater control, but <code>gdf.plot()</code> <em>can</em> return an axis object (<code>ax = gdf.plot(...)</code>) that gives you the same kind of accessâ€¦ but with a bit more â€˜faffâ€™.</p>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note this new f,ax syntax and that we then</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pass ax=ax to gdf.plot -- this has to do with</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># where and how things are plotted.</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">6</span>))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, marker<span class="op">=</span><span class="st">'*'</span>, markersize<span class="op">=</span><span class="fl">0.25</span>, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>         column<span class="op">=</span><span class="st">'lnprice'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span><span class="va">True</span>, legend_kwds<span class="op">=</span>{<span class="st">'label'</span>:<span class="st">'Natural Log of Price per Night ($)'</span>})<span class="op">;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Ln(Price/Night) for Airbnb Listings (Central London Detail)"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>ax.??</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>ax.??</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>f</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your result should look something like this:</p>
<div id="3d6358e4" class="cell" data-execution_count="43">
<div class="cell-output cell-output-display" data-execution_count="39">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-44-output-1.png" width="707" height="466" class="figure-img"></p>
<figcaption>Natural Log of Price per Night ($)</figcaption>
</figure>
</div>
</div>
</div>
<p>Thatâ€™s a little better, but ideally weâ€™d do more thinking about outliersâ€¦</p>
</section>
</section>
<section id="changing-the-classification-scheme" class="level2">
<h2 class="anchored" data-anchor-id="changing-the-classification-scheme">Changing the Classification Scheme</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Moderate (mainly computation time)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Letâ€™s give this one last try using the quantiles classification scheme for Central London!</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">7</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> gdf.plot(marker<span class="op">=</span><span class="st">'*'</span>, markersize<span class="op">=</span><span class="fl">0.25</span>, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         column<span class="op">=</span><span class="st">'lnprice'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, ??, k<span class="op">=</span><span class="dv">5</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)<span class="op">;</span> </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Note that the legend *label* had to go -- </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>         <span class="co"># there are other ways to add it.</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="dv">525000</span>,<span class="dv">535000</span>])</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">178000</span>,<span class="dv">185000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your answer should look like:</p>
<div id="654dc7e9" class="cell" data-execution_count="45">
<div class="cell-output cell-output-display" data-execution_count="41">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Practical-06-Spatial_Data_files/figure-html/cell-46-output-1.png" width="749" height="515" class="figure-img"></p>
<figcaption>Natural Log of Price per Night ($) in Central London</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="simple-web-maps" class="level1">
<h1>Simple Web Maps</h1>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Hard
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This is more for the sake of demonstrating Pythonâ€™s features than because itâ€™s part of my workflow, but what the heck, letâ€™s do it! We will create and embed a zoomable web map in the notebook; to do <em>that</em> we need to:</p>
<ol type="1">
<li>Calculate the bounds of the map using the min/max x and y coordinates above.</li>
<li>Calculate the centroid of the map from the bounds.</li>
<li>Set an appropriate zoom level.</li>
</ol>
<p>If your work is going well, perhaps you may also want to experiment with <a href="https://ipyleaflet.readthedocs.io/en/latest/api_reference/basemaps.html">different basemaps</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You canâ€™t use <code>round</code> here because it it could round up or down depending on whatâ€™s closest and, consequently, cut off data on your map. So youâ€™ll have to look for two <em>other</em> functions that do this predictably (e.g.&nbsp;always rounding down, even if the value is 4.999999). However, those functions donâ€™t handle decimals like <code>round</code> does, so you need to think about how you could turn a number like 4.99 into a number that those functions <em>can</em> work with and then turn it <em>back</em> into the decimalâ€¦</p>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> floor, ceil</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate min and max to *two* decimal places</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>xmin <span class="op">=</span> ??</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>xmax <span class="op">=</span> ??</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ymin <span class="op">=</span> ??</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>ymax <span class="op">=</span> ??</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print them to *3* decimal places to check they end in 0</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>xmin<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>xmax<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>ymin<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>ymax<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the centre of the map</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>yctr <span class="op">=</span> ??</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>xctr <span class="op">=</span> ??</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print this two ways to see an intriguing issue</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>xctr<span class="sc">:.5f}</span><span class="ss">, </span><span class="sc">{</span>yctr<span class="sc">:.5f}</span><span class="ss">"</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(xctr, yctr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should end up with something like:</p>
<div class="cell">
<pre><code>-0.530, 0.310, 51.270, 51.710
-0.11000, 51.49000
-0.10999999999999999 51.49</code></pre>
</div>
<p>Youâ€™ll see <em>why</em> this happens in the answer.</p>
<p>If youâ€™ve managed the calculations above, then this code should simply run!</p>
<div id="fabde3aa" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ipyleaflet <span class="im">import</span> Map, basemaps, basemap_to_tiles, Rectangle, projections</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the basemap can be easily changed</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>watercolor <span class="op">=</span> basemap_to_tiles(basemaps.OpenStreetMap.HOT)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> Map(layers<span class="op">=</span>(watercolor, ), center<span class="op">=</span>(yctr, xctr), zoom<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>rectangle <span class="op">=</span> Rectangle(bounds<span class="op">=</span>( (ymin, xmin), (ymax, xmax) ),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>projections.EPSG4326</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>m.add_layer(rectangle)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"70a40e370aa54e79bfd9ee971d8a85ee","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<p>Your map should look like this:</p>
<div id="647f2877" class="cell" data-execution_count="48">
<div class="cell-output cell-output-display" data-execution_count="44">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e6df1220bb0e40caa1a140c326fa5cac","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
</section>
<section id="bringing-it-all-together" class="level1">
<h1>Bringing it All Together</h1>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: ðŸ¤¯
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>To give a bit of a show of how we can put it all together try to get this working</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pysal <span class="im">as</span> p</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mapclassify <span class="im">as</span> mc</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> palettable.matplotlib <span class="im">as</span> palmpl</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> legendgram <span class="im">import</span> legendgram</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a temporary data frame here because we want</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the 'bins' to be created using only the data on the </span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># map. Otherwise, we'd have a distribution on the map </span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># that differed from the one in the legendgram and the</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># one used to calculate the breaks in the first place!</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>tgdf <span class="op">=</span> gdf[(gdf.geometry.x <span class="op">&gt;</span> <span class="dv">525000</span>) <span class="op">&amp;</span> (gdf.geometry.x <span class="op">&lt;</span> <span class="dv">540000</span>) <span class="op">&amp;</span> (gdf.geometry.y <span class="op">&gt;</span> <span class="dv">176000</span>) <span class="op">&amp;</span> (gdf.geometry.y <span class="op">&lt;</span> <span class="dv">186000</span>)].copy()</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we use Mapclassify to calculate quantiles</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (k=5) using the original price. You could use</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co"># any Mapclassify scheme at this point, though</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co"># note that for Fisher Jenks you might want to use</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># the 'Sampled' version to speed things up a bit.</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> mc.??(tgdf.price.values, ??)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="co"># We then write these binned values *back* on to the data</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="co"># frame so that we can use them with the GDF plot function.</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>tgdf[<span class="st">'bins'</span>] <span class="op">=</span> q.??</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the figure with its 'basemap'</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>f,ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>green.plot(edgecolor<span class="op">=</span>(<span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.14</span>, <span class="fl">0.25</span>), facecolor<span class="op">=</span>(<span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.14</span>, <span class="fl">0.25</span>), zorder<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>water.plot(edgecolor<span class="op">=</span><span class="st">"none"</span>, facecolor<span class="op">=</span><span class="st">'xkcd:lightblue'</span>, zorder<span class="op">=</span><span class="dv">2</span>, ax<span class="op">=</span>ax)</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>boros.plot(edgecolor<span class="op">=</span>(<span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>), facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, zorder<span class="op">=</span><span class="dv">3</span>, ax<span class="op">=</span>ax)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict the x and y axis to the data</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice it's hard-coded here *and* above</span></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a><span class="co"># this could be done *better* using a </span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co"># custom bounding box so that we could </span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="co"># update both the tgdf and the display</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a><span class="co"># area at the same time.</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>ax.set_xlim([<span class="dv">525000</span>,<span class="dv">540000</span>])</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">176000</span>,<span class="dv">186000</span>])</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>ax.axis(??) <span class="co"># Don't plot the axes</span></span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bins using a categorical legend instead</span></span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a><span class="co"># of the price using a continuous legend.</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>tgdf.plot(column<span class="op">=</span><span class="st">'bins'</span>, categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>         cmap<span class="op">=</span><span class="st">'viridis'</span>, legend<span class="op">=</span><span class="va">True</span>, marker<span class="op">=</span><span class="st">'.'</span>, markersize<span class="op">=</span><span class="fl">1.5</span>, zorder<span class="op">=</span><span class="dv">4</span>, ax<span class="op">=</span>ax)</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the title using a specified font, weight, and size</span></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'London Airbnb Listings Price Per Night'</span>, </span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>             fontdict<span class="op">=</span>{<span class="st">'fontsize'</span>:<span class="st">'20'</span>, <span class="st">'fontweight'</span>:<span class="st">'3'</span>, <span class="st">'family'</span>:fontname})  <span class="co">#provide a title</span></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a><span class="co"># This is where geopandas gets in the way -- the </span></span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical legend doesn't work for us so we need</span></span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a><span class="co"># to actually create the legend 'by hand' using this </span></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a><span class="co"># code... which first has to *find* the layer containing</span></span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a><span class="co"># the data! Each layer is a 'patch collection', so we </span></span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the collections looking for the one whose</span></span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a><span class="co"># z-order is 4 (which we set above to the data layer).</span></span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a><span class="co"># I relied on this: https://stackoverflow.com/a/71419387/4041902</span></span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a><span class="co"># to work out how to do this!</span></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> ax.collections:</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the layer with the data</span></span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> c.get_zorder()<span class="op">==</span><span class="dv">4</span>:</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># *Now* we can create a legend... but we need to </span></span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># first retrieve the colours from the layer. These</span></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># are returned as 'handles' and then we need to </span></span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># associate these with the labels taken from the</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Mapclassify object... Once we set that up, along</span></span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># with fonts and such, we can add it as an 'artist'</span></span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to the figure.</span></span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>        handles, _ <span class="op">=</span> c.legend_elements(prop<span class="op">=</span><span class="st">"colors"</span>)</span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>        legend1 <span class="op">=</span> ax.legend(handles, q.get_legend_classes(fmt<span class="op">=</span><span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>), </span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>                            loc<span class="op">=</span><span class="st">"upper right"</span>, title<span class="op">=</span><span class="st">"Price per Night"</span>, </span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>                            prop<span class="op">=</span>{<span class="st">'size'</span>:<span class="st">'10'</span>, <span class="st">'weight'</span>:<span class="st">'1'</span>, <span class="st">'family'</span>:fontname})</span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>        ax.add_artist(legend1)</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a><span class="co"># And don't forget to add a source!</span></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> ax.text(tgdf.geometry.x.<span class="bu">max</span>(), tgdf.geometry.y.<span class="bu">min</span>(), <span class="st">'Source: InsideAirbnb (2022)'</span>, </span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>             horizontalalignment<span class="op">=</span><span class="st">'right'</span>, verticalalignment<span class="op">=</span><span class="st">'bottom'</span>, </span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a>             fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">'#333333'</span>, family<span class="op">=</span>fontname)</span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a><span class="co"># And this is a nice feature: show the distribution!</span></span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> legendgram(f, ax, </span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>           tgdf.??, q.??, bins<span class="op">=</span><span class="bu">round</span>(gdf.price.<span class="bu">max</span>()<span class="op">/</span><span class="dv">25</span>),</span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>           pal<span class="op">=</span>palmpl.Viridis_5,</span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>           legend_size<span class="op">=</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>), </span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>           loc<span class="op">=</span><span class="st">'lower left'</span>,</span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>           clip<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1000</span>),</span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>           frameon<span class="op">=</span><span class="va">True</span></span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a><span class="co"># But we have to fix the font manually here</span></span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a><span class="co"># for the legendgram too</span></span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tk <span class="kw">in</span> ax2.get_xticklabels():</span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>    tk.set_fontname(fontname)</span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('Airbnb-price-all.png', dpi=150)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should have something like this:</p>
<div id="cell-fig-price-quantiles" class="cell" data-execution_count="50">
<div class="cell-output cell-output-display" data-execution_count="46">
<div id="fig-price-quantiles" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-price-quantiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Practical-06-Spatial_Data_files/figure-html/fig-price-quantiles-output-1.png" width="688" height="515" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-price-quantiles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: London Airbnb Listings Price Per Night (Quantiles)
</figcaption>
</figure>
</div>
</div>
</div>
<p>Iâ€™ll be honest, I do find ggplot easier for making good-quality; this <em>is</em> more customisable overall, but itâ€™s also much more â€˜magicalâ€™ in the sense of â€˜search for <code>matplotlib</code> examples that do what you want then copy+paste them and tweakâ€™ being the main way that most people get things working how they want.</p>
<p>Scalebars are awkward, and thereâ€™s now a library that can help with this <a href="https://github.com/ppinard/matplotlib-scalebar">on GitHub</a> that Iâ€™ve installed. But Iâ€™ll leave that one to you.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can find a lot of <em>possible</em> solutions in <a href="https://stackoverflow.com/questions/32333870/how-can-i-show-a-km-ruler-on-a-cartopy-matplotlib-plot">this Stackoverflow thread</a> that <em>should</em> work without needing to install new libraries but Iâ€™ve not had a chance to test them each individually. You would undoubtedly want to put this in an external package and import it when needed rather than paste this code into every file. But you might find it easier to <em>test</em> the solutions by pasting. If youâ€™re looking for glory (and my gratitude) then working out which of these is most generalisable (i.e.&nbsp;would work with both lat/long <em>and</em> OSGB coordinates) would be quite the challenge!</p>
</div>
</div>
</section>
<section id="getting-more-helpapplications" class="level3">
<h3 class="anchored" data-anchor-id="getting-more-helpapplications">Getting More Help/Applications</h3>
<p>A great resource for more help and more examples is Dani Arribas-Belâ€™s <em>Geographic Data Science</em> module: he has put all of his <a href="https://github.com/darribas/gds_course">module practicals online</a> (as we have too), and you might find that something that he does makes more sense to you than what weâ€™ve doneâ€¦ check it out!</p>
</section>
<section id="credits" class="level2">
<h2 class="anchored" data-anchor-id="credits">Credits!</h2>
<section id="contributors" class="level4">
<h4 class="anchored" data-anchor-id="contributors">Contributors:</h4>
<p>The following individuals have contributed to these teaching materials: Jon Reades (j.reades@ucl.ac.uk), James Millington (james.millington@kcl.ac.uk)</p>
</section>
<section id="license" class="level4">
<h4 class="anchored" data-anchor-id="license">License</h4>
<p>These teaching materials are licensed under a mix of <a href="https://opensource.org/licenses/mit-license.php">The MIT License</a> and the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 license</a>.</p>
</section>
<section id="acknowledgements" class="level4">
<h4 class="anchored" data-anchor-id="acknowledgements">Acknowledgements:</h4>
<p>Supported by the <a href="https://www.rgs.org/HomePage.htm">Royal Geographical Society</a> (with the Institute of British Geographers) with a Ray Y Gildea Jr Award.</p>
</section>
<section id="potential-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="potential-dependencies">Potential Dependencies:</h4>
<p>This notebook may depend on the following libraries: geopandas, pandas, matplotlib, seaborn</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"0bec09b1a03f46f89be5f28f3c4c9da3":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0c498228cd504a42ace132ccab25dc1f":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"move"}},"255af350a12f4e9698c70ef6a7b60e26":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"grab"}},"4d44019870454319898ed54a17103d1c":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}},"55b93e4a94314ddd8a428902c94b4ee8":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"grab"}},"657f048bd46541b6893314e77ed32a9a":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"grab"}},"70a40e370aa54e79bfd9ee971d8a85ee":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletMapView","bottom":0,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[51.489999999999995,-0.09999999999999998],"close_popup_on_click":true,"controls":["IPY_MODEL_d0767b6888b34ee3a45aadea492a90e2","IPY_MODEL_4d44019870454319898ed54a17103d1c"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_255af350a12f4e9698c70ef6a7b60e26","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_98c3aac6c1f344ab883c2f8cbcc443f0","east":0,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_efa143898d9b40a1b99ad335e005c9e8","IPY_MODEL_abddce9e3471471f9be9a2a7c7cc6806"],"layout":"IPY_MODEL_ecc1af66f28444709cb768788a8fe7e5","left":9007199254740991,"max_zoom":null,"min_zoom":null,"modisdate":"2024-08-28","north":0,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","prefer_canvas","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap"],"panes":{},"prefer_canvas":false,"right":0,"scroll_wheel_zoom":false,"south":0,"style":"IPY_MODEL_657f048bd46541b6893314e77ed32a9a","tabbable":null,"tap":true,"tap_tolerance":15,"tooltip":null,"top":9007199254740991,"touch_zoom":true,"west":0,"window_url":"","world_copy_jump":false,"zoom":8,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1}},"98c3aac6c1f344ab883c2f8cbcc443f0":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"move"}},"a83950bcd20b47a8b7f53ccd8ac1a5e1":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"abddce9e3471471f9be9a2a7c7cc6806":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletRectangleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletRectangleModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletRectangleView","base":false,"bottom":false,"bounds":[[51.29,-0.5],[51.69,0.3]],"color":"#0033FF","dash_array":null,"draggable":false,"fill":true,"fill_color":null,"fill_opacity":0.2,"line_cap":"round","line_join":"round","locations":[],"name":"","no_clip":true,"opacity":1,"options":["color","dash_array","draggable","fill","fill_color","fill_opacity","line_cap","line_join","no_clip","opacity","pointer_events","smooth_factor","stroke","transform","weight"],"pane":"","pointer_events":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"rotation":true,"scaling":true,"smooth_factor":1,"stroke":true,"subitems":[],"transform":false,"uniform_scaling":false,"weight":5}},"cac40fc1594a4899886a215a95ffb57c":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}},"d0767b6888b34ee3a45aadea492a90e2":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"e6073c62cc994da396e5ca1f39feb1f1":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","cursor":"grab"}},"e6df1220bb0e40caa1a140c326fa5cac":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletMapView","bottom":0,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[51.489999999999995,-0.09999999999999998],"close_popup_on_click":true,"controls":["IPY_MODEL_a83950bcd20b47a8b7f53ccd8ac1a5e1","IPY_MODEL_cac40fc1594a4899886a215a95ffb57c"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_55b93e4a94314ddd8a428902c94b4ee8","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_0c498228cd504a42ace132ccab25dc1f","east":0,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_ed37a343c26943ca9c4a817e9e740ccf","IPY_MODEL_fe01e483b2e9492bb7f6f1e1ae21e805"],"layout":"IPY_MODEL_0bec09b1a03f46f89be5f28f3c4c9da3","left":9007199254740991,"max_zoom":null,"min_zoom":null,"modisdate":"2024-08-28","north":0,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","prefer_canvas","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap"],"panes":{},"prefer_canvas":false,"right":0,"scroll_wheel_zoom":false,"south":0,"style":"IPY_MODEL_e6073c62cc994da396e5ca1f39feb1f1","tabbable":null,"tap":true,"tap_tolerance":15,"tooltip":null,"top":9007199254740991,"touch_zoom":true,"west":0,"window_url":"","world_copy_jump":false,"zoom":8,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1}},"ecc1af66f28444709cb768788a8fe7e5":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ed37a343c26943ca9c4a817e9e740ccf":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Tiles style by <a href=\"https://www.hotosm.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a> hosted by <a href=\"https://openstreetmap.fr/\" target=\"_blank\">OpenStreetMap France</a>","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":19,"min_native_zoom":null,"min_zoom":1,"name":"OpenStreetMap.HOT","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png","visible":true,"zoom_offset":0}},"efa143898d9b40a1b99ad335e005c9e8":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, Tiles style by <a href=\"https://www.hotosm.org/\" target=\"_blank\">Humanitarian OpenStreetMap Team</a> hosted by <a href=\"https://openstreetmap.fr/\" target=\"_blank\">OpenStreetMap France</a>","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":19,"min_native_zoom":null,"min_zoom":1,"name":"OpenStreetMap.HOT","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png","visible":true,"zoom_offset":0}},"fe01e483b2e9492bb7f6f1e1ae21e805":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletRectangleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletRectangleModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletRectangleView","base":false,"bottom":false,"bounds":[[51.29,-0.5],[51.69,0.3]],"color":"#0033FF","dash_array":null,"draggable":false,"fill":true,"fill_color":null,"fill_opacity":0.2,"line_cap":"round","line_join":"round","locations":[],"name":"","no_clip":true,"opacity":1,"options":["color","dash_array","draggable","fill","fill_color","fill_opacity","line_cap","line_join","no_clip","opacity","pointer_events","smooth_factor","stroke","transform","weight"],"pane":"","pointer_events":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"rotation":true,"scaling":true,"smooth_factor":1,"stroke":true,"subitems":[],"transform":false,"uniform_scaling":false,"weight":5}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jreades\.github\.io\/fsds\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2022, Jon Reades</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/favicon-16x16.png" class="height:10px img-fluid"> Foundations of Spatial Data Science</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jreades/fsds">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jreades">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>