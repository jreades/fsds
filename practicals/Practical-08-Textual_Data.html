<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical 8: Working with Text – Foundations of Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-fb446d74831b8ff67c69632cb314b545.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-c734b2b4d74e7e594e143a63449c09f7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<meta property="og:title" content="Practical 8: Working with Text – Foundations of Spatial Data Science">
<meta property="og:description" content="The basics of Text Mining and NLP">
<meta property="og:image" content="Practical-08-Textual_Data_files/figure-html/cell-18-output-1.png">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
<meta property="og:image:alt" content="‘Luxury’ listings in London">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-md " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/logo/logo_only_sm.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Foundations of Spatial Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">    
        <li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Foundations</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Setting Up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Foundations (Pt.1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Foundations (Pt.2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Efficient Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Objects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/reading_week.html">
 <span class="dropdown-text">Reading Week</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Process</li>
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Numeric Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Spatial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Textual Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Selecting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Presenting Data</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Bonus</li>
        <li>
    <a class="dropdown-item" href="../sessions/week11.html">
 <span class="dropdown-text">11. Dimensions in Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week12.html">
 <span class="dropdown-text">12. Grouping Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.html">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">    
        <li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Elements</li>
        <li>
    <a class="dropdown-item" href="../assessments/exam.html">
 <span class="dropdown-text">Timed Open Book Exam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/group.html">
 <span class="dropdown-text">Group Work</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/peer.html">
 <span class="dropdown-text">Group Self-Evaluation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#exploratory-textual-analysis" id="toc-exploratory-textual-analysis" class="nav-link" data-scroll-target="#exploratory-textual-analysis">Exploratory Textual Analysis</a></li>
  <li><a href="#using-regular-expressions" id="toc-using-regular-expressions" class="nav-link" data-scroll-target="#using-regular-expressions">Using Regular Expressions</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Practical-08-Textual_Data.ipynb" download="Practical-08-Textual_Data.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li><li><a href="Practical-08-Textual_Data.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 8: Working with Text</h1>
<p class="subtitle lead">The basics of Text Mining and NLP</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>A lot of the content here is provided to help you <em>understand</em> what text-cleaning does and how it generates tokens that can be processed by the various analytical approaches commonly-used in NLP. The best way to think about this is as a practical in two parts, with a bonus ‘Part 2’ that you should not expect to complete unless you probably shouldn’t be taking CASA0013 in the first place:</p>
<ol type="1">
<li>Tasks 1–3: these are largely focussed on the basics: exploring text and using regular expressions to find and select text.</li>
<li>Tasks 4–5: this might seem like a <em>bit</em> of a detour, but it’s intended to show you in a more tangible way how ‘normalisation’ works when we’re working with text.</li>
</ol>
<p>The later parts in <a href="../practicals/Practical-08-Textual_Data-Pt2.html">Part 2</a> are largely complete and ready to run; however, that <em>doesn’t</em> mean you should just skip over them and think you’ve grasped what’s happening and it will be easy to apply in your own analyses. I would <em>not</em> pay as much attention to LDA topic mining since I don’t think it’s results are that good, but I’ve included it here as it’s still commonly-used in the Digital Humanities and by Marketing folks. Word2Vec is much more powerful and forms the basis of the kinds of advances seen in ChatGPT and other LLMs.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with text is unquestionably <em>hard</em>. In fact, <em>conceptually</em> this is probaly the most challenging practical of the term! But data scientists are <em>always</em> dealing with text because so much of the data that we collect (even more so thanks to the web) is not only text-based (URLs are text!) but, increasingly, unstructured (social media posts, tags, etc.). So while getting to grips with text is a challenge, it also uniquely positions you with respect to the skills and knowledge that other graduates are offering to employers.</p>
</div>
</div>
<section id="setup" class="level1">
<h1>Setup</h1>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty Level: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>But this is only because this has been worked out for you. Starting from sctach in NLP is <em>hard</em> so people try to avoid it as much as possible.</p>
</div>
</div>
</div>
<section id="required-modules" class="level2">
<h2 class="anchored" data-anchor-id="required-modules">Required Modules</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice that the number of modules and functions that we import is steadily increasing week-on-week, and that for text processing we tend to draw on quite a wide range of utilies! That said, the three most commonly used are: <code>sklearn</code>, <code>nltk</code>, and <code>spacy</code>.</p>
</div>
</div>
<p>Standard libraries we’ve seen before.</p>
<div id="99c46c73" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> re</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">import</span> math</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This next is just a small utility function that allows us to output Markdown (like this cell) instead of plain text:</p>
<div id="6252b3dc" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display_markdown</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">def</span> as_markdown(head<span class="op">=</span><span class="st">''</span>, body<span class="op">=</span><span class="st">'Some body text'</span>):</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="cf">if</span> head <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb2-5"><a href="#cb2-5"></a>        display_markdown(<span class="ss">f"##### </span><span class="sc">{</span>head<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">&gt;</span><span class="sc">{</span>body<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>, raw<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="cf">else</span>:</span>
<span id="cb2-7"><a href="#cb2-7"></a>        display_markdown(<span class="ss">f"&gt;</span><span class="sc">{</span>body<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>, raw<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a>as_markdown(<span class="st">'Result!'</span>, <span class="st">"Here's my output..."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="result" class="level5 cell-output cell-output-display cell-output-markdown">
<h5 class="anchored" data-anchor-id="result">Result!</h5>
<blockquote class="blockquote">
<p>Here’s my output…</p>
</blockquote>
</section>
</div>
</section>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading Data</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>Because I generally want each practical to stand on its own (unless I’m trying to make a <em>point</em>), I’ve not moved this to a separate Python file (e.g.&nbsp;<code>utils.py</code>, but in line with what we covered back in the lectures on <a href="https://jreades.github.io/fsds/sessions/week3.html#lectures">Functions and Packages</a>, this sort of thing is a good candidate for being split out to a separate file to simplify re-use.</p>
</div>
</div>
<p>Remember this function from last week? We use it to save downloading files that we already have stored locally. But notice I’ve made some small changes… what do these do to help the user?</p>
<div id="bcb45f55" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="im">from</span> requests <span class="im">import</span> get</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">def</span> cache_data(src:<span class="bu">str</span>, dest:<span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="co">"""Downloads and caches a remote file locally.</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">    </span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">    The function sits between the 'read' step of a pandas or geopandas</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">    data frame and downloading the file from a remote location. The idea</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">    is that it will save it locally so that you don't need to remember to</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">    do so yourself. Subsequent re-reads of the file will return instantly</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">    rather than downloading the entire file for a second or n-th itme.</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">    </span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">    Parameters</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">    ----------</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">    src : str</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">        The remote *source* for the file, any valid URL should work.</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">    dest : str</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">        The *destination* location to save the downloaded file.</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">        </span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">    Returns</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">    -------</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">    str</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">        A string representing the local location of the file.</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">    """</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>    </span>
<span id="cb3-27"><a href="#cb3-27"></a>    url <span class="op">=</span> urlparse(src) <span class="co"># We assume that this is some kind of valid URL </span></span>
<span id="cb3-28"><a href="#cb3-28"></a>    fn  <span class="op">=</span> os.path.split(url.path)[<span class="op">-</span><span class="dv">1</span>] <span class="co"># Extract the filename</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>    dfn <span class="op">=</span> os.path.join(dest,fn) <span class="co">#&nbsp;Destination filename</span></span>
<span id="cb3-30"><a href="#cb3-30"></a>    </span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="co"># Check if dest+filename does *not* exist -- </span></span>
<span id="cb3-32"><a href="#cb3-32"></a>    <span class="co"># that would mean we have to download it! We</span></span>
<span id="cb3-33"><a href="#cb3-33"></a>    <span class="co"># also check for *very* small files that are </span></span>
<span id="cb3-34"><a href="#cb3-34"></a>    <span class="co">#&nbsp;likely to represent an incomplete download.</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(dfn) <span class="kw">or</span> os.stat(dfn).st_size <span class="op">&lt;</span> <span class="dv">250</span>:</span>
<span id="cb3-36"><a href="#cb3-36"></a>        </span>
<span id="cb3-37"><a href="#cb3-37"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> not found, downloading!"</span>)</span>
<span id="cb3-38"><a href="#cb3-38"></a></span>
<span id="cb3-39"><a href="#cb3-39"></a>        <span class="co"># Convert the path back into a list (without)</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>        <span class="co"># the filename -- we need to check that directories</span></span>
<span id="cb3-41"><a href="#cb3-41"></a>        <span class="co"># exist first.</span></span>
<span id="cb3-42"><a href="#cb3-42"></a>        path <span class="op">=</span> os.path.split(dest)</span>
<span id="cb3-43"><a href="#cb3-43"></a>        </span>
<span id="cb3-44"><a href="#cb3-44"></a>        <span class="co"># Create any missing directories in dest(ination) path</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>        <span class="co"># -- os.path.join is the reverse of split (as you saw above)</span></span>
<span id="cb3-46"><a href="#cb3-46"></a>        <span class="co"># but it doesn't work with lists... so I had to google how</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>        <span class="co"># to use the 'splat' operator! os.makedirs creates missing</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>        <span class="co"># directories in a path automatically.</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>        <span class="cf">if</span> <span class="bu">len</span>(path) <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">and</span> path[<span class="dv">0</span>] <span class="op">!=</span> <span class="st">''</span>:</span>
<span id="cb3-50"><a href="#cb3-50"></a>            os.makedirs(os.path.join(<span class="op">*</span>path), exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-51"><a href="#cb3-51"></a>            </span>
<span id="cb3-52"><a href="#cb3-52"></a>        <span class="co"># Download and write the file</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>        <span class="cf">with</span> <span class="bu">open</span>(dfn, <span class="st">"wb"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb3-54"><a href="#cb3-54"></a>            response <span class="op">=</span> get(src)</span>
<span id="cb3-55"><a href="#cb3-55"></a>            <span class="bu">file</span>.write(response.content)</span>
<span id="cb3-56"><a href="#cb3-56"></a>            </span>
<span id="cb3-57"><a href="#cb3-57"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\t</span><span class="st">Done downloading..."</span>)</span>
<span id="cb3-58"><a href="#cb3-58"></a></span>
<span id="cb3-59"><a href="#cb3-59"></a>        <span class="co"># What's this doing???</span></span>
<span id="cb3-60"><a href="#cb3-60"></a>        f_size <span class="op">=</span> os.stat(dfn).st_size</span>
<span id="cb3-61"><a href="#cb3-61"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">Size is </span><span class="sc">{</span>f_size<span class="op">/</span><span class="dv">1024</span><span class="op">**</span><span class="dv">2</span><span class="sc">:,.0f}</span><span class="ss"> MB (</span><span class="sc">{</span>f_size<span class="sc">:,}</span><span class="ss"> bytes)"</span>)</span>
<span id="cb3-62"><a href="#cb3-62"></a></span>
<span id="cb3-63"><a href="#cb3-63"></a>    <span class="cf">else</span>:</span>
<span id="cb3-64"><a href="#cb3-64"></a>        <span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>dfn<span class="sc">}</span><span class="ss"> locally!"</span>)</span>
<span id="cb3-65"><a href="#cb3-65"></a></span>
<span id="cb3-66"><a href="#cb3-66"></a>        <span class="co"># And why is it here as well???</span></span>
<span id="cb3-67"><a href="#cb3-67"></a>        f_size <span class="op">=</span> os.stat(dfn).st_size</span>
<span id="cb3-68"><a href="#cb3-68"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\t</span><span class="ss">Size is </span><span class="sc">{</span>f_size<span class="op">/</span><span class="dv">1024</span><span class="op">**</span><span class="dv">2</span><span class="sc">:,.0f}</span><span class="ss"> MB (</span><span class="sc">{</span>f_size<span class="sc">:,}</span><span class="ss"> bytes)"</span>)</span>
<span id="cb3-69"><a href="#cb3-69"></a>        </span>
<span id="cb3-70"><a href="#cb3-70"></a>    <span class="cf">return</span> dfn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For very large <em>non</em>-geographic data sets, remember that you can <code>use_cols</code> (or <code>columns</code> depending on the file type) to specify a subset of columns to load.</p>
</div>
</div>
<p>Load the main data set:</p>
<div id="73aa0f12" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>ymd  <span class="op">=</span> <span class="st">'20240614'</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>city <span class="op">=</span> <span class="st">'London'</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>host <span class="op">=</span> <span class="st">'https://orca.casa.ucl.ac.uk'</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>url  <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>host<span class="sc">}</span><span class="ss">/~jreades/data/</span><span class="sc">{</span>ymd<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss">-listings.geoparquet'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2cb2f3f1" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>gdf <span class="op">=</span> gpd.read_parquet( cache_data(url, os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>)), </span>
<span id="cb5-2"><a href="#cb5-2"></a>                      columns<span class="op">=</span>[<span class="st">'geometry'</span>, <span class="st">'listing_url'</span>, <span class="st">'name'</span>, </span>
<span id="cb5-3"><a href="#cb5-3"></a>                               <span class="st">'description'</span>, <span class="st">'amenities'</span>, <span class="st">'price'</span>])</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>gdf <span class="op">=</span> gdf.to_crs(<span class="st">'epsg:27700'</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="bu">print</span>(<span class="ss">f"gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and CRS is </span><span class="sc">{</span>gdf<span class="sc">.</span>crs<span class="sc">.</span>name<span class="sc">}</span><span class="ss">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found data/geo/20240614-London-listings.geoparquet locally!
    Size is 42 MB (44,000,824 bytes)
gdf has 85,127 rows and CRS is OSGB36 / British National Grid.</code></pre>
</div>
</div>
<p>Load supporting Geopackages:</p>
<div id="f819c334" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>ddir  <span class="op">=</span> os.path.join(<span class="st">'data'</span>,<span class="st">'geo'</span>) <span class="co"># destination directory</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>spath <span class="op">=</span> <span class="st">'https://github.com/jreades/fsds/blob/master/data/src/'</span> <span class="co"># source path</span></span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a>boros <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Boroughs.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb7-5"><a href="#cb7-5"></a>water <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Water.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb7-6"><a href="#cb7-6"></a>green <span class="op">=</span> gpd.read_file( cache_data(spath<span class="op">+</span><span class="st">'Greenspace.gpkg?raw=true'</span>, ddir) )</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="bu">print</span>(<span class="st">'Done.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Found data/geo/Boroughs.gpkg locally!
    Size is 1 MB (905,216 bytes)
Found data/geo/Water.gpkg locally!
    Size is 0 MB (208,896 bytes)
Found data/geo/Greenspace.gpkg locally!
    Size is 1 MB (1,146,880 bytes)
Done.</code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-textual-analysis" class="level1">
<h1>Exploratory Textual Analysis</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you plan to work with data post-graduation then you will <em>need</em> to become comfortable with Regular Expressions (aka. regexes). These are the focus of the <a href="https://jreades.github.io/fsds/sessions/week7.html#lectures">Patterns in Text</a> lecture but they barely even scratch the surface of what regexes can do. They are <em>hard</em>, but they are powerful.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a full text-mining application I would spend a lot more time on this stage: sampling, looking at descriptions in full, performing my analysis (the rest of the steps) and then coming back with a deeper understanding of the data to make further changes to the analysis.</p>
</div>
</div>
<p>It’s helpful to have a sense of what data look like before trying to do something with them, but by default pandas truncates quite a lot of output to keep it from overwhelming the display. For text processing, however, you should probably change the amount of preview text provided by pandas using the available options. <em>Note</em>: there are lots of other options that you can tweak in pandas.</p>
<div id="9cb7b7c6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="bu">print</span>(<span class="ss">f"Default maximum column width: </span><span class="sc">{</span>pd<span class="sc">.</span>options<span class="sc">.</span>display<span class="sc">.</span>max_colwidth<span class="sc">}</span><span class="ss">"</span>) <span class="co"># What's this currently set to?</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>pd.options.display.max_colwidth<span class="op">=</span><span class="dv">250</span>   <span class="co"># None = no maximum column width (you probably don't want to leave it at this)</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="bu">print</span>(<span class="ss">f"Now maximum column width set to: </span><span class="sc">{</span>pd<span class="sc">.</span>options<span class="sc">.</span>display<span class="sc">.</span>max_colwidth<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Default maximum column width: 50
Now maximum column width set to: 250</code></pre>
</div>
</div>
<section id="the-description-field" class="level2">
<h2 class="anchored" data-anchor-id="the-description-field">The Description Field</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate, because of the questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>To explore the description field properly you’ll need to filter out any NA/NaN descriptions before sampling the result. <em>Hint</em>: you’ll need to think about negation (<code>~</code>) of a method output that tells you if a field <em>is NA</em>.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>gdf[???].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop
</div>
</div>
<div class="callout-body-container callout-body">
<p>What do you notice about the above? Are they simple text? Are there patterns of problems? Are there characters that represent things other than words and simple punctuation?</p>
</div>
</div>
</section>
<section id="questions" class="level3">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<ul>
<li>What patterns can you see that might need ‘dealing with’ for text-mining to work?</li>
<li>What non-text characters can you see? (Things <em>other</em> than A-Z, a-z, and simple punctuation!)</li>
</ul>
</section>
</section>
<section id="the-amenities-field" class="level2">
<h2 class="anchored" data-anchor-id="the-amenities-field">The Amenities Field</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Moderate, because of the questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This field presents a subtle issue that might not be obvious here:</p>
<div id="fce03133" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>gdf.amenities.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>17638    ["Free dryer \u2013 In unit", "Hot water kettle", "Shampoo", "Luggage dropoff allowed", "Microwave", "Dining table", "Bed linens", "Hot water", "Iron", "Host greets you", "First aid kit", "Garden view", "Wine glasses", "Outdoor furniture", "Porta...
84107    ["Bathtub", "Clothing storage: closet", "Portable heater", "Microwave", "Hot water", "Host greets you", "First aid kit", "Security cameras on property", "Washer", "Fire extinguisher", "Freezer", "Lock on bedroom door", "Refrigerator", "Room-darke...
53166                                                        ["Hot water", "Iron", "Outdoor dining area", "Lock on bedroom door", "Wifi", "Shampoo", "Luggage dropoff allowed", "Smoke alarm", "Hangers", "Pets allowed", "Essentials", "Long term stays allowed"]
72159    ["Free dryer \u2013 In unit", "Clothing storage: closet", "Hot water kettle", "Shampoo", "Microwave", "Self check-in", "Dining table", "Bed linens", "Hot water", "Iron", "Conditioner", "Wine glasses", "Washer", "Coffee maker: Nespresso", "Inducti...
84441    ["Bathtub", "Clothing storage: closet", "Elevator", "Hot water", "Carbon monoxide alarm", "Central heating", "Paid street parking off premises", "Single oven", "Wifi", "Free washer \u2013 In unit", "Refrigerator", "Smoke alarm", "Kitchen", "Dryer...
Name: amenities, dtype: object</code></pre>
</div>
</div>
<p>But look what happens now, can you see the issue a little more easily?</p>
<div id="e89e8f95" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>gdf.amenities.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>'["Heating", "TV with standard cable", "Wifi", "Smoke alarm", "Dryer", "Kitchen", "Washer", "Essentials"]'</code></pre>
</div>
</div>
<section id="questions-1" class="level3">
<h3 class="anchored" data-anchor-id="questions-1">Questions</h3>
<ul>
<li>What’s the implicit format of the Amenities columns?</li>
<li>How could you represent the data contained in the column?</li>
</ul>
</section>
</section>
<section id="remove-nan-values" class="level2">
<h2 class="anchored" data-anchor-id="remove-nan-values">Remove NaN Values</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I would be wary of doing the below in a ‘proper’ application without doing some careful research first, but to make our lives easier, we’re going to drop rows where one of these values is NaN <em>now</em> so it will simplify the steps below. In reality, I would spend quite a bit more time investigating which values are NaN and why before simply dropping them.</p>
</div>
</div>
<p>Anyway, drop all rows where <em>either</em> the description or amenities (or both) are NA:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>gdf <span class="op">=</span> gdf.dropna(???)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="bu">print</span>(<span class="ss">f"Now gdf has </span><span class="sc">{</span>gdf<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get that there are <code>84,266</code> rows.</p>
</section>
</section>
</section>
<section id="using-regular-expressions" class="level1">
<h1>Using Regular Expressions</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>We’re building on the work done in <a href="../practicals/Practical-07-Spatial_Data.html">Practical 7</a>, but making use now of the lecture on <a href="https://jreades.github.io/fsds/sessions/week6.html#lectures">Patterns in Text</a>) to quickly sort through the listings.</p>
</div>
</div>
<p>There is a <em>lot</em> that can be done with Regular Expressions to identify relevant records in textual data and we’re going to use this as a starting point for the rest of the analysis. I would normally consider the regexes here a ‘first pass’ at the data, but would look very carefully at the output of the TF/IDF vectorizer, Count vectorizer, and LDA to see if I could improve my regexes for further cycles of analysis… the main gain there is that regexes are <em>much</em> faster than using the full NLP (Natural Language Processing) pipeline on the <em>full</em> data set each time. As an alternative, you could develop the pipeline using a random subsample of the data and then process the remaining records sequentially – in this context there is no justification for doing that, but with a larger corpus it might make sense.</p>
<section id="luxury-listings" class="level2">
<h2 class="anchored" data-anchor-id="luxury-listings">Luxury Listings</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Hard, because of the regular expression and questions.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>I would like you to find listings that <em>might</em> (on the basis of word choice) indicate ‘luxury’ accommodation.</p>
<section id="create-the-regular-expression" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression">Create the Regular Expression</h3>
<p>You should start with variations on ‘luxury’ (i.e.&nbsp;luxurious, luxuriate, …) and work out a <strong>single regular expression</strong> that works for variations on this <em>one</em> word. <strong>Later</strong>, I would encourage you to come back to this and consider what other words might help to signal ‘luxury’… perhaps words like ‘stunning’ or ‘prestigious’? Could you add those to the regex as well?</p>
<p><em>Hints</em>: this is a toughy, but…</p>
<ol type="1">
<li>All regular expressions work best using the <code>r'...'</code> (which means raw string) syntax.</li>
<li>You need to be able to <em>group</em> terms. Recall, however, that in Python a ‘group’ of the form <code>r'(some text)'</code> refers to matching (<code>some text</code> will be ‘memoized’/remembered), whereas what you need here is a “non-capturing group” of the <strong>positive lookahead</strong> type. That’s a Google clue right there, but you’ve also seen this in the lecture.</li>
</ol>
<p>In fact, in my real-world applications you might even need more than one group/non-capturing group in a <em>nested</em> structure.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>gdf[</span>
<span id="cb17-2"><a href="#cb17-2"></a>    gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'???'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE) <span class="co"># &lt;-- The regex</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>].sample(<span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="apply-it-to-select-data" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-select-data">Apply it to Select Data</h3>
<p>Assign it to a new data frame called <code>lux</code>:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>lux <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(<span class="vs">r'???'</span>, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb18-2"><a href="#cb18-2"></a>lux.to_parquet(os.path.join(<span class="st">'data'</span>,<span class="st">'clean'</span>,<span class="st">'luxury.geopackage'</span>))</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>lux<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> records for 'luxury' flats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get that there are <code>10,367</code> rows.</p>
</section>
</section>
<section id="plot-the-data" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data">Plot the Data</h3>
<p>Now we are going to create a more complex plot that will give space to both the spatial and price distributions using <code>subplot2grid</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="bu">help</span>(plt.subplot2grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that there are two ways to create the plot specified above. I chose route 1, but in some ways route 2 (where you specify a <code>gridspec</code> object and <em>then</em> add the axes might be a bit simpler to work out if you’re starting from scratch.</p>
<p>The critical thing here is to understand how we’er initialising a plot that has <strong>4 rows</strong> and <strong>1 column</strong> even though it is only showing <strong>2 plots</strong>. What we’re going to do is set the <em>first</em> plot to span <strong>3 rows</strong> so that it takes up 75% of the plot area (3/4), while the <em>second</em> plot only takes up 25% (1/4). They will appear one above the other, so there’s only 1 column. Here’s how to read the key parts of <code>subplot2grid</code>:</p>
<ul>
<li><code>nrows</code> – how many rows <em>of plots</em> in the figure.</li>
<li><code>ncols</code> – how many columns <em>of plots</em> in the figure.</li>
<li><code>row</code> – what row of the figure does <em>this</em> plot start on (0-indexed like a list in Python).</li>
<li><code>col</code> – what column of the figure does <em>this</em> plot start on (0-indexed like a list in Python).</li>
<li><code>rowspan</code> – how many rows of the figure does <em>this</em> plot span (<em>not</em> 0-indexed because it’s not list-like).</li>
<li><code>colspan</code> – how many columns of the figure does <em>this</em> plot span (<em>not</em> 0-indexed because it’s not list-like).</li>
</ul>
<p>Every time you call <code>subplot2grid</code> you are initialising a new axis-object into which you can then draw with your geopackage or pandas plotting methods.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a></span>
<span id="cb20-2"><a href="#cb20-2"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">9</span>,<span class="dv">6</span>))</span>
<span id="cb20-3"><a href="#cb20-3"></a>ax.remove()</span>
<span id="cb20-4"><a href="#cb20-4"></a></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co"># The first plot </span></span>
<span id="cb20-6"><a href="#cb20-6"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (???), rowspan<span class="op">=</span>???)</span>
<span id="cb20-7"><a href="#cb20-7"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb20-8"><a href="#cb20-8"></a>lux.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb20-9"><a href="#cb20-9"></a></span>
<span id="cb20-10"><a href="#cb20-10"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb20-11"><a href="#cb20-11"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co"># The second plot</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>ax2 <span class="op">=</span> plt.subplot2grid((???), (???), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-15"><a href="#cb20-15"></a>lux.price.plot.hist(bins<span class="op">=</span><span class="dv">250</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb20-16"><a href="#cb20-16"></a></span>
<span id="cb20-17"><a href="#cb20-17"></a>plt.suptitle(<span class="st">"Listings Advertising Luxury"</span>) <span class="co"># &lt;-- How does this differ from title? Change it and see!</span></span>
<span id="cb20-18"><a href="#cb20-18"></a>plt.tight_layout() <span class="co"># &lt;-- Try creating the plot *without* this to see what it changes</span></span>
<span id="cb20-19"><a href="#cb20-19"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your result should look similar to:</p>
<div id="7de215c9" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display" data-execution_count="17">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="Practical-08-Textual_Data_files/figure-html/cell-18-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="‘Luxury’ listings in London"><img src="Practical-08-Textual_Data_files/figure-html/cell-18-output-1.png" width="662" height="569" alt="‘Luxury’ listings in London" class="figure-img"></a></p>
<figcaption>‘Luxury’ listings in London</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<ul>
<li>What does <code>suptitle</code> do and how is it different from <code>title</code>? Could you use this as part of your plot-making process?</li>
<li>What does <code>tight_layout</code> do?</li>
</ul>
</section>
</section>
</section>
<section id="budget-listings" class="level2">
<h2 class="anchored" data-anchor-id="budget-listings">Budget Listings</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Easy, because you’ve worked out the hard bits already.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<section id="create-the-regular-expression-1" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression-1">Create the Regular Expression</h3>
<p>What words can you think of that might help you to spot affordable and budget accommodation? Start with just a couple of words and then I would encourage you to consider what <em>other</em> words might help to signal ‘affordability’… perhaps words like ‘cosy’ or ‘charming’ and then think about how you could you add those to the regex?</p>
<p><em>Hints</em>: this just builds on what you did above with one exception:</p>
<ol type="1">
<li>I’d try adding word boundary markers to the regex (<code>\b</code>) where appropriate…</li>
</ol>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>gdf[</span>
<span id="cb21-2"><a href="#cb21-2"></a>    gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb21-3"><a href="#cb21-3"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="apply-it-to-select-data-1" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-select-data-1">Apply it to Select Data</h3>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>aff <span class="op">=</span> gdf[gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)].copy()</span>
<span id="cb22-2"><a href="#cb22-2"></a>aff.to_parquet(os.path.join(<span class="st">'data'</span>,<span class="st">'clean'</span>,<span class="st">'affordable.geopackage'</span>))</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>aff<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows flagged as 'affordable'."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get that there are <code>8,937</code> rows.</p>
</section>
</section>
<section id="plot-the-data-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data-1">Plot the Data</h3>
<div id="a53e6d38" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb23-2"><a href="#cb23-2"></a>ax.remove()</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co"># The first plot</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb23-7"><a href="#cb23-7"></a>aff.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb23-8"><a href="#cb23-8"></a></span>
<span id="cb23-9"><a href="#cb23-9"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb23-10"><a href="#cb23-10"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb23-11"><a href="#cb23-11"></a></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co"># The second plot</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-14"><a href="#cb23-14"></a>aff.price.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb23-15"><a href="#cb23-15"></a></span>
<span id="cb23-16"><a href="#cb23-16"></a>plt.suptitle(<span class="st">"Listings Advertising Affordability"</span>)</span>
<span id="cb23-17"><a href="#cb23-17"></a>plt.tight_layout()</span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co">#plt.savefig("Affordable_Listings.png", dpi=150)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="Practical-08-Textual_Data_files/figure-html/cell-22-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="Practical-08-Textual_Data_files/figure-html/cell-22-output-1.png" width="758" height="569" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="questions-2" class="level3">
<h3 class="anchored" data-anchor-id="questions-2">Questions</h3>
<ul>
<li>Do you think that this is a <em>good</em> way to select affordable options?</li>
<li>Do you understand what <code>dpi</code> means and how <code>savefig</code> works?</li>
<li>Copy the code from above but modify it to constrain the histogram on a more limited distribution by <em>filtering</em> out the outliers <em>before</em> drawing the plot. I would copy the cell above to one just below here so that you keep a working copy available and can undo any changes that break things.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="near-bluespace" class="level2">
<h2 class="anchored" data-anchor-id="near-bluespace">Near Bluespace</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty level: Medium, because you’re still learning about regexes.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Now see if you can work out a regular expression to find accommodation that emphasises accessibility to the Thames and other ‘blue spaces’ as part of the description? One thing you’ll need to tackle is that some listings seem to say something about Thameslink and you wouldn’t want those be returned as part of a regex looking for <em>rivers</em>. So by way of a hint:</p>
<ul>
<li>You probably need to think about the Thames, rivers, and water.</li>
<li>These will probably be <em>followed</em> by a qualifier like a ‘view’ (e.g.&nbsp;Thames-view) or a front (e.g.&nbsp;water-front).</li>
<li>But you need to rule out things like “close the Thameslink station…”</li>
</ul>
<section id="create-the-regular-expression-2" class="level3">
<h3 class="anchored" data-anchor-id="create-the-regular-expression-2">Create the regular Expression</h3>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>gdf[</span>
<span id="cb25-2"><a href="#cb25-2"></a>    gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span>???, flags<span class="op">=</span>???)</span>
<span id="cb25-3"><a href="#cb25-3"></a>].sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[[<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="apply-it-to-the-select-data" class="level3">
<h3 class="anchored" data-anchor-id="apply-it-to-the-select-data">Apply it to the Select Data</h3>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>bluesp <span class="op">=</span> gdf[</span>
<span id="cb26-2"><a href="#cb26-2"></a>    (gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE)) <span class="op">|</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    (gdf.description.<span class="bu">str</span>.contains(???, regex<span class="op">=</span><span class="va">True</span>, flags<span class="op">=</span>re.IGNORECASE))</span>
<span id="cb26-4"><a href="#cb26-4"></a>].copy()</span>
<span id="cb26-5"><a href="#cb26-5"></a>bluesp.to_parquet(os.path.join(<span class="st">'data'</span>,<span class="st">'clean'</span>,<span class="st">'bluespace.geopackage'</span>))</span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="bu">print</span>(<span class="ss">f"Found </span><span class="sc">{</span>bluesp<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get that there are <code>408</code> rows.</p>
</section>
</section>
<section id="plot-the-data-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data-2">Plot the Data</h3>
<div id="71054348" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>f,ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>,figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2"></a>ax.remove()</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># The first plot</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>ax1 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">0</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb27-6"><a href="#cb27-6"></a>water.plot(edgecolor<span class="op">=</span><span class="st">'none'</span>, facecolor<span class="op">=</span>(<span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.7</span>, <span class="fl">.25</span>), ax<span class="op">=</span>ax1)</span>
<span id="cb27-7"><a href="#cb27-7"></a>boros.plot(edgecolor<span class="op">=</span><span class="st">'red'</span>, facecolor<span class="op">=</span><span class="st">'none'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.75</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb27-8"><a href="#cb27-8"></a>bluesp.plot(markersize<span class="op">=</span><span class="dv">2</span>, column<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, scheme<span class="op">=</span><span class="st">'Fisher_Jenks_Sampled'</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb27-9"><a href="#cb27-9"></a></span>
<span id="cb27-10"><a href="#cb27-10"></a>ax1.set_xlim([<span class="dv">500000</span>, <span class="dv">565000</span>])</span>
<span id="cb27-11"><a href="#cb27-11"></a>ax1.set_ylim([<span class="dv">165000</span>, <span class="dv">195000</span>])<span class="op">;</span></span>
<span id="cb27-12"><a href="#cb27-12"></a></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co"># The second plot</span></span>
<span id="cb27-14"><a href="#cb27-14"></a>ax2 <span class="op">=</span> plt.subplot2grid((<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">0</span>), rowspan<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-15"><a href="#cb27-15"></a>bluesp.price.plot.hist(bins<span class="op">=</span><span class="dv">100</span>, ax<span class="op">=</span>ax2)</span>
<span id="cb27-16"><a href="#cb27-16"></a></span>
<span id="cb27-17"><a href="#cb27-17"></a>plt.suptitle(<span class="st">"Bluespace Listings"</span>)</span>
<span id="cb27-18"><a href="#cb27-18"></a>plt.tight_layout()</span>
<span id="cb27-19"><a href="#cb27-19"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="Practical-08-Textual_Data_files/figure-html/cell-26-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="Practical-08-Textual_Data_files/figure-html/cell-26-output-1.png" width="758" height="569" class="figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="questions-3" class="level3">
<h3 class="anchored" data-anchor-id="questions-3">Questions</h3>
<ul>
<li>How else might you select listings with a view of the Thames or other bluespaces?</li>
</ul>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>There is a lot more information out there, including a <a href="https://www.nltk.org/book/">whole book</a> and your standard <a href="http://www.datascienceassn.org/sites/default/files/Natural%20Language%20Processing%20with%20Python.pdf">O’Reilly text</a>.</p>
<p>And some more useful links:</p>
<ul>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.contains.html">Pandas String Contains Method</a></li>
<li><a href="https://kanoki.org/2019/11/12/how-to-use-regex-in-pandas/">Using Regular Expressions with Pandas</a></li>
<li><a href="https://towardsdatascience.com/using-tf-idf-to-form-descriptive-chapter-summaries-via-keyword-extraction-4e6fd857d190">Summarising Chapters from Frankenstein using TF/IDF</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2022–2025, Jon Reades</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/logo/logo_only_sm.png" height="25"> Foundations of Spatial Data Science</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jreades/fsds">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://bsky.app/profile/jreades.bsky.social/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>