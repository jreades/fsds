<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Practical 6: Numeric Data – Foundations of Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="..//img/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-94502d3d680d4f599d90f0c2e6fbae98.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-805392868925c57f579070e836f82e18.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Practical 6: Numeric Data – Foundations of Spatial Data Science">
<meta property="og:description" content="Easing into EDA with Pandas">
<meta property="og:image" content="Practical-06-Numeric_Data_files/figure-html/cell-30-output-2.png">
<meta property="og:site_name" content="Foundations">
<meta property="og:locale" content="en_GB">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-md " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/CASA_Logo_no_text.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Foundations of Spatial Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Welcome</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup/index.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-by-week" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Week-by-Week</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-by-week">    
        <li>
    <a class="dropdown-item" href="../sessions/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 1: Foundations</li>
        <li>
    <a class="dropdown-item" href="../sessions/week1.html">
 <span class="dropdown-text">1. Setting Up</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week2.html">
 <span class="dropdown-text">2. Foundations (Pt.1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week3.html">
 <span class="dropdown-text">3. Foundations (Pt.2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week4.html">
 <span class="dropdown-text">4. Efficient Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week5.html">
 <span class="dropdown-text">5. Objects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/reading_week.html">
 <span class="dropdown-text">Reading Week</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 2: Process</li>
        <li>
    <a class="dropdown-item" href="../sessions/week6.html">
 <span class="dropdown-text">6. Numeric Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week7.html">
 <span class="dropdown-text">7. Spatial Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week8.html">
 <span class="dropdown-text">8. Textual Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week9.html">
 <span class="dropdown-text">9. Selecting Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week10.html">
 <span class="dropdown-text">10. Presenting Data</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Part 3: Bonus</li>
        <li>
    <a class="dropdown-item" href="../sessions/week11.html">
 <span class="dropdown-text">11. Dimensions in Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../sessions/week12.html">
 <span class="dropdown-text">12. Grouping Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../references.html">
 <span class="dropdown-text">Bibliography</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assessments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Assessments</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-assessments">    
        <li>
    <a class="dropdown-item" href="../assessments/index.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Elements</li>
        <li>
    <a class="dropdown-item" href="../assessments/exam.html">
 <span class="dropdown-text">Timed Open Book Exam</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/group.html">
 <span class="dropdown-text">Group Work</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../assessments/peer.html">
 <span class="dropdown-text">Group Self-Evaluation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../help.html"> 
<span class="menu-text">Getting Help</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-importance-of-eda" id="toc-the-importance-of-eda" class="nav-link active" data-scroll-target="#the-importance-of-eda">The Importance of EDA</a></li>
  <li><a href="#preamble" id="toc-preamble" class="nav-link" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#reading-and-writing-data" id="toc-reading-and-writing-data" class="nav-link" data-scroll-target="#reading-and-writing-data">Reading and Writing Data</a></li>
  <li><a href="#managing-your-data" id="toc-managing-your-data" class="nav-link" data-scroll-target="#managing-your-data">Managing Your Data</a></li>
  <li><a href="#exploring-your-data" id="toc-exploring-your-data" class="nav-link" data-scroll-target="#exploring-your-data">Exploring Your Data</a></li>
  <li><a href="#using-indexes" id="toc-using-indexes" class="nav-link" data-scroll-target="#using-indexes">Using Indexes</a></li>
  <li><a href="#fixing-data-types" id="toc-fixing-data-types" class="nav-link" data-scroll-target="#fixing-data-types">Fixing Data Types</a></li>
  <li><a href="#selection-using-criteria" id="toc-selection-using-criteria" class="nav-link" data-scroll-target="#selection-using-criteria">Selection using Criteria</a></li>
  <li><a href="#enhancing-our-understanding" id="toc-enhancing-our-understanding" class="nav-link" data-scroll-target="#enhancing-our-understanding">Enhancing our Understanding</a></li>
  <li><a href="#credits" id="toc-credits" class="nav-link" data-scroll-target="#credits">Credits!</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Practical-06-Numeric_Data.ipynb" download="Practical-06-Numeric_Data.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li><li><a href="Practical-06-Numeric_Data.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 6: Numeric Data</h1>
<p class="subtitle lead">Easing into EDA with Pandas</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style type="text/css">
.longform {
    max-height: 300px;
    overflow-y: scroll;
}
</style>
<p>This session is a tour-de-<code>pandas</code>; since this is Python’s equivalent of the <code>tidyverse</code> meets <code>data.tables</code> it is fundamental to the data science ecosystem and is probably one of the most-widely used libraries in the language as a whole. I get <a href="https://stackoverflow.com/questions/tagged/pandas">more than 286,000 questions</a> tagged with pandas on StackOverflow.</p>
<p>This week we are also going to start looking at the <strong><a href="http://insideairbnb.com/">InsideAirbnb</a></strong> data which forms the core of the work that we do over the rest of the term. The focus of <em>this</em> notebook is simple numeric data: no mapping or text data… yet… and direct manipulation of data types, derivation of summary statistics, and simple plotting.</p>
<p>We hope that you will be able to draw on the past few practical sessions to develop a more intuitive understanding of how to interact with pandas since it supports both a ‘dictionary-of-lists’ style of interaction <em>and</em> a methods-based style of interaction with the ‘Data Frame’.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conceptually, this practical links together <em>all</em> of the preceding ones; you will find data structures, classes and methods, reading CSV files from a remote location, <code>numpy</code>, and more than you ever wanted to know about data types in Python. Making these connections will make the remainder of term much, much easier, so it might be worth <strong>revising this practical</strong> over Reading Week so make sure it all makes sense!</p>
</div>
</div>
<section id="the-importance-of-eda" class="level1">
<h1>The Importance of EDA</h1>
<p>After a few weeks getting to grips with Python, we’re now going to start working with some real data. One of the first things that we do when working with any new data set is to familiarise ourselves with it. There are a <em>huge</em> number of ways to do this, but there are no shortcuts to:</p>
<ol type="1">
<li>Reading about the data (how it was collected, what the sample size was, etc.)</li>
<li>Reviewing any accompanying metadata (data about the data, column specs, etc.)</li>
<li>Looking at the data itself at the row- and column-levels</li>
<li>Producing descriptive statistics</li>
<li>Visualising the data using plots</li>
</ol>
<p>You should use <em>all</em> of these together to really understand where the data came from, how it was handled, and whether there are gaps or other problems. If you’re wondering which comes first, the concept of <em>start with a chart</em> is always good… though we’ve obviously not <em>quite</em> gotten there yet! This week we want you to get a handle on pandas itself, so although we will do some plotting of charts, we’ll focus on 3-4 with a tiny bit of 5. There will be much more on plotting charts next week, and you should be looking into 1 and 2 yourself based on what’s been written both on the <a href="http://insideairbnb.com/about.html">Inside Airbnb web site</a> and in the <a href="https://github.com/jreades/i2p/blob/master/ref/Bibliography.md">suggested readings</a>.</p>
<p>So although they don’t need to be done now, you probably want to add both those links to your reading list!</p>
</section>
<section id="preamble" class="level1">
<h1>Preamble</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is why we spent time talking about <a href="https://jreades.github.io/fsds/sessions/week3.html#lectures">Packages</a>, <a href="https://jreades.github.io/fsds/sessions/week4.html#lectures">Methods</a> <a href="https://jreades.github.io/fsds/sessions/week4.html#lectures">Classes</a> in the lectures… because now we’re going to be making <em>intensive</em> use of them.</p>
</div>
</div>
<p>It’s always sensible to import packages these at the top of the notebook:</p>
<ol type="1">
<li>Because it lets everyone know what they need to have installed to run your code.</li>
<li>It’s easy to run this and then skip further down the notebook if you have already done <em>some</em> of the work and saved an intermediate output.</li>
</ol>
<div id="f5a31112" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beyond what we provide below there are <a href="http://lmgtfy.com/?q=introduction+to+pandas+python">numerous</a> useful introductions; <a href="http://www.gregreda.com/2013/10/26/intro-to-pandas-data-structures/">one of our favourites</a> is from Greg Reda, and there are some <a href="https://youtu.be/TSsSWuhBpmY">good videos</a> on <a href="https://www.youtube.com/playlist?list=PLJ5Y5hxm-0W7rOOYBHf6KC6QNnWOi09kh">our YouTube channel</a>. And of course, there’s <a href="http://stackoverflow.com/questions/tagged/pandas">TONS of stuff</a> on StackOverflow. If you want an actual physical book, you might try <a href="http://shop.oreilly.com/product/0636920050896.do">McKinney (2017)</a>.</p>
<p>However, one thing you will really want to bookmark is <a href="http://pandas.pydata.org/pandas-docs/stable/">the official documentation</a> since you will undoubtedly need to refer to it fairly regularly. <em>Note</em>: this link is to the most recent release. Over time there will be updates published and you <em>may</em> find that you no longer have the most up-to-date version. If you find that you are now using an older version of pandas and the methods have changed then you’ll need to track down the <em>specific</em> version of the documentation that you need from the <a href="http://pandas.pydata.org">home page</a>.</p>
<p>You can always check what version you have installed like this:</p>
<div id="0fcea2b3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.__version__)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.2.3</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>&lt;package_name&gt;.__version__</code> approach isn’t guaranteed to work with <em>every</em> package, but it will work with most of them. Remember that variables and methods starting and ending with ‘<code>__</code>’ are <strong>private</strong> and any interaction with them should be approached very, very carefully.</p>
</div>
</div>
</section>
<section id="reading-and-writing-data" class="level1">
<h1>Reading and Writing Data</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will <em>really</em> need to get to grips with Pandas through the lectures on <a href="https://jreades.github.io/fsds/sessions/week5.html#lectures">Data</a> and <a href="https://jreades.github.io/fsds/sessions/week5.html#lectures">Pandas</a>.</p>
</div>
</div>
<p>Pandas can do a <em>lot</em>, and you might be feeling a little intimidated by this, but here’s the thing: we were already writing something like pandas from scratch! That’s because pandas takes a <strong>column-view of data</strong> in the same way that our <strong>Dictionary-of-Lists</strong> did, it’s just that it’s got a lot more features than our ‘simple’ tool did. That’s why the documentation is so much more forbidding and why pandas is so much more powerful.</p>
<p>But at its heart, a pandas <code>Data Frame</code> (<code>df</code> for short) is a collection of <code>Data Series</code> objects (i.e.&nbsp;columns) with an index. Each Series is like one of our column-lists from the last notebook. And the <code>df</code> is like the dictionary that held the data together. So you’ve seen this before and you already <em>know</em> what’s going on… or at least you now have an <em>analogy</em> that you can use to make sense of pandas:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>myDataFrame <span class="op">=</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;column_name_1&gt;'</span>: <span class="op">&lt;</span>Series_1<span class="op">&gt;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;column_name_2&gt;'</span>: <span class="op">&lt;</span>Series_2<span class="op">&gt;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;column_name_3&gt;'</span>: <span class="op">&lt;</span>Series_3<span class="op">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And pandas gives us two ways to access that data:</p>
<ol type="1">
<li>Using a method syntax: <code>myDataFrame.column_name_1</code></li>
<li>Using a dictionary syntax: <code>myDataFrame['column_name_1']</code></li>
</ol>
<p>Depending on which syntax you prefer, you can use these interchangeably. The only times you <em>have</em> to choose one over the other are:</p>
<ul>
<li>Assignment (e.g.&nbsp;<code>myDataFrame['column_name_1'] = ...</code>);</li>
<li>Columns with spaces in their names (e.g.&nbsp;<code>myDataFrame['Column Name 1')</code>).</li>
</ul>
<section id="reading-remote-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-remote-data">Reading Remote Data</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low (this time around).
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>You will need to do several things here to read the remote, compressed CSV file specified by <code>url</code> into a data frame called <code>df</code>. Setting <code>low_memory=False</code> ensures that pandas will try to load the entire data set <em>before</em> guessing the data format! Obviously, with very large files this is probably a bad idea and it’s possible to force a particular column type while readng in the data as well. For larger data sets there are platforms like <a href="https://dask.org/">Dask</a> (see, eg, <a href="https://towardsdatascience.com/why-and-how-to-use-dask-with-big-data-746e34dac7c3">this</a>), and beyond that are <a href="https://towardsdatascience.com/scaling-pandas-comparing-dask-ray-modin-vaex-and-rapids-c74c85a4e59c">other options</a>.</p>
<div id="ce846099" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set download URL</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ymd  <span class="op">=</span> <span class="st">'20240614'</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">'London'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>host <span class="op">=</span> <span class="st">'https://orca.casa.ucl.ac.uk'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>url  <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>host<span class="sc">}</span><span class="ss">/~jreades/data/</span><span class="sc">{</span>ymd<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss">-listings.csv.gz'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># your code here</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(??, compression<span class="op">=</span><span class="st">'gzip'</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data frame is </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> x </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should get a data frame containing 75 columns and 93,486 rows of data.</p>
</section>
</section>
<section id="inspecting-the-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-data-frame">Inspecting the Data Frame</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Let’s get a general sense of the data by printing out information <em>about</em> the data frame. There are several ways to do this (and we’ll see another futher on):</p>
<ul>
<li><code>df.describe(percentiles=None, include=None, exclude=None, datetime_is_numeric=False)</code> – descriptive stats for all <strong>numeric</strong> columns</li>
<li><code>df.info(verbose=None, buf=None, max_cols=None, memory_usage=None, show_counts=None)</code> – summarises all columns, but without distribution information</li>
<li><code>df.memory_usage(index=True, deep=True)</code> – memory usage details about each column (can be quite slow as it’s doing a <em>lot</em> of digging)</li>
</ul>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>What is another term for the 0.5 percentile?</p>
</section>
<section id="describing" class="level3">
<h3 class="anchored" data-anchor-id="describing">Describing</h3>
<p>Describing a data frame provides general information about <em>numeric</em> columns, such as the median, IQR, or number of discrete values.</p>
<p>So to show the 5th and 95th percentiles you need to pass an argument to <code>describe</code> to override the default report from pandas:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.describe(percentiles<span class="op">=</span>[??])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="info" class="level3">
<h3 class="anchored" data-anchor-id="info">Info</h3>
<p>The <code>info</code> method provides a more system-oriented view of the data frame, helping you to understand what each column is composed of, how many NAs there might be, and some high-level (but often incomplete) data on performance.</p>
<div class="longform">
<div id="3332a623" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.info(verbose<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 93486 entries, 0 to 93485
Data columns (total 75 columns):
 #   Column                                        Non-Null Count  Dtype  
---  ------                                        --------------  -----  
 0   id                                            93481 non-null  float64
 1   listing_url                                   93485 non-null  object 
 2   scrape_id                                     93485 non-null  object 
 3   last_scraped                                  93485 non-null  object 
 4   source                                        93486 non-null  object 
 5   name                                          93486 non-null  object 
 6   description                                   90297 non-null  object 
 7   neighborhood_overview                         46673 non-null  object 
 8   picture_url                                   93477 non-null  object 
 9   host_id                                       93486 non-null  float64
 10  host_url                                      93486 non-null  object 
 11  host_name                                     93480 non-null  object 
 12  host_since                                    93480 non-null  object 
 13  host_location                                 72291 non-null  object 
 14  host_about                                    47802 non-null  object 
 15  host_response_time                            62226 non-null  object 
 16  host_response_rate                            62231 non-null  object 
 17  host_acceptance_rate                          67455 non-null  object 
 18  host_is_superhost                             93022 non-null  object 
 19  host_thumbnail_url                            93475 non-null  object 
 20  host_picture_url                              93475 non-null  object 
 21  host_neighbourhood                            46906 non-null  object 
 22  host_listings_count                           93475 non-null  object 
 23  host_total_listings_count                     93475 non-null  float64
 24  host_verifications                            93474 non-null  object 
 25  host_has_profile_pic                          93475 non-null  object 
 26  host_identity_verified                        93474 non-null  object 
 27  neighbourhood                                 46675 non-null  object 
 28  neighbourhood_cleansed                        93481 non-null  object 
 29  neighbourhood_group_cleansed                  5 non-null      float64
 30  latitude                                      93481 non-null  float64
 31  longitude                                     93481 non-null  float64
 32  property_type                                 93481 non-null  object 
 33  room_type                                     93481 non-null  object 
 34  accommodates                                  93481 non-null  float64
 35  bathrooms                                     61355 non-null  float64
 36  bathrooms_text                                93331 non-null  object 
 37  bedrooms                                      81800 non-null  float64
 38  beds                                          61289 non-null  float64
 39  amenities                                     93481 non-null  object 
 40  price                                         61423 non-null  object 
 41  minimum_nights                                93481 non-null  object 
 42  maximum_nights                                93481 non-null  float64
 43  minimum_minimum_nights                        93480 non-null  float64
 44  maximum_minimum_nights                        93480 non-null  float64
 45  minimum_maximum_nights                        93479 non-null  object 
 46  maximum_maximum_nights                        93479 non-null  object 
 47  minimum_nights_avg_ntm                        93479 non-null  float64
 48  maximum_nights_avg_ntm                        93479 non-null  float64
 49  calendar_updated                              4 non-null      float64
 50  has_availability                              89394 non-null  object 
 51  availability_30                               93480 non-null  float64
 52  availability_60                               93480 non-null  float64
 53  availability_90                               93480 non-null  float64
 54  availability_365                              93476 non-null  float64
 55  calendar_last_scraped                         93481 non-null  object 
 56  number_of_reviews                             93481 non-null  float64
 57  number_of_reviews_ltm                         93481 non-null  float64
 58  number_of_reviews_l30d                        93481 non-null  float64
 59  first_review                                  68740 non-null  object 
 60  last_review                                   68739 non-null  object 
 61  review_scores_rating                          68735 non-null  float64
 62  review_scores_accuracy                        68657 non-null  float64
 63  review_scores_cleanliness                     68664 non-null  float64
 64  review_scores_checkin                         68627 non-null  float64
 65  review_scores_communication                   68652 non-null  float64
 66  review_scores_location                        68626 non-null  float64
 67  review_scores_value                           68627 non-null  float64
 68  license                                       0 non-null      float64
 69  instant_bookable                              93476 non-null  object 
 70  calculated_host_listings_count                93476 non-null  float64
 71  calculated_host_listings_count_entire_homes   93476 non-null  float64
 72  calculated_host_listings_count_private_rooms  93476 non-null  float64
 73  calculated_host_listings_count_shared_rooms   93476 non-null  float64
 74  reviews_per_month                             68735 non-null  float64
dtypes: float64(36), object(39)
memory usage: 53.5+ MB</code></pre>
</div>
</div>
</div>
<p>You should get that the data frame has a mix of <code>float64</code>, <code>int</code>, and <code>object</code> (text) columns and that some columns contain many nulls. You will also get an <em>estimate</em> of memory usage that may differ substantially from the more complete picture provided below, which suggests a ‘true’ value of 398MB.</p>
</section>
<section id="memory-usage" class="level3">
<h3 class="anchored" data-anchor-id="memory-usage">Memory Usage</h3>
<p>If you really need to get into the ‘weeds’ and profile your data frame because you are crashing Python and seeing messages about ‘core dumped’, or seeing appallingly poor performance, then <code>memory_usage</code> is the way to go:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df.memory_usage(index<span class="op">=</span><span class="va">True</span>, deep<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="longform">
<div id="d59c319a" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>Index                                               132
id                                               747888
listing_url                                     9290686
scrape_id                                       6637426
last_scraped                                    6263498
                                                 ...   
calculated_host_listings_count                   747888
calculated_host_listings_count_entire_homes      747888
calculated_host_listings_count_private_rooms     747888
calculated_host_listings_count_shared_rooms      747888
reviews_per_month                                747888
Length: 76, dtype: int64</code></pre>
</div>
</div>
</div>
<p>You should see that the data frame uses 417,473,797 bytes of memory, but the <em>really</em> important thing to note here is the difference between <code>string</code> and other types of data: keeping data as raw strings (instead of converting to categories, for instance) uses up a <em>lot</em> more memory and this can have a huge impact on the performance of your code.</p>
</section>
<section id="printing-the-columns" class="level3">
<h3 class="anchored" data-anchor-id="printing-the-columns">Printing the Columns</h3>
<p>Finally, I find it <em>very</em> useful to be able to quickly print out a list of the <strong>columns</strong> without all of the details shown above. You just need to <em>print</em> the <em>columns</em> as a <em>list</em>:</p>
<div id="473ba739" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.columns.to_list())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['id', 'listing_url', 'scrape_id', 'last_scraped', 'source', 'name', 'description', 'neighborhood_overview', 'picture_url', 'host_id', 'host_url', 'host_name', 'host_since', 'host_location', 'host_about', 'host_response_time', 'host_response_rate', 'host_acceptance_rate', 'host_is_superhost', 'host_thumbnail_url', 'host_picture_url', 'host_neighbourhood', 'host_listings_count', 'host_total_listings_count', 'host_verifications', 'host_has_profile_pic', 'host_identity_verified', 'neighbourhood', 'neighbourhood_cleansed', 'neighbourhood_group_cleansed', 'latitude', 'longitude', 'property_type', 'room_type', 'accommodates', 'bathrooms', 'bathrooms_text', 'bedrooms', 'beds', 'amenities', 'price', 'minimum_nights', 'maximum_nights', 'minimum_minimum_nights', 'maximum_minimum_nights', 'minimum_maximum_nights', 'maximum_maximum_nights', 'minimum_nights_avg_ntm', 'maximum_nights_avg_ntm', 'calendar_updated', 'has_availability', 'availability_30', 'availability_60', 'availability_90', 'availability_365', 'calendar_last_scraped', 'number_of_reviews', 'number_of_reviews_ltm', 'number_of_reviews_l30d', 'first_review', 'last_review', 'review_scores_rating', 'review_scores_accuracy', 'review_scores_cleanliness', 'review_scores_checkin', 'review_scores_communication', 'review_scores_location', 'review_scores_value', 'license', 'instant_bookable', 'calculated_host_listings_count', 'calculated_host_listings_count_entire_homes', 'calculated_host_listings_count_private_rooms', 'calculated_host_listings_count_shared_rooms', 'reviews_per_month']</code></pre>
</div>
</div>
<p>You should get a list showing every single column. If you get <code>Index(['id', 'listing_url',...], dtype='object')</code> then you have printed the column <em>index</em> object and you to need to tell the object to convert its output <strong>to a list</strong> (<em>hint</em>: Google).</p>
</section>
</section>
<section id="saving-the-file-locally" class="level2">
<h2 class="anchored" data-anchor-id="saving-the-file-locally">Saving the File Locally</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Now save the file somewhere local so that you don’t have to keep downloading 40MB of compressed data every time you want to start the practical. We’ll be using this data for the rest of term, so you might as well save yourself some time and bandwidth! We’ll talk more about data processing pipelines over the course of the term, but I’d suggest putting this data set into a <code>data/raw</code> folder because then you can have directories like <code>data/clean</code> and <code>data/analytical</code> as you move through the process of cleaning and prepping your data for analysis.</p>
<div id="b391f934" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(<span class="st">'data'</span>,<span class="st">'raw'</span>) <span class="co"># A default location to save raw data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fn   <span class="op">=</span> url.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]         <span class="co"># What does this do?</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Writing to: </span><span class="sc">{</span>fn<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Writing to: 20240614-London-listings.csv.gz</code></pre>
</div>
</div>
<div id="ba3bbdda" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(path):      <span class="co"># And what does *this* do?</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Creating </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss"> under </span><span class="sc">{</span>os<span class="sc">.</span>getcwd()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    os.makedirs(path)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(os.path.join(path,fn)):  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    df.to_csv(os.path.join(path,fn), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Done."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="managing-your-data" class="level1">
<h1>Managing Your Data</h1>
<p>When starting out it’s common to think in terms of there being one input (the raw data) and one output (the results) to an analysis. In practice, you will have many intermediate outputs used as ‘milestones’ in the overall analysis:</p>
<ul>
<li>You might have a ‘canonical’ data file that has dealt with formatting issues and converted the columns to appropriate data types.</li>
<li>You might have a ‘clean’ data file that has dealt with observations that seem to be incomplete or otherwise improperly formatted.</li>
<li>You might generate subsets by region or area.</li>
<li>You might produce an ‘analytical’ or ‘final’ data set appropriate to a specific analysis.</li>
</ul>
<p><strong>Most importantly</strong>, if you are going to run the same analysis multiple times using data from different time periods (e.g.&nbsp;Land Registry’s Price Paid Data is updated every month) then you will <em>multiple</em> versions of each of each of the above.</p>
<p>But, <em>in addition</em>, you might also be working with such a large data set that processing the <em>entire</em> thing every time you want to do some development work is impractical: do you want to load 1 billion rows only to find out that you needed 1,000 of them or that one of your columns is incorrectly formatted?</p>
<p>So although you <em>could</em> do the next few steps as part of loading the <em>raw</em> data, I always prefer to keep the original data set handy since I almost always discover that there are fields I didn’t realise I needed when I started my work.</p>
<p>So my approach to coding is usually:</p>
<ol type="1">
<li>Download the raw file and save it locally in a <code>data/raw</code> directory.</li>
<li>Load the first <code>nrows</code> of data so that I can quickly:
<ul>
<li>Check that the specification matches the data and select columns/rows accordingly.</li>
<li>Identify obviously invalid rows/columns and investigate further.</li>
<li>Check the code to fix data types and (where relevant) values works.</li>
<li>Write this new, smaller file (<span class="math inline">\(m` &lt;&lt; m\)</span> and <span class="math inline">\(n` &lt;&lt; n\)</span>) out to a <code>data/clean</code> or <code>data/canonical</code> directory (depending on whether formatting the columns is so complex or takes so long on a large data set that it needs to be separated out from actual cleaning).</li>
<li>Test out some initial ideas for further analysis.</li>
</ul></li>
<li>Re-run the code (remove the <code>nrows</code> limit) using the full data set.</li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Although the code here is simple, the logic is not.</p>
</div>
</div>
</div>
<section id="file-names" class="level2">
<h2 class="anchored" data-anchor-id="file-names">File Names</h2>
<p>You should always be looking for ways to <em>avoid</em> hard-coding values that might change over time, especially those linked to the date of the data file.</p>
<p>In this case you might try to work out how to make it easy to update the code to download the latest file. For instance, if the file looks like <code>2022-09-10-listings.csv.gz</code> then I might well specify the <code>url</code> as <code>{date}-listings.csv.gz</code> or <code>{year}-{month}-{day}-listings.csv.gz</code> and set up the variables that I need beforehand or in a separate file.</p>
<p>Using parameters makes it easier to write robust code that doesn’t have unwanted side-effects. Here’s a common one: you write code to download and process a file named <code>20221111-data.csv.gz</code>. After doing all the steps in Tasks 2 and 3 below you save it to <code>clean-data.csv.gz</code>.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>What happens when your boss asks you to process <code>20221211-data.csv.gz</code>?</p>
</section>
</section>
<section id="file-loading" class="level2">
<h2 class="anchored" data-anchor-id="file-loading">File Loading</h2>
<p>Now let’s write something that will allow us to more quickly write our code and validate the results in exploratory phase. For simplicity I’ve called this ‘testing’, but you could also think of it as ‘dev’ mode. What we want is to be able to easily swap between testing and operational contexts using a ‘switch’ (typically, a Boolean value) and limit the data load in testing mode.</p>
<p>To achieve this you could set pandas to:</p>
<ul>
<li>Load only the first 10,000 rows using <code>nrows</code> <em>if</em> we are testing</li>
<li>Use the columns specified in <code>cols</code></li>
<li>Allow pandas to load the entire data set before deciding on the column type by setting <code>low_memory</code> appropriately.</li>
</ul>
<section id="row-subsetting" class="level3">
<h3 class="anchored" data-anchor-id="row-subsetting">Row Subsetting</h3>
<p>Let’s tackle the <em>rows</em> problem first:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>testing <span class="op">=</span> <span class="va">True</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> testing:</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(os.path.join(path,fn), </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                low_memory<span class="op">=</span>??, ??)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(os.path.join(path,fn), </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                low_memory<span class="op">=</span>??)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data frame is </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> x </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So notice how this code deliberately works the same for either testing <em>or</em> operational execution – we just flip between the option by changing the <code>testing</code> variable from <code>True</code> to <code>False</code>!</p>
<p>To make this more robust and useful we could use this <code>testing</code> variable <em>throughout</em> our code if we wanted to change other behaviours based on development/deployment context. The state of the switch could then be set globally using an external configuration file (usually just called a ‘conf file’). The easiest way to do this is to have a <code>conf.py</code> which contains your global parameters and then every script or notebook file reads in the configuration and sets these variables.</p>
<p>Something like:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>testing <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> conf <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="column-subsetting" class="level3">
<h3 class="anchored" data-anchor-id="column-subsetting">Column Subsetting</h3>
<p>Now let’s tackle the column problem… In order to avoid having to load lots of data that we aren’t sure we need yet, we can restrict the columns that we load. We got <code>cols</code> below by copying the output of (<code>df.columns.to_list()</code> and then removing the fields that we thought we <em>weren’t</em> interested in.</p>
<div id="1a817e42" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'id'</span>, <span class="st">'listing_url'</span>, <span class="st">'last_scraped'</span>, <span class="st">'name'</span>, <span class="st">'description'</span>, <span class="st">'host_id'</span>, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'host_name'</span>, <span class="st">'host_since'</span>, <span class="st">'host_location'</span>, <span class="st">'host_about'</span>, <span class="st">'host_is_superhost'</span>, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'host_listings_count'</span>, <span class="st">'host_total_listings_count'</span>, <span class="st">'host_verifications'</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'latitude'</span>, <span class="st">'longitude'</span>, <span class="st">'property_type'</span>, <span class="st">'room_type'</span>, <span class="st">'accommodates'</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bathrooms'</span>, <span class="st">'bathrooms_text'</span>, <span class="st">'bedrooms'</span>, <span class="st">'beds'</span>, <span class="st">'amenities'</span>, <span class="st">'price'</span>, </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'minimum_nights'</span>, <span class="st">'maximum_nights'</span>, <span class="st">'availability_365'</span>, <span class="st">'number_of_reviews'</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'first_review'</span>, <span class="st">'last_review'</span>, <span class="st">'review_scores_rating'</span>, <span class="st">'license'</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'reviews_per_month'</span>]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cols contains </span><span class="sc">{</span><span class="bu">len</span>(cols)<span class="sc">}</span><span class="ss"> columns."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cols contains 34 columns.</code></pre>
</div>
</div>
<p>So let’s extend our previous answer</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>testing <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> testing:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(os.path.join(path,fn), </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                low_memory<span class="op">=</span><span class="va">False</span>, nrows<span class="op">=</span><span class="dv">10000</span>, ??)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(os.path.join(path,fn), </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                low_memory<span class="op">=</span><span class="va">False</span>, ??)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data frame is </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> x </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="releasing-memory" class="level2">
<h2 class="anchored" data-anchor-id="releasing-memory">Releasing Memory</h2>
<p>A particular risk when working with Jupyter notebooks is that you either: a) have run code in an order <em>other</em> than the order shown in the notebook; or b) have made edits to code but <em>not</em> re-run the changed code. So you’re still working from code that is no longer visible!</p>
<p>When that happens you can get <em>very</em> confusing issues because what you <em>see</em> doesn’t square with what the computer has <em>executed</em>. To resolve this without having to re-run the entire notebook (though that can <em>also</em> be a good choice!) you might want to ‘delete’ the current object and re-load or re-run the relevant data or code.</p>
<div id="3d234b1a" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So we use <code>del(df)</code> to ensure that we aren’t accidentally using the ‘old’ data frame. But another good reason to delete data you’re no longer using is to free up memory.</p>
</section>
</section>
<section id="exploring-your-data" class="level1">
<h1>Exploring Your Data</h1>
<p>Let’s start over from the saved data:</p>
<div id="3497fca9" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(path,fn), </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                low_memory<span class="op">=</span><span class="va">False</span>, usecols<span class="op">=</span>cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="selecting-rows" class="level2">
<h2 class="anchored" data-anchor-id="selecting-rows">Selecting Rows</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🔗 Connections
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will want to refer to the <a href="https://jreades.github.io/fsds/sessions/week5.html#lectures">Randomness</a> lecture to understand how we can select the <em>same</em> random sample each time and to the session on <a href="https://jreades.github.io/fsds/sessions/week5.html#lectures">Logic</a> lecture to cover <code>NaN</code>s and <code>NA</code>s.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>I often like to start my EDA by simply printing out randomly-selected rows to get a feel for what’s in the data. Does what I see square with what I read in the documentation? What does the <code>name</code> look like? What do I see in <code>last_scraped</code> and is it a sensible? What’s the <code>id</code> field for?</p>
<div id="a5f86f4d" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">host_location</th>
<th data-quarto-table-cell-role="th">host_about</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">availability_365</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">26908</td>
<td>2.742332e+07</td>
<td>https://www.airbnb.com/rooms/27423325</td>
<td>2023-09-07</td>
<td>Serviced apartment in London · 2 bedrooms · 2 ...</td>
<td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;The 2 Two Bed­room apart...</td>
<td>194048242.0</td>
<td>Ashburn</td>
<td>2018-06-07</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>$511.00</td>
<td>1</td>
<td>1125.0</td>
<td>201.0</td>
<td>1.0</td>
<td>2022-08-27</td>
<td>2022-08-27</td>
<td>5.00</td>
<td>NaN</td>
<td>0.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">76365</td>
<td>9.073725e+17</td>
<td>https://www.airbnb.com/rooms/907372454601544521</td>
<td>2023-09-06</td>
<td>Condo in Greater London · ★4.45 · 1 bedroom · ...</td>
<td>This stylish place to stay is perfect for grou...</td>
<td>81827675.0</td>
<td>Ayoob</td>
<td>2016-07-05</td>
<td>London, United Kingdom</td>
<td>I live and work in central London and enjoy h...</td>
<td>...</td>
<td>$149.00</td>
<td>1</td>
<td>365.0</td>
<td>293.0</td>
<td>11.0</td>
<td>2023-06-08</td>
<td>2023-08-29</td>
<td>4.45</td>
<td>NaN</td>
<td>3.63</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29748</td>
<td>3.079404e+07</td>
<td>https://www.airbnb.com/rooms/30794039</td>
<td>2023-09-07</td>
<td>Rental unit in London · 1 bedroom · 1 bed · 1 ...</td>
<td>NaN</td>
<td>118972937.0</td>
<td>Jane</td>
<td>2017-03-03</td>
<td>Abbots Leigh, United Kingdom</td>
<td>Brown hair\nFemale \nRun my own company</td>
<td>...</td>
<td>$249.00</td>
<td>1</td>
<td>1125.0</td>
<td>0.0</td>
<td>2.0</td>
<td>2018-12-18</td>
<td>2023-07-12</td>
<td>5.00</td>
<td>NaN</td>
<td>0.03</td>
</tr>
</tbody>
</table>

<p>3 rows × 34 columns</p>
</div>
</div>
</div>
<p>See if you can work out from the documentation (Google search time!) how to get the same ‘random’ sample every time you re-run this code block:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">3</span>, ??)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="selecting-columns" class="level2">
<h2 class="anchored" data-anchor-id="selecting-columns">Selecting Columns</h2>
<p>If you look very closely, you’ll see that pandas isn’t showing you the <em>full</em> range of columns since there are 34! If you’d like to only look at specific columns then you can specify them after the sample method call using what looks like a nested list: <code>[[&lt;column names as strings&gt;]]</code>.</p>
<p>I’d like you to sample 3 random rows, selecting the ‘latitude’, ‘longitude’, ‘license’, ‘property_type’, ‘room_type’ and ‘price’ columns only.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df.sample(??)[??]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your answer should look like this:</p>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">30036</td>
<td>51.459590</td>
<td>-0.125550</td>
<td>NaN</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$85.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18694</td>
<td>51.595440</td>
<td>-0.251620</td>
<td>NaN</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>$42.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6829</td>
<td>51.530279</td>
<td>-0.197675</td>
<td>NaN</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$282.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">30036</td>
<td>51.459590</td>
<td>-0.125550</td>
<td>NaN</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$85.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18694</td>
<td>51.595440</td>
<td>-0.251620</td>
<td>NaN</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>$42.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6829</td>
<td>51.530279</td>
<td>-0.197675</td>
<td>NaN</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$282.00</td>
</tr>
</tbody>
</table>

</div>
</section>
</section>
<section id="dealing-with-nans-and-nulls" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-nans-and-nulls">Dealing with NaNs and Nulls</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Hard.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There is a <em>lot</em> going on here and you should be paying close attention.</p>
</div>
</div>
</div>
<p>If you really dig into the data you will see that a number of data types that aren’t ‘appropriate’ for their contents: the id columns are floats; the dates aren’t dates; there’s a boolean that’s not a boolean… It would be nice to fix these!</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add some columns here...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I had intended to ask you to fix these by combining code from previous weeks with information provided in the lecture, but it turns out that the InsideAirbnb data set is <em>dirty</em>. There are a lot of <code>NaN</code> values and some of these are <em>deeply</em> problematic for some of the column types in pandas. There are also a number of challenges with other columns so, instead, I’ve opted to show you how I would clean this data as a <em>first pass</em> to get it into a format where it’s tractable for further cleaning.</p>
</div>
</div>
<section id="identifying-problem-rows" class="level3">
<h3 class="anchored" data-anchor-id="identifying-problem-rows">Identifying Problem Rows</h3>
<p>The reason I’m not asking you to do this part yourselves is that it took me nearly an hour just to work out why I couldn’t convert some of the columns to the right data types; then I started finding rows like these:</p>
<div id="a2130e0f" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df[df.price.isna()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">host_location</th>
<th data-quarto-table-cell-role="th">host_about</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">availability_365</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8668</td>
<td>1.012818e+07</td>
<td>https://www.airbnb.com/rooms/10128178</td>
<td>2023-09-06</td>
<td>Loft in London · ★4.15 · 2 bedrooms · 2 beds ·...</td>
<td>This is a lived in apartment with two medium s...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11814</td>
<td>1.359431e+07</td>
<td>https://www.airbnb.com/rooms/13594306</td>
<td>2023-09-06</td>
<td>Rental unit in London · ★5.0 · 2 bedrooms · 2 ...</td>
<td>Beautiful quiet flat with high ceilings and lo...</td>
<td>18380563.0</td>
<td>Cécile And Maarten</td>
<td>2014-07-19</td>
<td>London, United Kingdom</td>
<td>Hello! We live in London with our two daughter...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21912</td>
<td>2.206322e+07</td>
<td>https://www.airbnb.com/rooms/22063217</td>
<td>2023-09-07</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Parejas</td>
<td>1824036.0</td>
<td>Arya</td>
<td>2012-02-28</td>
<td>London, United Kingdom</td>
<td>Citizen of the world.</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48138</td>
<td>5.342282e+07</td>
<td>https://www.airbnb.com/rooms/53422816</td>
<td>2023-09-06</td>
<td>Condo in London · ★4.93 · 1 bedroom · 1 bed · ...</td>
<td>We've newly refurbished our 1-bed apartment fo...</td>
<td>30626999.0</td>
<td>Sitara</td>
<td>2015-04-05</td>
<td>London, United Kingdom</td>
<td>Love travelling and meeting people!</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48765</td>
<td>5.389986e+07</td>
<td>https://www.airbnb.com/rooms/53899858</td>
<td>2023-09-06</td>
<td>Loft in Greater London · ★4.0 · 1 bedroom · 1 ...</td>
<td>Enjoy a stylish experience at this centrally-l...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68884</td>
<td>8.446589e+17</td>
<td>https://www.airbnb.com/rooms/844658929307006668</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Stylish apartment Located in sought after neig...</td>
<td>10573878.0</td>
<td>Liz</td>
<td>2013-12-11</td>
<td>London, United Kingdom</td>
<td>I love hosting and meeting worldly guests trav...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74896</td>
<td>8.971145e+17</td>
<td>https://www.airbnb.com/rooms/897114471991989638</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Tucked away right off the high street, near 50...</td>
<td>11520835.0</td>
<td>Barry</td>
<td>2014-01-21</td>
<td>Levittown, NY</td>
<td>Hey there! born and raised in New York. Airbnb...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>7 rows × 34 columns</p>
</div>
</div>
</div>
<div id="acb81435" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df[df.room_type.isna()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">host_location</th>
<th data-quarto-table-cell-role="th">host_about</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">availability_365</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8668</td>
<td>1.012818e+07</td>
<td>https://www.airbnb.com/rooms/10128178</td>
<td>2023-09-06</td>
<td>Loft in London · ★4.15 · 2 bedrooms · 2 beds ·...</td>
<td>This is a lived in apartment with two medium s...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11814</td>
<td>1.359431e+07</td>
<td>https://www.airbnb.com/rooms/13594306</td>
<td>2023-09-06</td>
<td>Rental unit in London · ★5.0 · 2 bedrooms · 2 ...</td>
<td>Beautiful quiet flat with high ceilings and lo...</td>
<td>18380563.0</td>
<td>Cécile And Maarten</td>
<td>2014-07-19</td>
<td>London, United Kingdom</td>
<td>Hello! We live in London with our two daughter...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21912</td>
<td>2.206322e+07</td>
<td>https://www.airbnb.com/rooms/22063217</td>
<td>2023-09-07</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Parejas</td>
<td>1824036.0</td>
<td>Arya</td>
<td>2012-02-28</td>
<td>London, United Kingdom</td>
<td>Citizen of the world.</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48138</td>
<td>5.342282e+07</td>
<td>https://www.airbnb.com/rooms/53422816</td>
<td>2023-09-06</td>
<td>Condo in London · ★4.93 · 1 bedroom · 1 bed · ...</td>
<td>We've newly refurbished our 1-bed apartment fo...</td>
<td>30626999.0</td>
<td>Sitara</td>
<td>2015-04-05</td>
<td>London, United Kingdom</td>
<td>Love travelling and meeting people!</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48765</td>
<td>5.389986e+07</td>
<td>https://www.airbnb.com/rooms/53899858</td>
<td>2023-09-06</td>
<td>Loft in Greater London · ★4.0 · 1 bedroom · 1 ...</td>
<td>Enjoy a stylish experience at this centrally-l...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68884</td>
<td>8.446589e+17</td>
<td>https://www.airbnb.com/rooms/844658929307006668</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Stylish apartment Located in sought after neig...</td>
<td>10573878.0</td>
<td>Liz</td>
<td>2013-12-11</td>
<td>London, United Kingdom</td>
<td>I love hosting and meeting worldly guests trav...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74896</td>
<td>8.971145e+17</td>
<td>https://www.airbnb.com/rooms/897114471991989638</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Tucked away right off the high street, near 50...</td>
<td>11520835.0</td>
<td>Barry</td>
<td>2014-01-21</td>
<td>Levittown, NY</td>
<td>Hey there! born and raised in New York. Airbnb...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>7 rows × 34 columns</p>
</div>
</div>
</div>
<div id="57e8ad51" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df[<span class="op">~</span>(df.price.<span class="bu">str</span>.startswith(<span class="st">'$'</span>, na<span class="op">=</span><span class="va">False</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">host_location</th>
<th data-quarto-table-cell-role="th">host_about</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
<th data-quarto-table-cell-role="th">maximum_nights</th>
<th data-quarto-table-cell-role="th">availability_365</th>
<th data-quarto-table-cell-role="th">number_of_reviews</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
<th data-quarto-table-cell-role="th">review_scores_rating</th>
<th data-quarto-table-cell-role="th">license</th>
<th data-quarto-table-cell-role="th">reviews_per_month</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8668</td>
<td>1.012818e+07</td>
<td>https://www.airbnb.com/rooms/10128178</td>
<td>2023-09-06</td>
<td>Loft in London · ★4.15 · 2 bedrooms · 2 beds ·...</td>
<td>This is a lived in apartment with two medium s...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8669</td>
<td>NaN</td>
<td>within an hour</td>
<td>71%</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>3.0</td>
<td>t</td>
<td>t</td>
<td>London, England, United Kingdom</td>
<td>Hackney</td>
<td>...</td>
<td>170</td>
<td>2023-09-06</td>
<td>14.0</td>
<td>NaN</td>
<td>2.0</td>
<td>0</td>
<td>0.19</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11814</td>
<td>1.359431e+07</td>
<td>https://www.airbnb.com/rooms/13594306</td>
<td>2023-09-06</td>
<td>Rental unit in London · ★5.0 · 2 bedrooms · 2 ...</td>
<td>Beautiful quiet flat with high ceilings and lo...</td>
<td>18380563.0</td>
<td>Cécile And Maarten</td>
<td>2014-07-19</td>
<td>London, United Kingdom</td>
<td>Hello! We live in London with our two daughter...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11815</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>https://a0.muscache.com/im/pictures/user/User-...</td>
<td>https://a0.muscache.com/im/pictures/user/User-...</td>
<td>1.0</td>
<td>t</td>
<td>t</td>
<td>London, United Kingdom</td>
<td>Brent</td>
<td>...</td>
<td>0</td>
<td>2023-09-06</td>
<td>6.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0</td>
<td>0.07</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21912</td>
<td>2.206322e+07</td>
<td>https://www.airbnb.com/rooms/22063217</td>
<td>2023-09-07</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Parejas</td>
<td>1824036.0</td>
<td>Arya</td>
<td>2012-02-28</td>
<td>London, United Kingdom</td>
<td>Citizen of the world.</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21913</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>https://a0.muscache.com/defaults/user_pic-50x5...</td>
<td>https://a0.muscache.com/defaults/user_pic-225x...</td>
<td>1.0</td>
<td>f</td>
<td>t</td>
<td>NaN</td>
<td>Tower Hamlets</td>
<td>...</td>
<td>0</td>
<td>2023-09-07</td>
<td>2.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0</td>
<td>0.03</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48138</td>
<td>5.342282e+07</td>
<td>https://www.airbnb.com/rooms/53422816</td>
<td>2023-09-06</td>
<td>Condo in London · ★4.93 · 1 bedroom · 1 bed · ...</td>
<td>We've newly refurbished our 1-bed apartment fo...</td>
<td>30626999.0</td>
<td>Sitara</td>
<td>2015-04-05</td>
<td>London, United Kingdom</td>
<td>Love travelling and meeting people!</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48139</td>
<td>NaN</td>
<td>NaN</td>
<td>83%</td>
<td>https://a0.muscache.com/im/pictures/user/3a51c...</td>
<td>https://a0.muscache.com/im/pictures/user/3a51c...</td>
<td>2.0</td>
<td>t</td>
<td>t</td>
<td>London, United Kingdom</td>
<td>Tower Hamlets</td>
<td>...</td>
<td>179</td>
<td>2023-09-06</td>
<td>15.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0</td>
<td>0.75</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48765</td>
<td>5.389986e+07</td>
<td>https://www.airbnb.com/rooms/53899858</td>
<td>2023-09-06</td>
<td>Loft in Greater London · ★4.0 · 1 bedroom · 1 ...</td>
<td>Enjoy a stylish experience at this centrally-l...</td>
<td>233649.0</td>
<td>Michelle</td>
<td>2010-09-13</td>
<td>London, United Kingdom</td>
<td>Michelle McLaughlin - A professional who work...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48766</td>
<td>NaN</td>
<td>within an hour</td>
<td>71%</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>3.0</td>
<td>t</td>
<td>t</td>
<td>NaN</td>
<td>Hackney</td>
<td>...</td>
<td>78</td>
<td>2023-09-06</td>
<td>5.0</td>
<td>NaN</td>
<td>2.0</td>
<td>0</td>
<td>0.28</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">68884</td>
<td>8.446589e+17</td>
<td>https://www.airbnb.com/rooms/844658929307006668</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Stylish apartment Located in sought after neig...</td>
<td>10573878.0</td>
<td>Liz</td>
<td>2013-12-11</td>
<td>London, United Kingdom</td>
<td>I love hosting and meeting worldly guests trav...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68885</td>
<td>NaN</td>
<td>a few days or more</td>
<td>6%</td>
<td>https://a0.muscache.com/im/pictures/user/7d57d...</td>
<td>https://a0.muscache.com/im/pictures/user/7d57d...</td>
<td>3.0</td>
<td>t</td>
<td>t</td>
<td>NaN</td>
<td>Kensington and Chelsea</td>
<td>...</td>
<td>359</td>
<td>2023-09-06</td>
<td>1.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0</td>
<td>0.17</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74896</td>
<td>8.971145e+17</td>
<td>https://www.airbnb.com/rooms/897114471991989638</td>
<td>2023-09-06</td>
<td>Rental unit in Greater London · 1 bedroom · 1 ...</td>
<td>Tucked away right off the high street, near 50...</td>
<td>11520835.0</td>
<td>Barry</td>
<td>2014-01-21</td>
<td>Levittown, NY</td>
<td>Hey there! born and raised in New York. Airbnb...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74897</td>
<td>NaN</td>
<td>within an hour</td>
<td>80%</td>
<td>https://a0.muscache.com/im/users/11520835/prof...</td>
<td>https://a0.muscache.com/im/users/11520835/prof...</td>
<td>3.0</td>
<td>t</td>
<td>t</td>
<td>Greater London, England, United Kingdom</td>
<td>Ealing</td>
<td>...</td>
<td>157</td>
<td>2023-09-06</td>
<td>0.0</td>
<td>NaN</td>
<td>1.0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>14 rows × 34 columns</p>
</div>
</div>
</div>
<p>If I had to guess, I’d say that it’s some kind of partial extract/write process because there <em>are</em> elements in some of the problem row(s) that look right but they are in the wrong columns. So we can <em>probably</em> drop some of these rows, but one thing to do is look at the frequency of NaNs across the data frame <em>first</em>. So we need to look for NaNs and Nulls, but it’s quite obvious that a <code>NaN</code> in the listing id is a basic problem and we should <a href="https://chrisalbon.com/python/data_wrangling/pandas_dropping_column_and_rows/">drop these</a>.</p>
<div id="8ad553f6" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df[df.<span class="bu">id</span>.isna()][[<span class="st">'id'</span>,<span class="st">'listing_url'</span>,<span class="st">'name'</span>,<span class="st">'description'</span>,<span class="st">'host_id'</span>,<span class="st">'host_name'</span>,<span class="st">'price'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">description</th>
<th data-quarto-table-cell-role="th">host_id</th>
<th data-quarto-table-cell-role="th">host_name</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8669</td>
<td>NaN</td>
<td>within an hour</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>3.0</td>
<td>t</td>
<td>170</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11815</td>
<td>NaN</td>
<td>NaN</td>
<td>https://a0.muscache.com/im/pictures/user/User-...</td>
<td>https://a0.muscache.com/im/pictures/user/User-...</td>
<td>1.0</td>
<td>t</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21913</td>
<td>NaN</td>
<td>NaN</td>
<td>https://a0.muscache.com/defaults/user_pic-50x5...</td>
<td>https://a0.muscache.com/defaults/user_pic-225x...</td>
<td>1.0</td>
<td>f</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">48139</td>
<td>NaN</td>
<td>NaN</td>
<td>https://a0.muscache.com/im/pictures/user/3a51c...</td>
<td>https://a0.muscache.com/im/pictures/user/3a51c...</td>
<td>2.0</td>
<td>t</td>
<td>179</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48766</td>
<td>NaN</td>
<td>within an hour</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>https://a0.muscache.com/im/pictures/user/652bf...</td>
<td>3.0</td>
<td>t</td>
<td>78</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68885</td>
<td>NaN</td>
<td>a few days or more</td>
<td>https://a0.muscache.com/im/pictures/user/7d57d...</td>
<td>https://a0.muscache.com/im/pictures/user/7d57d...</td>
<td>3.0</td>
<td>t</td>
<td>359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74897</td>
<td>NaN</td>
<td>within an hour</td>
<td>https://a0.muscache.com/im/users/11520835/prof...</td>
<td>https://a0.muscache.com/im/users/11520835/prof...</td>
<td>3.0</td>
<td>t</td>
<td>157</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As always, if you don’t know that’s going on, break it down:</p>
<ul>
<li>You have seen how column works (<code>[[&lt;column names&gt;]]</code>), so that’s just selecting the columns that we want to show;</li>
<li>You know how row selection works (<code>df[&lt;selection criteria&gt;]</code>), so that isn’t anything really new either;</li>
<li>So the only really new part is <code>df.id.isna()</code>: <code>df.id</code> is the <code>id</code> column (we could have written this <code>df['id']</code> if we wanted) and <code>isna()</code> is a test for whether or not a value is NaN.</li>
</ul>
<p>So this shows that only one row in the 10,000 row sub-sample has a NaN for its id.</p>
<p>If you’re not sure what the next line does, try breaking it down by running the inner bits before you run the <code>drop</code> command; and also try looking online for examples of how to use <code>df.drop</code> (e.g.&nbsp;just up above):</p>
<div id="4b9e0592" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df.drop(df[df.<span class="bu">id</span>.isna()].index.array, axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With that really troublesome data out of the way, you can now turn to <a href="https://www.delftstack.com/howto/python-pandas/how-to-count-the-nan-values-in-a-column-in-pandas-dataframe/#df.isnull.sum-method-to-count-nan-occurrences">counting NaNs or Nulls</a> in the remaining data with a view to identifying other rows that can probably be dropped.</p>
</section>
<section id="counting-nulls-by-column" class="level3">
<h3 class="anchored" data-anchor-id="counting-nulls-by-column">Counting Nulls by Column</h3>
<p>As a starting point I would look to drop the columns that contain only NaNs. Remember that we’ve dropped a row from the data frame so our maximum is now <span class="math inline">\(n-1\)</span>)! Notice how this next command works:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a data frame with all values set to True/False according to Null status</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df.isnull() </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># counts these values by column (we'll see another option in a moment)</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>df.isnull.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>) </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort results in descending order</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>df.isnull.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).sort_values(ascending<span class="op">=</span><span class="va">False</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="090f81bc" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>).sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">12</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>bathrooms               87946
license                 87945
host_about              42040
bedrooms                32781
first_review            22164
reviews_per_month       22164
last_review             22164
review_scores_rating    22164
host_location           18778
description              1267
beds                     1141
host_is_superhost         939
dtype: int64</code></pre>
</div>
</div>
<p>The most obvious ones here are: bathrooms, license, and host_about.</p>
<div id="2a2dad36" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'bathrooms'</span>,<span class="st">'license'</span>,<span class="st">'host_about'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because we have dropped everything <code>inplace</code> the code simply runs and doesn’t return anything.</p>
</section>
<section id="counting-nulls-by-row" class="level3">
<h3 class="anchored" data-anchor-id="counting-nulls-by-row">Counting Nulls by Row</h3>
<p>We now know that there <em>are</em> still quite a few problems, but we do still need a way to identify the rows that are causing most of the problems.</p>
<p>Notice here that the change from <code>axis=0</code> to <code>axis=1</code> changes the ‘direction’ of the <code>sum</code> from columns to rows. And we are getting back a data series because the summing operation reduces it to just one column.</p>
<div id="1e4dd0c5" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>).sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>48765    22
8668     22
21912    22
68884    22
48138    22
11814    22
74896    22
7003     11
6042     11
5353     11
4274     11
6694     11
2412      9
39141     8
39082     8
40686     8
27778     8
39023     8
1134      8
611       8
dtype: int64</code></pre>
</div>
</div>
<p>So that is Series showing how many NaN values there are by index value. You should see two columns of numbers: the first is the row id, the second is the number of Nulls in that row.</p>
<p>If we save the results to a variable called <code>probs</code> (i.e.&nbsp;problems) then we can decide what to do next.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>There’s a chance that Python will complain why you try to run the third line of code. This is particularly likely if you are using Anaconda Python directly (i.e.&nbsp;not Docker). In that case you need to add the code listed at the start of Task 5.</p>
</div>
</div>
<div id="6607114b" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> df.isnull().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(probs))       <span class="co"># Note that this has returned a series!</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>probs.plot.hist(bins<span class="op">=</span><span class="dv">30</span>) <span class="co"># Oooooooh, check out what we can do with a series!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.series.Series'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-30-output-2.png" width="610" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Looking at this histogram, these look like two groups in the data so I would start there. I would take values greater than 3–5 as being ones that are most likely be problematic. We can use the index from <code>probs</code> to select out the rows we want to inspect from the main data frame.</p>
<p>Here’s another bit of code that bears unpacking:</p>
<div id="ed427863" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df.drop(probs[probs <span class="op">&gt;</span> cutoff].index, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><code>probs &gt; 5</code>: this selects only those rows in the ‘probs’ series whose value is greater than 5</li>
<li><code>probs[...].index</code> returns the index values from the Series, which we will then pass to the <code>drop</code> command.</li>
<li><code>df.drop(..., inplace=True)</code> will then drop the rows selected by <code>probs[probs&gt;5].index</code>.</li>
</ol>
<div id="2a144f10" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Have reduced data frame to: </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows and </span><span class="sc">{</span>df<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">:,}</span><span class="ss"> columns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Have reduced data frame to: 85,127 rows and 31 columns</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="using-indexes" class="level1">
<h1>Using Indexes</h1>
<p>To recap, when we use the <code>[[...]]</code> syntax we’re taking a short-cut through the data by column (keeping all rows). The <em>full</em> syntax is <code>df[&lt;row_selection&gt;,&lt;col_selection&gt;]</code>. Only when we <em>don’t</em> specify both does it then default to <code>df[&lt;col_selection&gt;]</code>.</p>
<p>To make the most of pandas you will need to get to grips with the logic than underpins this syntax. This is embedded in the idea of there being row and column indexes. These are <em>like</em> the columns <code>A</code>..<code>ZZ</code> and the rows 1..n in Excel. As you’ll have seen in <a href="">the video</a>, these aren’t considered <em>data</em>, they are ways to <em>access the data</em>. Unlike Excel, while every data frame must <em>have</em> an index, in pandas you can ‘promote’ or ‘demote’ any column to be used <em>as</em> an index.</p>
<p>The default row index is just the row number — this will be created for you if you don’t specify something else when you create the data frame. The default column index is created from a file’s column names (works for many types of data) but you can change these at any time.</p>
<section id="label-and-numeric-indexing" class="level2">
<h2 class="anchored" data-anchor-id="label-and-numeric-indexing">Label and Numeric Indexing</h2>
<p>Perhaps this will (eventually) help to make it more clear:</p>
<div id="ee334625" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df.loc[</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">4552</span>, <span class="dv">4554</span>, <span class="dv">4556</span>, <span class="dv">4557</span>],</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'latitude'</span>,<span class="st">'longitude'</span>,<span class="st">'property_type'</span>,<span class="st">'room_type'</span>,<span class="st">'price'</span>]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4552</td>
<td>51.531070</td>
<td>-0.186060</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>$95.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4554</td>
<td>51.476640</td>
<td>-0.215200</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$250.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4556</td>
<td>51.400162</td>
<td>-0.076788</td>
<td>Private room in home</td>
<td>Private room</td>
<td>$56.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4557</td>
<td>51.408920</td>
<td>-0.180910</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$150.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And compare <em>that</em> with:</p>
<div id="216ddf32" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df.iloc[</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4552</span>:<span class="dv">4557</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">14</span>:<span class="dv">19</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">bathrooms_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4655</td>
<td>-0.15610</td>
<td>Private room in home</td>
<td>Private room</td>
<td>1.0</td>
<td>1 shared bath</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4656</td>
<td>-0.11470</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>1.0</td>
<td>1 bath</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4657</td>
<td>-0.06745</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>1.0</td>
<td>1 shared bath</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4658</td>
<td>-0.24050</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>4.0</td>
<td>1 bath</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4659</td>
<td>-0.18325</td>
<td>Private room in home</td>
<td>Private room</td>
<td>2.0</td>
<td>1 bath</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This code <em>seems</em> similar, but what are <code>iloc</code> and <code>loc</code>? The way I remember it is that <code>iloc</code> means <em>integer</em> location (as you would with <em>list indexing</em>), while <code>loc</code> means <em>label</em> location (as you would with <em>dictionary keys</em> or labels). I guess that should therefore be <code>lloc</code>, but you get the idea).</p>
</section>
<section id="numeric-indexes" class="level2">
<h2 class="anchored" data-anchor-id="numeric-indexes">Numeric Indexes</h2>
<p>In this case, the <strong>index</strong> (the numbers down the left-hand side in bold) is numeric, so we can treat it as a <em>label</em> (which allows us to use <code>df.loc</code>) <em>or</em> a list-type index (which allows us to use <code>df.iloc</code>). So with <code>loc</code> we refer to the columns by <em>label</em>, whereas with <code>iloc</code> we refer to them by <em>location</em>; as well, <code>loc</code> allows us to access rows and columns non-sequentially/randomly by label, while <code>iloc</code> allows us to access them as a numeric range.</p>
</section>
<section id="non-numeric-indexes" class="level2">
<h2 class="anchored" data-anchor-id="non-numeric-indexes">Non-numeric Indexes</h2>
<p>Notice how this works differently if we specify a <strong>non-numeric index</strong>:</p>
<div id="21ad6c2e" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'listing_url'</span>)[</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'latitude'</span>,<span class="st">'longitude'</span>,<span class="st">'property_type'</span>,<span class="st">'room_type'</span>,<span class="st">'price'</span>]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>].sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/49205557</td>
<td>51.511670</td>
<td>-0.120240</td>
<td>Entire condo</td>
<td>Entire home/apt</td>
<td>$337.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/884709941812627302</td>
<td>51.595673</td>
<td>-0.245288</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>$54.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/36399168</td>
<td>51.544380</td>
<td>-0.142460</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>$96.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Notice change in indexing because ‘listing_url’ is no longer a column, it’s the index now!</p>
<div id="bd4233d0" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'listing_url'</span>).iloc[<span class="dv">0</span>:<span class="dv">3</span>,<span class="dv">13</span>:<span class="dv">18</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">accommodates</th>
<th data-quarto-table-cell-role="th">bathrooms_text</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/92644</td>
<td>-0.18739</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>2.0</td>
<td>1.5 shared baths</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/93015</td>
<td>-0.21707</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
<td>5.0</td>
<td>1 bath</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">https://www.airbnb.com/rooms/13913</td>
<td>-0.11270</td>
<td>Private room in rental unit</td>
<td>Private room</td>
<td>1.0</td>
<td>1 shared bath</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s vital that you understand how this code <em>works</em>. By which I mean <em>why</em> it does something at all, not exactly how to use <code>loc</code> and <code>iloc</code> (though that is also useful).</p>
<p><code>df.set_index(...)</code> changes the index from the default row number to another field in the data frame. This operation <em>returns</em> a new data frame with <code>listing_url</code> as its index. Because set index returned a data frame, we can simply add <em>another</em> method call (<code>iloc</code> or <code>loc</code>) on to the end of that line and <em>it</em> returns a new data frame in turn!</p>
<p>The fact that each operation returns a new data frame (or data series) is why you can even do this:</p>
<div id="fe738969" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>    df.set_index(<span class="st">'listing_url'</span>).iloc[<span class="dv">0</span>:<span class="dv">3</span>].latitude.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>np.float64(51.50351666666666)</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="fixing-data-types" class="level1">
<h1>Fixing Data Types</h1>
<p>If you want to challenge yourself, then I’d suggest trying to work out how to adapt what we saw in previous weeks using the data type dictionary to map column names to column types; however, a more straightforward way to do this is to create different for loops for each:</p>
<section id="profiling-optional" class="level2">
<h2 class="anchored" data-anchor-id="profiling-optional">Profiling (Optional)</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>The Pandas Profiling tool (rebranded a year or so back as <a href="https://github.com/ydataai/ydata-profiling">ydata-profiling</a>) offers an alternative way of understanding what’s going on in your data. The output <a href="https://docs.profiling.ydata.ai/">looks rather nice</a> and you might be tempted to ask why we didn’t use this straight away on the full data set – well, if you really want to know, see what happens when you profile all 70,000-odd rows and 70-odd columns in the raw data frame… in effect: while it’s ‘nice to have’, the likelihood of crashing your computer increases significantly and it’s a bit of a tangent, so that’s why it’s no longer included in the Docker image.</p>
<p>If you <em>do</em> want to explore this then you’ll need to install the library, and <strong>this is a good chance to look at a quite sophisiticated way to install software on another machine</strong>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ydata_profiling <span class="im">import</span> ProfileReport</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="specify-the-profiling-columns" class="level3">
<h3 class="anchored" data-anchor-id="specify-the-profiling-columns">Specify the Profiling Columns</h3>
<p>Looking back over earlier code see if you can work out how to profile <code>latitude</code>, <code>longitude</code>,and <code>review_scores_rating</code> together.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>profile <span class="op">=</span> ProfileReport(??, title<span class="op">=</span><span class="st">"Pandas Profiling Report"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="profiling-targets" class="level3">
<h3 class="anchored" data-anchor-id="profiling-targets">Profiling Targets</h3>
<p>You can write the profile either directly into the Jupyter notebook (this file) or into a separate HTML (i.e.&nbsp;Web) page.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>profile.to_notebook_iframe()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You can also write this profile to a web page:</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># profile.to_file("your_report.html")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="managing-memory" class="level2">
<h2 class="anchored" data-anchor-id="managing-memory">Managing Memory</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>As to <em>why</em> you’d want to fix your data types, there are two reasons: 1) to ensure that you can make the <em>most</em> of your data; 2) to ensure that it takes up as little space as possible in memory. Some simple examples:</p>
<ul>
<li>A column containing only <code>'True'</code> (4 bytes) and <code>'False'</code> (5 bytes) will take up much more space than a column containing only <code>True</code> and <code>False</code> (1 bit each).</li>
<li>A column containing only <code>'Red'</code>, <code>'Green'</code>, and <code>'Blue'</code> (3, 5, and 4 bytes each respectively) will take up much more space that a column where we use the numbers <code>1, 2, 3</code> to represent these values and have a map that tells us <code>1==Red</code>, <code>2==Blue</code>, and <code>3==Green</code>.</li>
</ul>
<p>Let’s test this idea out:</p>
<div id="3d9a2bd5" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rtm <span class="op">=</span> df.room_type.memory_usage(deep<span class="op">=</span><span class="va">True</span>) <span class="co"># Room Type Memory</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ctm <span class="op">=</span> df.room_type.astype(<span class="st">'category'</span>).memory_usage(deep<span class="op">=</span><span class="va">True</span>) <span class="co"># Categorical Type Memory</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The raw memory usage of `room_type` is </span><span class="sc">{</span>rtm<span class="op">/</span><span class="dv">1024</span><span class="sc">:,.0f}</span><span class="ss"> Kb."</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The categorical memory usage of `room_type` is </span><span class="sc">{</span>ctm<span class="op">/</span><span class="dv">1024</span><span class="sc">:,.0f}</span><span class="ss"> Kb."</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"That's </span><span class="sc">{</span>(ctm<span class="op">/</span>rtm)<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">% of the original!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The raw memory usage of `room_type` is 8,623 Kb.
The categorical memory usage of `room_type` is 2,813 Kb.
That's 33% of the original!</code></pre>
</div>
</div>
<div id="5ea6bb01" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>shm <span class="op">=</span> df.host_is_superhost.memory_usage(deep<span class="op">=</span><span class="va">True</span>) <span class="co"># Super Host Memory</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>bhm <span class="op">=</span> df.host_is_superhost.replace({<span class="st">'f'</span>:<span class="va">False</span>, <span class="st">'t'</span>:<span class="va">True</span>}).astype(<span class="st">'bool'</span>).memory_usage(deep<span class="op">=</span><span class="va">True</span>) <span class="co"># Boolean Host Memory</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The raw memory usage of `host_is_superhost` is </span><span class="sc">{</span>shm<span class="op">/</span><span class="dv">1024</span><span class="sc">:,.0f}</span><span class="ss"> Kb."</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The boolean memory usage of `host_is_superhost` is </span><span class="sc">{</span>bhm<span class="op">/</span><span class="dv">1024</span><span class="sc">:,.0f}</span><span class="ss"> Kb."</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"That's </span><span class="sc">{</span>(bhm<span class="op">/</span>shm)<span class="op">*</span><span class="dv">100</span><span class="sc">:.0f}</span><span class="ss">% of the original!"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The raw memory usage of `host_is_superhost` is 7,528 Kb.
The boolean memory usage of `host_is_superhost` is 2,812 Kb.
That's 37% of the original!</code></pre>
</div>
</div>
</section>
<section id="boolean-values" class="level2">
<h2 class="anchored" data-anchor-id="boolean-values">Boolean Values</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Moderate.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Let’s start with columns that are likely to be boolean:</p>
<div id="90fb20f1" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>bools <span class="op">=</span> [<span class="st">'host_is_superhost'</span>]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">43</span>)[bools]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">host_is_superhost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">55197</td>
<td>f</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24505</td>
<td>f</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44546</td>
<td>f</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16312</td>
<td>t</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66564</td>
<td>f</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we have to <code>map</code> ‘t’ to True and ‘f’ to False <em>before</em> converting the column to a boolean type. If you simply tried to replace them with the strings ‘True’ and ‘False’, then the conversion would run into the same problem as Week 3: any string that is not <code>None</code> will convert a True boolean.</p>
<div id="c0718a98" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This approach requires us to map 't' </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and 'f' to True and False</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> b <span class="kw">in</span> bools:</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Converting </span><span class="sc">{</span>b<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    df[b] <span class="op">=</span> df[b].replace({<span class="st">'f'</span>:<span class="va">False</span>, <span class="st">'t'</span>:<span class="va">True</span>}).astype(<span class="st">'bool'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting host_is_superhost</code></pre>
</div>
</div>
<div id="84089e3b" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">43</span>)[bools]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">host_is_superhost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">55197</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24505</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44546</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16312</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66564</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dates" class="level2">
<h2 class="anchored" data-anchor-id="dates">Dates</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Hard.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>I’ve found dates to be particularly challenging, though pandas has <em>tried</em> to make this process less painful than it was a few years ago. What can be particularly frustrating is if <em>one</em> row has a non-sensical date value (e.g.&nbsp;a <code>t</code>, as happened in 2019/20) then the entire type conversion will fail. When that happens, pandas is not great about communicating where the problem occurred and I had to work it out by trying to convert <em>parts</em> of each series (using <code>.iloc</code>) to the datetime type until I had a block that failed. I then knew that I could narrow this down further using integer location indexing.</p>
<div id="b8b2a016" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> [<span class="st">'last_scraped'</span>,<span class="st">'host_since'</span>,<span class="st">'first_review'</span>,<span class="st">'last_review'</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Currently </span><span class="sc">{</span>dates[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> is of type '</span><span class="sc">{</span>df[dates[<span class="dv">1</span>]]<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">'"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">43</span>)[dates]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Currently host_since is of type 'object' 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">55197</td>
<td>2023-09-07</td>
<td>2015-02-11</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24505</td>
<td>2023-09-06</td>
<td>2012-12-18</td>
<td>2019-01-05</td>
<td>2020-01-05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44546</td>
<td>2023-09-06</td>
<td>2016-05-26</td>
<td>2021-08-15</td>
<td>2023-01-10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16312</td>
<td>2023-09-07</td>
<td>2017-04-02</td>
<td>2017-04-04</td>
<td>2023-08-26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66564</td>
<td>2023-09-06</td>
<td>2017-05-07</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="bbd4a187" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> dates:</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Converting "</span> <span class="op">+</span> d)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    df[d] <span class="op">=</span> pd.to_datetime(df[d])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting last_scraped
Converting host_since
Converting first_review
Converting last_review</code></pre>
</div>
</div>
<div id="cb20b19e" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">43</span>)[dates]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">last_scraped</th>
<th data-quarto-table-cell-role="th">host_since</th>
<th data-quarto-table-cell-role="th">first_review</th>
<th data-quarto-table-cell-role="th">last_review</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">55197</td>
<td>2023-09-07</td>
<td>2015-02-11</td>
<td>NaT</td>
<td>NaT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24505</td>
<td>2023-09-06</td>
<td>2012-12-18</td>
<td>2019-01-05</td>
<td>2020-01-05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44546</td>
<td>2023-09-06</td>
<td>2016-05-26</td>
<td>2021-08-15</td>
<td>2023-01-10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16312</td>
<td>2023-09-07</td>
<td>2017-04-02</td>
<td>2017-04-04</td>
<td>2023-08-26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66564</td>
<td>2023-09-06</td>
<td>2017-05-07</td>
<td>NaT</td>
<td>NaT</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Of course, it’s not actually clear there what has changed! But if you dig a little more deeply:</p>
<div id="ef9ce639" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Now </span><span class="sc">{</span>dates[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> is of type '</span><span class="sc">{</span>df[dates[<span class="dv">1</span>]]<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">'"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">45</span>)[dates[<span class="dv">1</span>]].dt.strftime(<span class="st">'%A %B </span><span class="sc">%d</span><span class="st">, %Y'</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Try some other formats!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Now host_since is of type 'datetime64[ns]' 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="126">
<pre><code>45006    Sunday December 15, 2013
11882       Monday April 13, 2015
74675     Wednesday July 16, 2014
80039         Friday May 06, 2022
84399       Friday April 22, 2022
Name: host_since, dtype: object</code></pre>
</div>
</div>
<p>In that line of code we:</p>
<ul>
<li>Took a random sample (setting the state to 45),</li>
<li>Took the second column from the dates list (<code>dates[1]</code>),</li>
<li>Used the <em>date</em> ‘accessor method’ (<code>.dt</code>),</li>
<li>And called <code>string format time</code> with the format <code>%A %B %d, %Y</code> (Full Day of Week, Month Name, Date, 4-digit Year)</li>
</ul>
</section>
<section id="categories" class="level2">
<h2 class="anchored" data-anchor-id="categories">Categories</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Moderate.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>We know that these are likely to be categories because there’d be no other way to allow users to effectively search Airbnb.</p>
<div id="083d04f2" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>cats <span class="op">=</span> [<span class="st">'property_type'</span>,<span class="st">'room_type'</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Currently </span><span class="sc">{</span>cats[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> is of type '</span><span class="sc">{</span>df[cats[<span class="dv">1</span>]]<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">'"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[cats]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Currently room_type is of type 'object' 
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">18050</td>
<td>Private room in home</td>
<td>Private room</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86868</td>
<td>Private room in home</td>
<td>Private room</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54798</td>
<td>Private room in bed and breakfast</td>
<td>Private room</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74233</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">87242</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This next piece of code is quite useful for grouping and counting operations: we are counting the occurences of each unique value in part particular column or combination of columns:</p>
<div class="longform">
<div id="72f0c794" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df[cats[<span class="dv">0</span>]].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>property_type
Entire rental unit                   33450
Private room in rental unit          13278
Private room in home                  9795
Entire condo                          8656
Entire home                           7530
                                     ...  
Yurt                                     1
Private room in island                   1
Shared room in villa                     1
Shared room in serviced apartment        1
Treehouse                                1
Name: count, Length: 99, dtype: int64</code></pre>
</div>
</div>
</div>
<div class="longform">
<div id="4e8ea63f" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df[cats[<span class="dv">1</span>]].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>room_type
Entire home/apt    54203
Private room       30366
Shared room          340
Hotel room           218
Name: count, dtype: int64</code></pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>One column has <em>many</em> different values (including Campers/RVs and Yurts!), the other has just four. If I were looking to conduct research I’d probably <em>start</em> with the <code>room_type</code> column since I may not care about hotels and therefore never even need to decide whether I care about boutique ones!</p>
</div>
</div>
<div id="8625ef20" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> cats:</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Converting </span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    df[c] <span class="op">=</span> df[c].astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting property_type
Converting room_type</code></pre>
</div>
</div>
<div id="15478ffa" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Now </span><span class="sc">{</span>cats[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> is of type '</span><span class="sc">{</span>df[cats[<span class="dv">1</span>]]<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">'"</span>, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df[cats[<span class="dv">1</span>]].cat.categories.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Now room_type is of type 'category' 

['Entire home/apt' 'Hotel room' 'Private room' 'Shared room']</code></pre>
</div>
</div>
<div id="e600c398" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[cats]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">property_type</th>
<th data-quarto-table-cell-role="th">room_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">18050</td>
<td>Private room in home</td>
<td>Private room</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86868</td>
<td>Private room in home</td>
<td>Private room</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54798</td>
<td>Private room in bed and breakfast</td>
<td>Private room</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74233</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">87242</td>
<td>Entire rental unit</td>
<td>Entire home/apt</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dealing-with-strings" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-strings">Dealing with Strings</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Hard.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>We’ll have to put some more work into deal with the description and other more free-from text fields later in the term, but for now let’s just deal with a straightforward one: price!</p>
<div id="4077ee90" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>money <span class="op">=</span> [<span class="st">'price'</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[money]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">18050</td>
<td>$51.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86868</td>
<td>$56.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54798</td>
<td>$45.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74233</td>
<td>$104.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">87242</td>
<td>$126.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>You will get an error when you run the next code block</strong>, that’s because I want you to do a little thinking about how to extend the code to fix the data. You’ve already got the code you need to fix it, you just need to do a bit of thinking about ‘method chaining’!</p>
<div id="d5acc2bf" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> money:</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Converting </span><span class="sc">{</span>m<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        df[m] <span class="op">=</span> df[m].<span class="bu">str</span>.replace(<span class="st">'$'</span>,<span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>).astype(<span class="st">'float'</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"    xxxx Unable to convert </span><span class="sc">{</span>m<span class="sc">}</span><span class="ss"> to float xxxx"</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting price
    xxxx Unable to convert price to float xxxx
could not convert string to float: '1,000.00'</code></pre>
</div>
</div>
<p>Look closely at the error and then think about what you need to add to the code below:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For now don’t worry about what <code>regex=False</code> means. It will all make sense when we get to <em>dealing with text</em>.</p>
</div>
</div>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> money:</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Converting </span><span class="sc">{</span>m<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    df[m] <span class="op">=</span> df[m].<span class="bu">str</span>.replace(<span class="st">'$'</span>,<span class="st">''</span>, regex<span class="op">=</span><span class="va">False</span>).<span class="bu">str</span>.replace(??).astype(<span class="st">'float'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="63f015ac" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">42</span>)[money]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">18050</td>
<td>51.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86868</td>
<td>56.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">54798</td>
<td>45.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74233</td>
<td>104.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">87242</td>
<td>126.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="45cab1a6" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'price'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">3</span>)[[<span class="st">'id'</span>,<span class="st">'name'</span>,<span class="st">'price'</span>,<span class="st">'minimum_nights'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="137">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">minimum_nights</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">36168</td>
<td>3.845268e+07</td>
<td>Guesthouse in Dagenham · ★5.0 · 1 bedroom · 1 ...</td>
<td>80100.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11249</td>
<td>1.325477e+07</td>
<td>Rental unit in London · ★4.85 · 1 bedroom · 1 ...</td>
<td>53588.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53708</td>
<td>6.454631e+17</td>
<td>Serviced apartment in Greater London · 4 bedro...</td>
<td>36000.0</td>
<td>28</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="dealing-with-integers" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-integers">Dealing with Integers</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Hard.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>This is the issue that made me abandon the idea of making you clean the data yourselves. Although <em>floats</em> have no issues with <code>np.nan</code> in the Series, by default there are no numpy integer arrays that can cope with NaNs. This was such a major issue for Pandas that they’ve actually created their <em>own</em> data type that does support NaN values in integer columns. There are a lot of integer columns, but only one of them seems to be a problem.</p>
<div id="cba3a9f9" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>ints  <span class="op">=</span> [<span class="st">'id'</span>,<span class="st">'host_id'</span>,<span class="st">'host_listings_count'</span>,<span class="st">'host_total_listings_count'</span>,<span class="st">'accommodates'</span>,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">'beds'</span>,<span class="st">'minimum_nights'</span>,<span class="st">'maximum_nights'</span>,<span class="st">'availability_365'</span>]</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> ints:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Converting </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>        df[i] <span class="op">=</span> df[i].astype(<span class="st">'float'</span>).astype(<span class="st">'int'</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  - !!!Converting to unsigned 16-bit integer!!!"</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        df[i] <span class="op">=</span> df[i].astype(<span class="st">'float'</span>).astype(pd.UInt16Dtype())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converting id
Converting host_id
Converting host_listings_count
Converting host_total_listings_count
Converting accommodates
Converting beds
  - !!!Converting to unsigned 16-bit integer!!!
Converting minimum_nights
Converting maximum_nights
Converting availability_365</code></pre>
</div>
</div>
<p>So we convert the column but using a <code>try / except</code> approach that allows to trap <code>ValueError</code> exceptions triggered by the presence of NaNs in the column. The following code tells us that there are just eight of these in the 10k sample, but they’re enough to cause the code to fail if you don’t trap them. The alternatives would be to: a) drop those rows; or b) leave the data as floats. For some reason the latter offends my sense of order, and the former feels like avoiding the problem rather than dealing with it.</p>
<div id="1edf2a81" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df.beds.isna().value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="139">
<pre><code>beds
False    84326
True       801
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="validation" class="level2">
<h2 class="anchored" data-anchor-id="validation">Validation</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Ordinarily, at this point I would then output information to confirm that all of the opeations I <em>think</em> I’ve undertaken were correctly applied.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="saving" class="level2">
<h2 class="anchored" data-anchor-id="saving">Saving</h2>
<p>Also at this point I would save a copy of the cleaned data, though I would only consider this data <em>partially</em> cleaned since we’ve not made it any further than just ensuring that each column is in an appropriate format and that some particularly problematic rows have been dropped!</p>
<div id="c49a605f" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(<span class="st">'data'</span>,<span class="st">'clean'</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(path):</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Creating </span><span class="sc">{</span>path<span class="sc">}</span><span class="ss"> under </span><span class="sc">{</span>os<span class="sc">.</span>getcwd()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    os.makedirs(path)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>df.to_csv(os.path.join(path,fn), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Done."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Done.</code></pre>
</div>
</div>
<p>Feather is an alternative format (gradually being replaced by parquet, which is more widely supported) for data interchange between R and Python: it’s fast, it preserves data types, it’s compressed, and it will avoid the kinds of the problems that come up when you move to/from CSV as a default.</p>
</section>
</section>
<section id="selection-using-criteria" class="level1">
<h1>Selection using Criteria</h1>
<p>So far we’ve been taking primarily a row and column view of the data, now we want to think about selecting ranges from within the data set…</p>
<section id="selecting-using-data-types" class="level2">
<h2 class="anchored" data-anchor-id="selecting-using-data-types">Selecting using Data Types</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>If we wanted to filter in/out certain columns pandas can do that! Let’s try for floats and ints (<em>hint</em>: these are 64-bit data types).</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df.select_dtypes(include<span class="op">=</span>[??])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="selecting-using-conditions" class="level2">
<h2 class="anchored" data-anchor-id="selecting-using-conditions">Selecting using Conditions</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Hard.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>What if we wanted to find whole homes listings for more than $100/night?</p>
<p>To do this we use a combination of the selection approaches above in combination with conditionals, but first we need to see what sort of properties there are in the data set! <code>groupby</code> is a really useful function that we’ll come back to later in the term, but for now notice that it helps us to group the analysis by <code>room_type</code> so that subsequently asking for the <code>property_type</code> value counts allows the same <code>property_type</code> to appear in more than once place if it’s associated with more than one <code>room_type</code>.</p>
<div id="07071cac" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'room_type'</span>, observed<span class="op">=</span><span class="va">True</span>)[<span class="st">'property_type'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="142">
<pre><code>room_type        property_type            
Entire home/apt  Entire rental unit           33450
                 Entire condo                  8656
                 Entire home                   7530
                 Entire serviced apartment     2021
                 Entire townhouse              1153
                                              ...  
Shared room      Tent                             0
                 Tiny home                        0
                 Tower                            0
                 Treehouse                        0
                 Yurt                             0
Name: count, Length: 396, dtype: int64</code></pre>
</div>
</div>
<p>Now try to select only the <code>Entire home/apt</code> room type:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>df[df.??<span class="op">==</span><span class="st">'??'</span>][<span class="st">'property_type'</span>].value_counts().head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Your output should be:</p>
<div class="cell">
<pre><code>property_type
Entire rental unit           33450
Entire condo                  8656
Entire home                   7530
Entire serviced apartment     2021
Entire townhouse              1153
Entire loft                    389
Entire guesthouse              205
Entire guest suite             178
Entire vacation home           102
Boat                            68
Name: count, dtype: int64</code></pre>
</div>
</section>
</section>
<section id="arbitrary-selection-criteria" class="level2">
<h2 class="anchored" data-anchor-id="arbitrary-selection-criteria">Arbitrary Selection Criteria</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Moderate, if the previous section made sense to you.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>OK, now let’s look for the Entire home/apt listings that are more expected than average… to do <em>that</em> let’s get a sense of where the mean and median value fall:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The mean price is $</span><span class="sc">{</span>df<span class="sc">.</span>price<span class="sc">.??</span>()<span class="sc">:0.2f}</span><span class="ss">"</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The median price is $</span><span class="sc">{</span>df<span class="sc">.</span>price<span class="sc">.??</span>()<span class="sc">:0.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see that the mean is higher than the median price but both are <em>very</em> roughly plausible values. Given your understanding of distributions from, say, Quantitative Methods, what can you say about the pricing distribution of Airbnb units?</p>
<p>You might want to have a <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#series">look at the documentation</a>: it’s rather a long list, but most of your descriptive stats are on that page in the <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#computations-descriptive-stats">Cumulative / Descriptive Stats</a> section, and there’s also lots of information about methods for <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#string-handling">strings</a> and <a href="http://pandas.pydata.org/pandas-docs/stable/api.html#categorical">categorical data</a>.</p>
</section>
<section id="filtering-its-logical" class="level3">
<h3 class="anchored" data-anchor-id="filtering-its-logical">Filtering: it’s ‘logical’</h3>
<p>So we want to take <code>Entire home/apt</code> and filter the data set <em>together with</em> the price per night from the <code>price</code> column. For that, let’s use the mean price/night of $183.63 (<em>note</em>: this is totally arbitrary)?</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>So here we want to filter on two values in the data set using <code>&amp;</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>pricey <span class="op">=</span> df[(??) <span class="op">&amp;</span> (df.price<span class="op">&gt;</span>df.price.??)]</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Selected </span><span class="sc">{</span>pricey<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code above we see two things:</p>
<ol type="1">
<li>The use of the bitwise <code>&amp;</code> (it’s <em>not</em> the same as <code>and</code>).</li>
<li>The fact that you need parentheses around the selection in order to make the the <code>&amp;</code> work.</li>
</ol>
</section>
</section>
</section>
<section id="selection-with-an-aggregate" class="level2">
<h2 class="anchored" data-anchor-id="selection-with-an-aggregate">Selection with an Aggregate</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Let’s find the cheapest and most expensive listings using <code>min</code> and <code>max</code> methods:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>Least expensive:</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df[df.price<span class="op">==</span>df.price.??()][[<span class="st">'price'</span>,<span class="st">'id'</span>,<span class="st">'listing_url'</span>,<span class="st">'room_type'</span>,<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Most expensive:</p>
<div class="cell">
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df[df.price<span class="op">==</span>df.price.??()][[<span class="st">'price'</span>,<span class="st">'id'</span>,<span class="st">'listing_url'</span>,<span class="st">'room_type'</span>,<span class="st">'description'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see one or more units priced at exceedingly high levels… and here’s a way to see a few more of these budget-busting options.</p>
<div id="ae41d287" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>df.sort_values(by<span class="op">=</span><span class="st">'price'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">3</span>)[</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'price'</span>,<span class="st">'listing_url'</span>,<span class="st">'room_type'</span>,<span class="st">'description'</span>]</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="149">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">listing_url</th>
<th data-quarto-table-cell-role="th">room_type</th>
<th data-quarto-table-cell-role="th">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">36168</td>
<td>80100.0</td>
<td>https://www.airbnb.com/rooms/38452677</td>
<td>Entire home/apt</td>
<td>Bouquet design open plan house. &lt;br /&gt;Beautifu...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11249</td>
<td>53588.0</td>
<td>https://www.airbnb.com/rooms/13254774</td>
<td>Private room</td>
<td>PLEASE NOTE THIS IS NO LONGER AVAILABLE! Cosy ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53708</td>
<td>36000.0</td>
<td>https://www.airbnb.com/rooms/645463113262447532</td>
<td>Entire home/apt</td>
<td>Enjoy your stay in London in a modern, archite...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop: Ask yourself if the result is <em>plausible</em>.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>What do you make of this result?</p>
</section>
</section>
<section id="selection-with-a-range" class="level2">
<h2 class="anchored" data-anchor-id="selection-with-a-range">Selection with a Range</h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Moderate
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Perhaps we aren’t just looking for extremes… how about all of the properties falling within the middle of the distribution? We can ask for any abitrary quantile we like, so let’s go with the 25th and 75th percentile to get the middle 50% of the data. Google how to get percentiles from pandas.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>dfr <span class="op">=</span> df[ </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>            (df.price <span class="op">&gt;</span> df.price.quantile(??)) <span class="op">&amp;</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>            (df.price <span class="op">&lt;</span> df.price.quantile(??)) ]</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lower Quartile: </span><span class="sc">{</span>df<span class="sc">.</span>price<span class="sc">.</span>quantile(??)<span class="sc">:&gt;6.2f}</span><span class="ss">"</span>)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Upper Quartile: </span><span class="sc">{</span>df<span class="sc">.</span>price<span class="sc">.</span>quantile(??)<span class="sc">:&gt;6.2f}</span><span class="ss">"</span>)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Range selected contains </span><span class="sc">{</span>dfr<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> rows."</span>)</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Minimum price: </span><span class="sc">{</span>dfr<span class="sc">.</span>price<span class="sc">.??</span>()<span class="sc">:&gt;6.2f}</span><span class="ss">"</span>)</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum price: </span><span class="sc">{</span>dfr<span class="sc">.</span>price<span class="sc">.??</span>()<span class="sc">:&gt;6.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That example contains a few things to which you need to pay attention:</p>
<ol type="1">
<li><em>Again</em> you can see that, with mutiple selections, we had to put parentheses around each one – this forces Python to…</li>
<li>Process the <code>&amp;</code> (bit-wise AND) that asks pandas to “Find all the rows where condition 1 <em>and</em> condition 2 are both <code>True</code>”. So it calculates the <code>True</code>/<code>False</code> for the left side and the <code>True</code>/<code>False</code> for the right side of the <code>&amp;</code>, and then combines them.</li>
</ol>
</section>
</section>
</section>
<section id="enhancing-our-understanding" class="level1">
<h1>Enhancing our Understanding</h1>
<section id="deriving-a-new-variable" class="level2">
<h2 class="anchored" data-anchor-id="deriving-a-new-variable">Deriving a New Variable</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-31-contents" aria-controls="callout-31" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: 🤯
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-31" class="callout-31-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Let’s try calculating several derived measures of distribution for the price… these deliberately demonstrate different ways of handling this process (and notice also the little call to <code>apply</code> that can perform additional tasks).</p>
<section id="the-z-score" class="level3">
<h3 class="anchored" data-anchor-id="the-z-score">The <em>z</em>-Score</h3>
<p>The z-score is given by <span class="math inline">\(z = (x - \bar{x})/\sigma\)</span>.</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'z'</span>] <span class="op">=</span> (df.?? <span class="op">-</span> df.??.??()) <span class="op">/</span> df.??.??()</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>df.z.describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:5.5f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="inter-quartile-standardisation" class="level3">
<h3 class="anchored" data-anchor-id="inter-quartile-standardisation">Inter-Quartile Standardisation</h3>
<p>The IQR-standardised score is given by <span class="math inline">\(i = (x - Q_{1})/(Q_{3} - Q_{1})\)</span></p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'iqs'</span>] <span class="op">=</span> (df.price <span class="op">-</span> ??)<span class="op">/</span>(??<span class="op">-</span>??)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>df.iqs.describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:5.5f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="log-normalisation" class="level3">
<h3 class="anchored" data-anchor-id="log-normalisation">Log-Normalisation</h3>
<p>The natural log of the price is gven by <span class="math inline">\(ln(x)\)</span></p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'lnprice'</span>] <span class="op">=</span> np.log(??)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>df.lnprice.describe().<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:5.5f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="quick-and-dirty-plotting" class="level2">
<h2 class="anchored" data-anchor-id="quick-and-dirty-plotting">Quick (and Dirty) Plotting</h2>
<p>One of the first things we should do when exploring a new dataset is plot (aka graph) the data. We’ve left plotting until a little later in this practical so that we could see some other basic attributes of how pandas stores data. We’ll look at plotting and exploratory data analyses in much more detail next week, including using packages other than pandas.</p>
<p>For now, let’s look at the basic plotting functionality pandas provides - in conjunctions with the online documentation for both <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">DataFrames</a> and <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">Series</a>. There are also examples of all <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/visualization.html">the different types of plots pandas can produce</a>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
MacOS plotting <em>without</em> Docker
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>MacOS users who are <em>not</em> using Docker will need to do certain things in a specific order at the start of any notebook in order to show maps or graphs. Please make a copy of the following code for any notebook that you create and make it the <em>first</em> code that you run in the notebook…</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Needed on a Mac</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>mpl.use(<span class="st">'TkAgg'</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="histograms" class="level3">
<h3 class="anchored" data-anchor-id="histograms">Histograms</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>First, let’s see some of the ways we could visualise the distribution of the <code>Series</code> in the dataset:</p>
<div id="528c1544" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df.price.plot.hist() <span class="co"># histogram</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-74-output-1.png" width="610" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>If the code worked properly you should have just created a standard <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.hist.html">histogram</a> plot (if you can’t see one, ask for help). However, a basic problem here may be the range of the data: if your maximum price is much more than £5,000 then you’ll find the majority of your data plotted in one bar, which isn’t very helpful.</p>
<p>You can filter the data <em>and</em> pass in some simple options to improve the plotting:</p>
<div id="dc999e42" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the ';' here to suppress `&lt;AxesSubplot...&gt;`</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># That information doesn't *always* appear, but whenever</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># you have unwanted textual output above your plot just</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add a ';' on the end of the line of code!</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>df[df.price <span class="op">&lt;</span> <span class="dv">1000</span>].price.plot.hist(bins<span class="op">=</span><span class="dv">50</span>)<span class="op">;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-75-output-1.png" width="610" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kde-plots" class="level3">
<h3 class="anchored" data-anchor-id="kde-plots">KDE Plots</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>Similarly, we can produce a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.kde.html">Kernel Density Estimate plot</a>. This time, instead of dropping data just before calling <code>plot</code> we’re going to modify the <em>limits</em> of the x-axis using <code>xlim</code>:</p>
<section class="level4 qna-question">
<h4 class="qna-question anchored" data-anchor-id="">Question</h4>
<p>Look for information about using <code>xlim</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>df.price.plot.kde(xlim<span class="op">=</span>(??))<span class="op">;</span> <span class="co">#kernel density estimate plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Kind of handy, no? These aren’t the <em>best</em> looking plots, but they are all being generated on-the-fly for you by pandas with no more than a cheery <code>DataFrame.Series.plot.&lt;plot type&gt;</code>! Since those plots are all just method calls, many of them take optional parameters to change the colour, the notation (scientific or not), and other options. For example, many of the documentation pages linked to above are rather brief, but include a link to <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.html">the general options that can be applied to all <code>Series.plot</code></a> calls.</p>
<p>This is why we like pandas: it allows us to be <em>constructively lazy</em>. We don’t need to know <em>how</em> a draw a KDE plot (though it always helps if you don’t see what you expected), we just need to know that pandas provides a method that will do it for you. And <em>that</em> is why it’s always worth having a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">look at the documentation</a>.</p>
</section>
</section>
<section id="a-slight-case-of-over-plotting" class="level3">
<h3 class="anchored" data-anchor-id="a-slight-case-of-over-plotting">A Slight Case of Over-Plotting</h3>
<p>Generally, Jupyter is clever enough to overlay plots one on top of the other if you call them all in the same cell. We’ll see ways to gain more control later, but this is still a good start! Note that here we also need to get rid of the <code>-inf</code> values from rows that had a price of £0.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bug Alert <i class="fa-solid fa-bug" aria-label="bug"></i>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The more we use pandas to sort and filter data the more you will start to see a <code>SettingWithCopyWarning</code>. This happens because of an interaction between how Pandas works and how Python works: when you are working with a very large data set you don’t want to make a ‘deep copy’ of the data structure every time you make a change to the data. Instead, you get a ‘view’ into the data using a reference, which is a just a lightweight shortcut. So what happens when you try to modify that lightweight copy? Well, if you want to drop rows or columns then you either want to make a <code>copy()</code> at that point, or you will have to accept the warning <em>and</em> the computational risks that go with it.</p>
</div>
</div>
<div id="a5350f73" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calling copy() ensures the index is updated</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and note that all subsequent plots will have</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># these £0 rows removed!</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.price <span class="op">&gt;</span> <span class="dv">0</span>].copy() </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>df.z.plot.kde(xlim<span class="op">=</span>[<span class="op">-</span><span class="dv">2</span>, <span class="dv">10</span>])</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>df.iqs.plot.kde(xlim<span class="op">=</span>[<span class="op">-</span><span class="dv">2</span>, <span class="dv">10</span>])</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>df.lnprice.plot.kde()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-77-output-1.png" width="606" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boxplots" class="level3">
<h3 class="anchored" data-anchor-id="boxplots">Boxplots</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>A standard <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.plot.box.html">boxplot</a>:</p>
<div id="357f2c3e" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df.lnprice.plot.box(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">8</span>))<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-78-output-1.png" width="343" height="633" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scatterplots" class="level3">
<h3 class="anchored" data-anchor-id="scatterplots">Scatterplots</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-37-contents" aria-controls="callout-37" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-37" class="callout-37-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>We can also plot two variables in a <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.plot.scatter.html#pandas.DataFrame.plot.scatter">scatter plot</a> by applying a plot method to the <code>DataFrame</code> (not an individual <code>Series</code>):</p>
<div id="a807e58e" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df.plot.scatter(x<span class="op">=</span><span class="st">'longitude'</span>, y<span class="op">=</span><span class="st">'latitude'</span>, c<span class="op">=</span><span class="st">'price'</span>, s<span class="op">=</span><span class="dv">2</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-79-output-1.png" width="1141" height="803" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note how the code above has the form <code>DataFrame.plot.&lt;plot type&gt;</code>, not <code>DataFrame.Series.plot.&lt;plot type&gt;</code> as in the prior plots. Think about why this then means we need the <code>x</code> and <code>y</code> arguments.</p>
<p>Looking at the plot produced, it’s hard to see where the high values are, so we might want to think about ways that we could make it easier to spot the big numbers… We could, for instance, also vary the size of the point in a plot by some variable, but why does the following not really work?</p>
<div id="a05bccec" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df.plot.scatter(x<span class="op">=</span><span class="st">'longitude'</span>, y<span class="op">=</span><span class="st">'latitude'</span>, c<span class="op">=</span><span class="st">'price'</span>, s<span class="op">=</span>(df.price<span class="op">/</span>df.price.<span class="bu">min</span>()), cmap<span class="op">=</span><span class="st">'viridis'</span>, figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-80-output-1.png" width="1141" height="803" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And we can plot subsets of our data without creating a new object. See if you can work out what the following code is doing that is different from the last plot:</p>
<div id="19c5ff09" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df[df.price <span class="op">&gt;</span> df.price.quantile(<span class="fl">0.90</span>)].plot.scatter(x<span class="op">=</span><span class="st">'longitude'</span>, y<span class="op">=</span><span class="st">'latitude'</span>, c<span class="op">=</span><span class="st">'price'</span>, cmap<span class="op">=</span><span class="st">'viridis'</span>, s<span class="op">=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-81-output-1.png" width="616" height="434" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="hex-bin-plots" class="level3">
<h3 class="anchored" data-anchor-id="hex-bin-plots">Hex Bin Plots</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-38-contents" aria-controls="callout-38" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Difficulty: Low
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-38" class="callout-38-contents callout-collapse collapse">
<div class="callout-body-container callout-body">

</div>
</div>
</div>
<p>And pandas allows us to create ‘less standard’ plots, like a <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.plot.hexbin.html#pandas.DataFrame.plot.hexbin">hex bin plot</a>:</p>
<div id="72eb91e8" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df.plot.hexbin(x<span class="op">=</span><span class="st">'longitude'</span>, y<span class="op">=</span><span class="st">'latitude'</span>, gridsize<span class="op">=</span><span class="dv">50</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical-06-Numeric_Data_files/figure-html/cell-82-output-1.png" width="778" height="581" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>That’s just a taste of what the basic plotting functionality of pandas can do. Feel free to explore more yourself and we’ll also see <a href="http://seaborn.pydata.org/index.html">the seaborn package</a> later.</p>
</section>
</section>
</section>
<section id="credits" class="level1">
<h1>Credits!</h1>
<section id="license" class="level4">
<h4 class="anchored" data-anchor-id="license">License</h4>
<p>These teaching materials are licensed under a mix of <a href="https://opensource.org/licenses/mit-license.php">The MIT License</a> and the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 license</a>.</p>
</section>
<section id="acknowledgements" class="level4">
<h4 class="anchored" data-anchor-id="acknowledgements">Acknowledgements:</h4>
<p>Supported by the <a href="https://www.rgs.org/HomePage.htm">Royal Geographical Society</a> (with the Institute of British Geographers) with a Ray Y Gildea Jr Award.</p>
</section>
<section id="potential-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="potential-dependencies">Potential Dependencies:</h4>
<p>This notebook may depend on the following libraries: pandas, matplotlib</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 2022–2024, Jon Reades</p>
</div>   
    <div class="nav-footer-center">
<p><img src="../img/favicon-16x16.png" class="height:10px img-fluid"> Foundations of Spatial Data Science</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jreades/fsds/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jreades/fsds">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jreades">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>